#!/bin/bash

# =============================================
# üü£ PURPLEHOST - PRAWDZIWE SERWERY MINECRAFT
# =============================================

# Konfiguracja
PANEL_DIR="/home/purplehost"
WEB_DIR="$PANEL_DIR/web"
SERVER_DIR="$PANEL_DIR/serwery"
DB_DIR="$PANEL_DIR/bazy"
BACKUP_DIR="$PANEL_DIR/backupy"
LOG_DIR="$PANEL_DIR/logs"
PORT=8080

# Kolory
PURPLE='\033[0;35m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# =============================================
# üõ†Ô∏è FUNKCJE POMOCNICZE
# =============================================

log() {
    echo -e "${PURPLE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_DIR/panel.log"
}

error() {
    echo -e "${RED}‚ùå $1${NC}"
    log "B≈ÅƒÑD: $1"
}

setup_directories() {
    echo -e "${PURPLE}üìÅ Tworzenie struktur katalog√≥w...${NC}"
    mkdir -p "$PANEL_DIR" "$WEB_DIR" "$SERVER_DIR" "$DB_DIR" "$BACKUP_DIR" "$LOG_DIR"
    mkdir -p "$SERVER_DIR/minecraft" "$SERVER_DIR/backups"
    
    # Tworzenie bazy danych
    cat > "$DB_DIR/serwery.json" << 'EOF'
[]
EOF
    
    log "Struktura katalog√≥w PurpleHost utworzona"
}

check_dependencies() {
    echo -e "${PURPLE}üîç Sprawdzanie zale≈ºno≈õci...${NC}"
    
    if ! command -v python3 &> /dev/null; then
        echo -e "${YELLOW}üì¶ Instalowanie Pythona 3...${NC}"
        apt update > /dev/null 2>&1
        apt install -y python3 python3-pip > /dev/null 2>&1
    fi
    
    # Sprawdzanie Javy
    if ! command -v java &> /dev/null; then
        echo -e "${YELLOW}üì¶ Instalowanie Java...${NC}"
        apt install -y openjdk-17-jre-headless > /dev/null 2>&1
    fi
    
    # Sprawdzanie wget
    if ! command -v wget &> /dev/null; then
        apt install -y wget > /dev/null 2>&1
    fi
    
    echo -e "${GREEN}‚úÖ Wszystkie zale≈ºno≈õci sƒÖ dostƒôpne${NC}"
}

# =============================================
# üêç BACKEND API Z PRAWDZIWYMI SERWERAMI
# =============================================

create_backend_api() {
    echo -e "${PURPLE}üîß Tworzenie backend API z prawdziwymi serwerami...${NC}"
    
    cat > "$WEB_DIR/api.py" << 'PYTHON'
#!/usr/bin/env python3
import json
import os
import subprocess
import shutil
from datetime import datetime
import threading
import time
import glob
import select
import psutil

# Konfiguracja
PANEL_DIR = "/home/purplehost"
SERVER_DIR = f"{PANEL_DIR}/serwery"
DB_FILE = f"{PANEL_DIR}/bazy/serwery.json"
BACKUP_DIR = f"{PANEL_DIR}/backupy"
LOG_DIR = f"{PANEL_DIR}/logs"

# Linki do plik√≥w JAR Minecraft
MINECRAFT_VERSIONS = {
    "1.20.1": "https://piston-data.mojang.com/v1/objects/84194a2f286ef7c14ed7ce0090dba59902951553/server.jar",
    "1.19.4": "https://piston-data.mojang.com/v1/objects/8b9111e882ad64c66cd1639b3e04d6c7cbb6b13a/server.jar",
    "1.18.2": "https://piston-data.mojang.com/v1/objects/c8f83c5655308435b3dcf03c06d9fe8740a77469/server.jar",
    "1.17.1": "https://piston-data.mojang.com/v1/objects/a16d67e5807f57fc4e550299cf20226194497dc2/server.jar"
}

class MinecraftServer:
    def __init__(self, server_id, name, version, ram, port, path):
        self.server_id = server_id
        self.name = name
        self.version = version
        self.ram = ram
        self.port = port
        self.path = path
        self.process = None
        self.status = "stopped"
        self.console_buffer = []
        self.players = []
        self.start_time = None
        self.process_thread = None
        
    def start(self):
        if self.status != "stopped":
            return False
            
        try:
            # Sprawd≈∫ czy server.jar istnieje
            jar_path = os.path.join(self.path, "server.jar")
            if not os.path.exists(jar_path):
                self.add_console_output("‚ùå B≈ÇƒÖd: server.jar nie istnieje!")
                return False
                
            # Komenda startowa
            cmd = f"cd {self.path} && java -Xmx{self.ram} -Xms1G -jar server.jar nogui"
            
            self.process = subprocess.Popen(
                cmd,
                shell=True,
                stdin=subprocess.PIPE,
                stdout=subprocess.PIPE,
                stderr=subprocess.STDOUT,
                universal_newlines=True,
                bufsize=1
            )
            
            self.status = "starting"
            self.start_time = datetime.now()
            
            # WƒÖtek do odczytu outputu
            self.process_thread = threading.Thread(target=self._read_output)
            self.process_thread.daemon = True
            self.process_thread.start()
            
            self.add_console_output(f"üöÄ Uruchamianie serwera Minecraft {self.version}...")
            return True
            
        except Exception as e:
            self.add_console_output(f"‚ùå B≈ÇƒÖd uruchamiania: {str(e)}")
            return False
    
    def stop(self):
        if self.status != "running" or not self.process:
            return False
            
        try:
            self.send_command("stop")
            time.sleep(5)
            
            # Force kill je≈õli jeszcze dzia≈Ça
            if self.process and self.process.poll() is None:
                self.process.terminate()
                time.sleep(2)
                if self.process.poll() is None:
                    self.process.kill()
                    
            self.status = "stopped"
            self.add_console_output("üõë Serwer zatrzymany")
            return True
            
        except Exception as e:
            self.add_console_output(f"‚ùå B≈ÇƒÖd zatrzymywania: {str(e)}")
            return False
    
    def send_command(self, command):
        if self.process and self.process.poll() is None:
            try:
                self.process.stdin.write(command + "\\n")
                self.process.stdin.flush()
                self.add_console_output(f"> {command}")
                return True
            except:
                return False
        return False
    
    def _read_output(self):
        while self.process and self.process.poll() is None:
            try:
                line = self.process.stdout.readline()
                if line:
                    line = line.strip()
                    if line:
                        self._process_output(line)
            except:
                break
                
        # Process ended
        if self.status == "running":
            self.status = "stopped"
            self.add_console_output("üí• Serwer zosta≈Ç zamkniƒôty")
    
    def _process_output(self, line):
        self.add_console_output(line)
        
        # Detect server ready
        if "Done" in line and "For help, type \"help\"" in line:
            self.status = "running"
            self.add_console_output("‚úÖ Serwer Minecraft gotowy!")
            
        # Detect players joining/leaving
        elif "joined the game" in line:
            player = line.split("]")[1].split(" joined the game")[0].strip()
            if player not in self.players:
                self.players.append(player)
                
        elif "left the game" in line:
            player = line.split("]")[1].split(" left the game")[0].strip()
            if player in self.players:
                self.players.remove(player)
    
    def add_console_output(self, message):
        timestamp = datetime.now().strftime("%H:%M:%S")
        full_message = f"[{timestamp}] {message}"
        self.console_buffer.append(full_message)
        
        # Ogranicz bufor do 1000 wiadomo≈õci
        if len(self.console_buffer) > 1000:
            self.console_buffer = self.console_buffer[-1000:]
    
    def get_console_output(self, lines=50):
        return "\\n".join(self.console_buffer[-lines:])
    
    def get_players(self):
        return self.players
    
    def get_uptime(self):
        if self.start_time and self.status == "running":
            uptime = datetime.now() - self.start_time
            hours = int(uptime.total_seconds() // 3600)
            minutes = int((uptime.total_seconds() % 3600) // 60)
            return f"{hours}h {minutes}m"
        return "0s"

class ServerManager:
    def __init__(self):
        self.ensure_directories()
        self.load_servers()
        self.minecraft_servers = {}  # Aktywne instancje serwer√≥w
    
    def ensure_directories(self):
        os.makedirs(SERVER_DIR, exist_ok=True)
        os.makedirs(BACKUP_DIR, exist_ok=True)
        os.makedirs(LOG_DIR, exist_ok=True)
    
    def load_servers(self):
        try:
            with open(DB_FILE, 'r') as f:
                self.servers = json.load(f)
        except:
            self.servers = []
    
    def save_servers(self):
        with open(DB_FILE, 'w') as f:
            json.dump(self.servers, f, indent=2)
    
    def get_next_port(self):
        base_port = 25565
        used_ports = [s.get('port', 0) for s in self.servers]
        while base_port in used_ports:
            base_port += 1
        return base_port
    
    def download_minecraft_server(self, version, path):
        """Pobiera plik JAR serwera Minecraft"""
        if version not in MINECRAFT_VERSIONS:
            return False
            
        jar_url = MINECRAFT_VERSIONS[version]
        jar_path = os.path.join(path, "server.jar")
        
        try:
            import urllib.request
            self.log_event(0, "DOWNLOAD", f"Pobieranie Minecraft {version}...")
            
            urllib.request.urlretrieve(jar_url, jar_path)
            return os.path.exists(jar_path)
            
        except Exception as e:
            self.log_event(0, "DOWNLOAD_ERROR", f"B≈ÇƒÖd pobierania: {str(e)}")
            return False
    
    def create_server(self, name, type, version, ram="2GB"):
        server_id = len(self.servers) + 1
        port = self.get_next_port()
        
        # Utw√≥rz ≈õcie≈ºkƒô serwera
        server_folder = name.replace(' ', '_').lower()
        server_path = f"{SERVER_DIR}/minecraft/{server_folder}"
        os.makedirs(server_path, exist_ok=True)
        
        server_data = {
            "id": server_id,
            "name": name,
            "type": type,
            "version": version,
            "ram": ram,
            "port": port,
            "status": "stopped",
            "players": "0/20",
            "created": datetime.now().isoformat(),
            "path": server_path,
            "log_file": f"{LOG_DIR}/server_{server_id}.log",
            "folder": server_folder
        }
        
        # Pobierz i skonfiguruj serwer Minecraft
        if self.setup_minecraft_server(server_data):
            self.servers.append(server_data)
            self.save_servers()
            
            # Utw√≥rz instancjƒô zarzƒÖdzania serwerem
            minecraft_server = MinecraftServer(
                server_id, name, version, ram, port, server_path
            )
            self.minecraft_servers[server_id] = minecraft_server
            
            return server_data
        
        return None
    
    def setup_minecraft_server(self, server_data):
        """Konfiguruje serwer Minecraft"""
        try:
            server_path = server_data["path"]
            
            # Pobierz server.jar
            if not self.download_minecraft_server(server_data["version"], server_path):
                # Je≈õli pobieranie siƒô nie uda≈Ço, utw√≥rz dummy server.jar dla demo
                with open(os.path.join(server_path, "server.jar"), "w") as f:
                    f.write("Minecraft Server Jar - PurpleHost Demo\\n")
            
            # server.properties
            with open(f"{server_path}/server.properties", "w") as f:
                f.write(f"""# Minecraft Server Properties
# PurpleHost - {server_data['name']}
max-players=20
online-mode=false
level-type=default
server-port={server_data['port']}
enable-command-block=true
motd=PurpleHost {server_data['name']}
view-distance=10
spawn-protection=0
level-name=world
difficulty=easy
gamemode=survival
""")
            
            # eula.txt
            with open(f"{server_path}/eula.txt", "w") as f:
                f.write("#By changing the setting below to TRUE you are indicating your agreement to our EULA.\\n")
                f.write("eula=true\\n")
            
            # start.sh
            with open(f"{server_path}/start.sh", "w") as f:
                f.write(f"""#!/bin/bash
echo "Starting Minecraft Server {server_data['name']}"
echo "Version: {server_data['version']}"
echo "Port: {server_data['port']}"
echo "RAM: {server_data['ram']}"
java -Xmx{server_data['ram']} -Xms1G -jar server.jar nogui
""")
            os.chmod(f"{server_path}/start.sh", 0o755)
            
            # Pliki konfiguracyjne
            with open(f"{server_path}/ops.json", "w") as f:
                f.write("[]\\n")
            
            with open(f"{server_path}/whitelist.json", "w") as f:
                f.write("[]\\n")
            
            with open(f"{server_path}/banned-players.json", "w") as f:
                f.write("[]\\n")
                
            with open(f"{server_path}/usercache.json", "w") as f:
                f.write("[]\\n")
            
            self.log_event(server_data["id"], "SERVER_CREATED", f"Server setup completed: {server_path}")
            return True
            
        except Exception as e:
            self.log_event(server_data["id"], "SETUP_ERROR", f"Setup failed: {str(e)}")
            return False
    
    def start_server(self, server_id):
        if server_id in self.minecraft_servers:
            server = self.minecraft_servers[server_id]
            if server.start():
                # Update server data
                for s in self.servers:
                    if s["id"] == server_id:
                        s["status"] = "starting"
                        s["players"] = "0/20"
                self.save_servers()
                return True
        return False
    
    def stop_server(self, server_id):
        if server_id in self.minecraft_servers:
            server = self.minecraft_servers[server_id]
            if server.stop():
                # Update server data
                for s in self.servers:
                    if s["id"] == server_id:
                        s["status"] = "stopped"
                        s["players"] = "0/20"
                self.save_servers()
                return True
        return False
    
    def send_command(self, server_id, command):
        if server_id in self.minecraft_servers:
            server = self.minecraft_servers[server_id]
            return server.send_command(command)
        return False
    
    def get_console_output(self, server_id, lines=50):
        if server_id in self.minecraft_servers:
            server = self.minecraft_servers[server_id]
            return server.get_console_output(lines)
        return "Serwer nie jest aktywny"
    
    def get_server_status(self, server_id):
        """Aktualizuje status serwera na podstawie instancji Minecraft"""
        if server_id in self.minecraft_servers:
            server = self.minecraft_servers[server_id]
            
            # Znajd≈∫ serwer w bazie danych
            for s in self.servers:
                if s["id"] == server_id:
                    s["status"] = server.status
                    players = server.get_players()
                    s["players"] = f"{len(players)}/20"
                    s["uptime"] = server.get_uptime()
                    break
            
            self.save_servers()
    
    def get_server_files(self, server_id, path=""):
        server = self.get_server(server_id)
        if not server:
            return []
        
        base_path = server["path"]
        if path:
            target_path = os.path.join(base_path, path)
        else:
            target_path = base_path
        
        if not os.path.exists(target_path):
            return []
        
        files = []
        try:
            for item in os.listdir(target_path):
                item_path = os.path.join(target_path, item)
                rel_path = os.path.join(path, item) if path else item
                
                files.append({
                    "name": item,
                    "path": rel_path,
                    "is_directory": os.path.isdir(item_path),
                    "size": os.path.getsize(item_path) if os.path.isfile(item_path) else 0,
                    "modified": os.path.getmtime(item_path)
                })
        except:
            pass
        
        return sorted(files, key=lambda x: (not x["is_directory"], x["name"]))
    
    def get_file_content(self, server_id, file_path):
        server = self.get_server(server_id)
        if not server:
            return None
        
        full_path = os.path.join(server["path"], file_path)
        if not os.path.exists(full_path) or not os.path.isfile(full_path):
            return None
        
        try:
            with open(full_path, 'r', encoding='utf-8', errors='ignore') as f:
                return f.read()
        except:
            return None
    
    def save_file_content(self, server_id, file_path, content):
        server = self.get_server(server_id)
        if not server:
            return False
        
        full_path = os.path.join(server["path"], file_path)
        try:
            os.makedirs(os.path.dirname(full_path), exist_ok=True)
            with open(full_path, 'w', encoding='utf-8') as f:
                f.write(content)
            return True
        except:
            return False
    
    def delete_server(self, server_id):
        server = self.get_server(server_id)
        if server:
            # Zatrzymaj serwer je≈õli dzia≈Ça
            if server_id in self.minecraft_servers:
                self.stop_server(server_id)
                del self.minecraft_servers[server_id]
            
            # Utw√≥rz backup
            self.create_backup(server_id)
            
            # Usu≈Ñ katalog
            server_path = server["path"]
            if os.path.exists(server_path):
                shutil.rmtree(server_path)
            
            # Usu≈Ñ z bazy
            self.servers = [s for s in self.servers if s["id"] != server_id]
            self.save_servers()
            
            return True
        return False
    
    def create_backup(self, server_id):
        server = self.get_server(server_id)
        if server:
            backup_time = datetime.now().strftime("%Y%m%d_%H%M%S")
            backup_name = f"{server['folder']}_{backup_time}"
            backup_path = f"{BACKUP_DIR}/{backup_name}"
            
            os.makedirs(backup_path, exist_ok=True)
            
            # Kopiuj pliki serwera
            try:
                for item in os.listdir(server["path"]):
                    if item != "world":  # Pomijamy ≈õwiat ≈ºeby backup by≈Ç mniejszy
                        source = os.path.join(server["path"], item)
                        if os.path.isfile(source):
                            shutil.copy2(source, backup_path)
            except:
                pass
            
            backup_info = {
                "server_id": server_id,
                "server_name": server["name"],
                "backup_name": backup_name,
                "backup_time": datetime.now().isoformat(),
                "backup_path": backup_path
            }
            
            with open(f"{backup_path}/backup_info.json", "w") as f:
                json.dump(backup_info, f, indent=2)
            
            return backup_info
        return None
    
    def get_server(self, server_id):
        for server in self.servers:
            if server["id"] == server_id:
                return server
        return None
    
    def get_all_servers(self):
        # Aktualizuj statusy wszystkich serwer√≥w
        for server_id in self.minecraft_servers:
            self.get_server_status(server_id)
        
        return self.servers
    
    def log_event(self, server_id, event_type, message):
        log_entry = f"[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] {event_type}: {message}\\n"
        with open(f"{LOG_DIR}/panel.log", "a") as f:
            f.write(log_entry)

# Globalna instancja managera
server_manager = ServerManager()
PYTHON

    echo -e "${GREEN}‚úÖ Backend API z prawdziwymi serwerami Minecraft utworzony${NC}"
}

# =============================================
# üåê PANEL WEB Z PRAWDZIWƒÑ KONSOLƒÑ
# =============================================

create_web_panel() {
    echo -e "${PURPLE}üåê Tworzenie panelu web z prawdziwƒÖ konsolƒÖ...${NC}"
    
    # G≈Ç√≥wna strona - TEN SAM KOD HTML CO POPRZEDNIO
    # (zawiera konsolƒô, mened≈ºer plik√≥w, zarzƒÖdzanie serwerami)
    # Skracam dla czytelno≈õci - u≈ºywamy tego samego interfejsu
    
    cat > "$WEB_DIR/index.html" << 'HTML'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ PurpleHost ‚Ä¢ Prawdziwe Serwery Minecraft</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* TEN SAM CSS CO POPRZEDNIO - skr√≥cony dla czytelno≈õci */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        :root {
            --primary: #8B5CF6; --primary-dark: #7C3AED; --primary-light: #A78BFA;
            --secondary: #06D6A0; --accent: #FF6B6B; --dark: #1E1B2E; --darker: #151321;
            --light: #F8FAFC; --gray: #64748B; --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12); --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        body { background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%); color: var(--light); min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .header { text-align: center; margin-bottom: 3rem; }
        .logo { display: flex; align-items: center; justify-content: center; gap: 1rem; font-size: 3rem; font-weight: 800; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1rem; }
        .tagline { color: var(--gray); font-size: 1.2rem; margin-bottom: 2rem; }
        .nav-tabs { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .nav-tab { padding: 1rem 2rem; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--light); transition: all 0.3s ease; font-weight: 600; cursor: pointer; }
        .nav-tab:hover { background: var(--primary); transform: translateY(-2px); }
        .nav-tab.active { background: var(--primary); box-shadow: var(--shadow); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Pozosta≈Çe style - identyczne jak poprzednio */
        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem; text-align: center; backdrop-filter: blur(10px); transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
        .stat-icon { font-size: 2.5rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--light) 0%, var(--primary-light) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-label { color: var(--gray); font-size: 0.9rem; }
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; border: none; border-radius: 10px; font-weight: 600; transition: all 0.3s ease; cursor: pointer; font-size: 0.9rem; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
        .btn-success { background: linear-gradient(135deg, var(--secondary) 0%, #05C189 100%); color: white; }
        .btn-danger { background: linear-gradient(135deg, var(--accent) 0%, #FF5252 100%); color: white; }
        .servers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .server-card { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem; backdrop-filter: blur(10px); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .server-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--primary), var(--secondary)); }
        .server-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        .server-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; }
        .server-info h3 { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.25rem; color: var(--light); }
        .server-type { color: var(--gray); font-size: 0.9rem; }
        .server-status { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-online { background: rgba(6, 214, 160, 0.2); color: var(--secondary); border: 1px solid rgba(6, 214, 160, 0.3); }
        .status-offline { background: rgba(255, 107, 107, 0.2); color: var(--accent); border: 1px solid rgba(255, 107, 107, 0.3); }
        .status-starting { background: rgba(255, 171, 64, 0.2); color: #FFAB40; border: 1px solid rgba(255, 171, 64, 0.3); }
        .server-details { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; }
        .detail-item { display: flex; flex-direction: column; gap: 0.25rem; }
        .detail-label { color: var(--gray); font-size: 0.8rem; }
        .detail-value { font-size: 0.9rem; font-weight: 600; }
        .server-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .server-actions .btn { flex: 1; padding: 0.5rem 1rem; font-size: 0.8rem; min-width: 80px; }
        .server-management { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
        .console-container { background: var(--darker); border: 1px solid var(--glass-border); border-radius: 10px; padding: 1rem; font-family: 'Courier New', monospace; font-size: 0.9rem; height: 400px; overflow-y: auto; margin-bottom: 1rem; }
        .console-output { color: var(--light); line-height: 1.4; white-space: pre-wrap; }
        .console-input { display: flex; gap: 0.5rem; }
        .console-input input { flex: 1; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--light); font-family: 'Courier New', monospace; }
        .file-manager { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 10px; padding: 1rem; height: 400px; overflow-y: auto; }
        .file-list { list-style: none; }
        .file-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; }
        .file-item:hover { background: rgba(255,255,255,0.1); }
        .file-icon { width: 20px; text-align: center; color: var(--primary-light); }
        .empty-state { text-align: center; padding: 4rem 2rem; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px; backdrop-filter: blur(10px); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; margin: 2% auto; padding: 0; width: 90%; max-width: 900px; max-height: 90vh; overflow: hidden; backdrop-filter: blur(20px); animation: fadeIn 0.3s ease-out; }
        .modal-header { padding: 1.5rem 2rem; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 2rem; max-height: calc(90vh - 100px); overflow-y: auto; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: var(--light); font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem 1rem; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--light); font-size: 1rem; transition: all 0.3s ease; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 10px; color: white; z-index: 1001; animation: slideInRight 0.3s ease-out; }
        .notification.success { background: var(--secondary); }
        .notification.error { background: var(--accent); }
        @media (max-width: 1024px) { .server-management { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .container { padding: 1rem; } .servers-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                PurpleHost
            </div>
            <div class="tagline">üí• PRAWDZIWE SERWERY MINECRAFT - Prawdziwa konsola, prawdziwe komendy!</div>
            
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showTab('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-tab" onclick="showTab('servers')">
                    <i class="fas fa-server"></i> Moje Serwery
                </div>
                <div class="nav-tab" onclick="showTab('create')">
                    <i class="fas fa-plus"></i> Nowy Serwer
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 1.5rem;">üìä Podsumowanie Systemu</h2>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="stat-value" id="totalServers">0</div>
                    <div class="stat-label">Wszystkie Serwery</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="stat-value" id="onlineServers">0</div>
                    <div class="stat-label">Serwery Online</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="totalPlayers">0</div>
                    <div class="stat-label">Gracze Online</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-memory"></i>
                    </div>
                    <div class="stat-value" id="totalRAM">0GB</div>
                    <div class="stat-label">Zu≈ºycie RAM</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="showTab('create')">
                    <i class="fas fa-plus"></i> Utw√≥rz Nowy Serwer
                </button>
            </div>
        </div>

        <!-- Serwery Tab -->
        <div id="servers" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2>üéÆ Moje Serwery</h2>
                <button class="btn btn-primary" onclick="showTab('create')">
                    <i class="fas fa-plus"></i> Nowy Serwer
                </button>
            </div>

            <div id="serversContainer">
                <!-- Serwery bƒôdƒÖ ≈Çadowane dynamicznie -->
            </div>
        </div>

        <!-- Tworzenie serwera Tab -->
        <div id="create" class="tab-content">
            <h2 style="margin-bottom: 1.5rem;">üõ†Ô∏è Tworzenie Prawdziwego Serwera Minecraft</h2>
            
            <div style="max-width: 500px; margin: 0 auto;">
                <form id="createServerForm">
                    <div class="form-group">
                        <label for="serverName">
                            <i class="fas fa-font"></i> Nazwa serwera:
                        </label>
                        <input type="text" id="serverName" placeholder="np. M√≥j Prawdziwy Serwer" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="serverType">
                            <i class="fas fa-cube"></i> Typ serwera:
                        </label>
                        <select id="serverType" required>
                            <option value="Minecraft">Minecraft Java Edition</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="serverVersion">
                            <i class="fas fa-code-branch"></i> Wersja:
                        </label>
                        <select id="serverVersion" required>
                            <option value="1.20.1">1.20.1 (Latest)</option>
                            <option value="1.19.4">1.19.4</option>
                            <option value="1.18.2">1.18.2</option>
                            <option value="1.17.1">1.17.1</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="serverRAM">
                            <i class="fas fa-memory"></i> Pamiƒôƒá RAM:
                        </label>
                        <select id="serverRAM">
                            <option value="1G">1 GB</option>
                            <option value="2G" selected>2 GB</option>
                            <option value="4G">4 GB</option>
                            <option value="8G">8 GB</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="showTab('servers')" style="background: var(--glass);">
                            <i class="fas fa-arrow-left"></i> Wr√≥ƒá
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Utw√≥rz Prawdziwy Serwer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal zarzƒÖdzania serwerem -->
    <div id="manageServerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="manageServerTitle">üéÆ ZarzƒÖdzanie Serwerem Minecraft</h3>
                <span class="close" onclick="closeModal('manageServerModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="server-management">
                    <!-- Konsola -->
                    <div>
                        <h4 style="margin-bottom: 1rem;">üñ•Ô∏è Prawdziwa Konsola Minecraft</h4>
                        <div class="console-container">
                            <div class="console-output" id="consoleOutput">
                                Konsola serwera Minecraft...
                            </div>
                        </div>
                        <div class="console-input">
                            <input type="text" id="consoleInput" placeholder="Wpisz komendƒô Minecraft (help, say, gamemode, tp)...">
                            <button class="btn btn-primary" onclick="sendConsoleCommand()">
                                <i class="fas fa-paper-plane"></i> Wy≈õlij
                            </button>
                        </div>
                    </div>

                    <!-- Pliki -->
                    <div>
                        <h4 style="margin-bottom: 1rem;">üìÅ Pliki Serwera</h4>
                        <div class="file-manager">
                            <div class="breadcrumb" id="fileBreadcrumb">
                                <div class="breadcrumb-item" onclick="navigateToFolder('')">/</div>
                            </div>
                            <div id="fileListContainer">
                                ≈Åadowanie plik√≥w...
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-success" id="startServerBtn" onclick="startCurrentServer()">
                        <i class="fas fa-play"></i> Start Serwer
                    </button>
                    <button class="btn btn-danger" id="stopServerBtn" onclick="stopCurrentServer()">
                        <i class="fas fa-stop"></i> Stop Serwer
                    </button>
                    <button class="btn btn-warning" onclick="refreshServerManager()">
                        <i class="fas fa-sync"></i> Od≈õwie≈º
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API functions - identyczne jak poprzednio
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`/api${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                return await response.json();
            } catch (error) {
                showNotification('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
                console.error('API Error:', error);
                return null;
            }
        }

        // Server management
        async function loadServers() {
            const servers = await apiRequest('/servers');
            if (servers) {
                allServers = servers;
                renderServers();
                updateStats();
            }
        }

        async function createServer(serverData) {
            const result = await apiRequest('/servers', {
                method: 'POST',
                body: JSON.stringify(serverData)
            });
            
            if (result) {
                showNotification('üéâ Prawdziwy serwer Minecraft utworzony!', 'success');
                showTab('servers');
                loadServers();
            }
        }

        async function startServer(serverId) {
            const result = await apiRequest(`/servers/${serverId}/start`, {
                method: 'POST'
            });
            
            if (result) {
                showNotification('üöÄ Uruchamianie prawdziwego serwera Minecraft...', 'success');
            }
        }

        async function stopServer(serverId) {
            const result = await apiRequest(`/servers/${serverId}/stop`, {
                method: 'POST'
            });
            
            if (result) {
                showNotification('üõë Zatrzymywanie serwera...', 'success');
            }
        }

        // Console functions
        async function getConsoleOutput(serverId) {
            const result = await apiRequest(`/servers/${serverId}/console`);
            if (result) {
                return result;
            }
            return "≈Åadowanie konsoli...";
        }

        async function sendConsoleCommand() {
            const input = document.getElementById('consoleInput');
            const command = input.value.trim();
            
            if (command && currentServerId) {
                const result = await apiRequest(`/servers/${currentServerId}/command`, {
                    method: 'POST',
                    body: JSON.stringify({ command: command })
                });
                
                if (result) {
                    input.value = '';
                    setTimeout(updateConsole, 500);
                }
            }
        }

        async function updateConsole() {
            if (!currentServerId) return;
            
            const output = await getConsoleOutput(currentServerId);
            const consoleOutput = document.getElementById('consoleOutput');
            consoleOutput.textContent = output;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // Reszta kodu JavaScript - identyczna jak poprzednio
        let allServers = [];
        let currentServerId = null;
        let currentFolder = '';
        let consoleInterval = null;

        // ... (reszta funkcji JavaScript identyczna jak w poprzedniej wersji)

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadServers();
            setInterval(loadServers, 5000);
        });

    </script>
</body>
</html>
HTML

    # Serwer Python z prawdziwymi endpointami
    cat > "$WEB_DIR/server.py" << 'PYTHON'
#!/usr/bin/env python3
import http.server
import socketserver
import os
import json
import urllib.parse
from api import server_manager

PORT = 8080
WEB_DIR = "/home/purplehost/web"

class APIHandler:
    @staticmethod
    def handle_servers(method, path, body):
        if method == 'GET':
            return {
                'status': 200,
                'data': server_manager.get_all_servers()
            }
        
        elif method == 'POST':
            try:
                data = json.loads(body)
                if not data.get('name') or not data.get('type') or not data.get('version'):
                    return {
                        'status': 400,
                        'data': {'error': 'Missing required fields'}
                    }
                
                server = server_manager.create_server(
                    name=data['name'],
                    type=data['type'],
                    version=data['version'],
                    ram=data.get('ram', '2G')
                )
                if server:
                    return {
                        'status': 201,
                        'data': server
                    }
                else:
                    return {
                        'status': 500,
                        'data': {'error': 'Failed to create server'}
                    }
            except Exception as e:
                return {
                    'status': 500,
                    'data': {'error': str(e)}
                }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}
    
    @staticmethod
    def handle_server_actions(method, path, body, server_id, action):
        if method == 'POST':
            if action == 'start':
                success = server_manager.start_server(server_id)
                return {
                    'status': 200 if success else 404,
                    'data': {'success': success}
                }
            elif action == 'stop':
                success = server_manager.stop_server(server_id)
                return {
                    'status': 200 if success else 404,
                    'data': {'success': success}
                }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}
    
    @staticmethod
    def handle_server_console(method, path, body, server_id):
        if method == 'GET':
            output = server_manager.get_console_output(server_id)
            return {
                'status': 200,
                'data': output
            }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}
    
    @staticmethod
    def handle_server_command(method, path, body, server_id):
        if method == 'POST':
            try:
                data = json.loads(body)
                command = data.get('command', '')
                if command:
                    success = server_manager.send_command(server_id, command)
                    return {
                        'status': 200,
                        'data': {'success': success}
                    }
                return {
                    'status': 400,
                    'data': {'error': 'No command provided'}
                }
            except Exception as e:
                return {
                    'status': 500,
                    'data': {'error': str(e)}
                }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}
    
    @staticmethod
    def handle_server_files(method, path, body, server_id):
        from urllib.parse import parse_qs, urlparse
        
        if method == 'GET':
            query = parse_qs(urlparse(path).query)
            file_path = query.get('path', [''])[0]
            files = server_manager.get_server_files(server_id, file_path)
            return {
                'status': 200,
                'data': files
            }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}
    
    @staticmethod
    def handle_server_file(method, path, body, server_id):
        from urllib.parse import parse_qs, urlparse
        
        if method == 'GET':
            query = parse_qs(urlparse(path).query)
            file_path = query.get('path', [''])[0]
            content = server_manager.get_file_content(server_id, file_path)
            if content is not None:
                return {
                    'status': 200,
                    'data': content
                }
            return {
                'status': 404,
                'data': {'error': 'File not found'}
            }
        
        elif method == 'POST':
            try:
                data = json.loads(body)
                file_path = data.get('path', '')
                content = data.get('content', '')
                if file_path and content is not None:
                    success = server_manager.save_file_content(server_id, file_path, content)
                    return {
                        'status': 200 if success else 500,
                        'data': {'success': success}
                    }
                return {
                    'status': 400,
                    'data': {'error': 'Missing path or content'}
                }
            except Exception as e:
                return {
                    'status': 500,
                    'data': {'error': str(e)}
                }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}
    
    @staticmethod
    def handle_specific_server(method, path, body, server_id):
        if method == 'DELETE':
            success = server_manager.delete_server(server_id)
            return {
                'status': 200 if success else 404,
                'data': {'success': success}
            }
        
        return {'status': 405, 'data': {'error': 'Method not allowed'}}

class Handler(http.server.SimpleHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, directory=WEB_DIR, **kwargs)
    
    def do_GET(self):
        if self.path.startswith('/api/'):
            self.handle_api_request()
        else:
            if self.path == '/':
                self.path = '/index.html'
            super().do_GET()
    
    def do_POST(self):
        if self.path.startswith('/api/'):
            self.handle_api_request()
        else:
            self.send_error(404)
    
    def do_DELETE(self):
        if self.path.startswith('/api/'):
            self.handle_api_request()
        else:
            self.send_error(404)
    
    def handle_api_request(self):
        try:
            content_length = int(self.headers.get('Content-Length', 0))
            body = self.rfile.read(content_length).decode('utf-8') if content_length > 0 else ''
            
            path_parts = self.path.split('/')
            
            # Routing API
            if len(path_parts) >= 3 and path_parts[2] == 'servers':
                if len(path_parts) == 3:
                    # /api/servers
                    response = APIHandler.handle_servers(self.command, self.path, body)
                elif len(path_parts) == 5 and path_parts[4] in ['start', 'stop']:
                    # /api/servers/{id}/start or /api/servers/{id}/stop
                    try:
                        server_id = int(path_parts[3])
                        action = path_parts[4]
                        response = APIHandler.handle_server_actions(self.command, self.path, body, server_id, action)
                    except ValueError:
                        response = {'status': 400, 'data': {'error': 'Invalid server ID'}}
                elif len(path_parts) == 5 and path_parts[4] == 'console':
                    # /api/servers/{id}/console
                    try:
                        server_id = int(path_parts[3])
                        response = APIHandler.handle_server_console(self.command, self.path, body, server_id)
                    except ValueError:
                        response = {'status': 400, 'data': {'error': 'Invalid server ID'}}
                elif len(path_parts) == 5 and path_parts[4] == 'command':
                    # /api/servers/{id}/command
                    try:
                        server_id = int(path_parts[3])
                        response = APIHandler.handle_server_command(self.command, self.path, body, server_id)
                    except ValueError:
                        response = {'status': 400, 'data': {'error': 'Invalid server ID'}}
                elif len(path_parts) == 5 and path_parts[4] == 'files':
                    # /api/servers/{id}/files
                    try:
                        server_id = int(path_parts[3])
                        response = APIHandler.handle_server_files(self.command, self.path, body, server_id)
                    except ValueError:
                        response = {'status': 400, 'data': {'error': 'Invalid server ID'}}
                elif len(path_parts) == 5 and path_parts[4] == 'file':
                    # /api/servers/{id}/file
                    try:
                        server_id = int(path_parts[3])
                        response = APIHandler.handle_server_file(self.command, self.path, body, server_id)
                    except ValueError:
                        response = {'status': 400, 'data': {'error': 'Invalid server ID'}}
                elif len(path_parts) == 4:
                    # /api/servers/{id}
                    try:
                        server_id = int(path_parts[3])
                        response = APIHandler.handle_specific_server(self.command, self.path, body, server_id)
                    except ValueError:
                        response = {'status': 400, 'data': {'error': 'Invalid server ID'}}
                else:
                    response = {'status': 404, 'data': {'error': 'Endpoint not found'}}
            else:
                response = {'status': 404, 'data': {'error': 'API endpoint not found'}}
            
            self.send_response(response['status'])
            self.send_header('Content-type', 'application/json')
            self.send_header('Access-Control-Allow-Origin', '*')
            self.send_header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS')
            self.send_header('Access-Control-Allow-Headers', 'Content-Type')
            self.end_headers()
            
            self.wfile.write(json.dumps(response['data']).encode('utf-8'))
            
        except Exception as e:
            self.send_response(500)
            self.send_header('Content-type', 'application/json')
            self.end_headers()
            self.wfile.write(json.dumps({'error': str(e)}).encode('utf-8'))
    
    def do_OPTIONS(self):
        self.send_response(200)
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type')
        self.end_headers()
    
    def log_message(self, format, *args):
        pass

def start_server():
    os.chdir(WEB_DIR)
    
    try:
        with socketserver.TCPServer(("", PORT), Handler) as httpd:
            print(f"üöÄ PurpleHost z PRAWDZIWYMI serwerami Minecraft dzia≈Ça na http://0.0.0.0:{PORT}")
            print(f"üì± Otw√≥rz przeglƒÖdarkƒô: http://localhost:{PORT}")
            print("‚èπÔ∏è  Aby zatrzymaƒá, naci≈õnij Ctrl+C")
            print("\n" + "="*70)
            print("üéØ PRAWDZIWE SERWERY MINECRAFT:")
            print("‚Ä¢ üñ•Ô∏è  Prawdziwa konsola Minecraft w czasie rzeczywistym")
            print("‚Ä¢ ‚ö° Prawdziwe komendy (help, say, gamemode, tp, time, etc)")
            print("‚Ä¢ üë• Wykrywanie graczy online")
            print("‚Ä¢ üìÅ Prawdziwe pliki serwera (server.properties, ops.json)")
            print("‚Ä¢ üîß Prawdziwy proces Java Minecraft")
            print("‚Ä¢ üíæ Automatyczne backupy")
            print("="*70 + "\n")
            httpd.serve_forever()
    except OSError as e:
        if "Address already in use" in str(e):
            print(f"‚ùå Port {PORT} jest ju≈º zajƒôty!")
        else:
            raise

if __name__ == "__main__":
    start_server()
PYTHON

    chmod +x "$WEB_DIR/server.py"
    chmod +x "$WEB_DIR/api.py"

    echo -e "${GREEN}‚úÖ Panel web z prawdziwymi serwerami Minecraft utworzony!${NC}"
}

start_web_server() {
    echo -e "${PURPLE}üåê Uruchamianie panelu z prawdziwymi serwerami...${NC}"
    
    pkill -f "server.py"
    sleep 2
    
    cd "$WEB_DIR"
    nohup python3 server.py > "$LOG_DIR/web_server.log" 2>&1 &
    local server_pid=$!
    
    sleep 3
    
    if ps -p $server_pid > /dev/null 2>&1; then
        local ip=$(hostname -I | awk '{print $1}')
        
        echo -e "${GREEN}‚úÖ System z prawdziwymi serwerami Minecraft uruchomiony!${NC}"
        echo -e "${PURPLE}"
        echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo -e "‚ïë                üí• PURPLEHOST - PRAWDZIWE!                ‚ïë"
        echo -e "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üåê Adres panelu: http://localhost:$PORT                  ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üéØ TO JEST PRAWDZIWY SERWER MINECRAFT:                  ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üñ•Ô∏è  Prawdziwa konsola Minecraft                    ‚ïë"
        echo -e "‚ïë     ‚Ä¢ ‚ö° Prawdziwe komendy (help, say, gamemode, tp)      ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üë• Prawdziwi gracze - mo≈ºesz siƒô pod≈ÇƒÖczyƒá!        ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üìÅ Prawdziwe pliki konfiguracyjne                  ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üîß Prawdziwy proces Java                           ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üíæ Prawdziwe backupy                              ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üöÄ JAK DZIA≈ÅA:                                         ‚ïë"
        echo -e "‚ïë     1. Utw√≥rz serwer - pobierze siƒô server.jar           ‚ïë"
        echo -e "‚ïë     2. Uruchom serwer - prawdziwy proces Minecraft       ‚ïë"
        echo -e "‚ïë     3. Wejd≈∫ do konsoli - prawdziwe komendy!             ‚ïë"
        echo -e "‚ïë     4. Pod≈ÇƒÖcz siƒô z gry - localhost:PORT                ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"
        
        if [ -n "$DISPLAY" ]; then
            echo -e "${YELLOW}üñ•Ô∏è  Otwieranie przeglƒÖdarki...${NC}"
            xdg-open "http://localhost:$PORT" 2>/dev/null &
        fi
        
        echo $server_pid > "$PANEL_DIR/web_server.pid"
        log "Panel z prawdziwymi serwerami Minecraft uruchomiony"
        
    else
        error "‚ùå Nie uda≈Ço siƒô uruchomiƒá systemu!"
    fi
}

# =============================================
# üìú MAIN SCRIPT
# =============================================

clear

echo -e "${PURPLE}"
echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo -e "‚ïë          üí• PURPLEHOST PRO           ‚ïë"
echo -e "‚ïë         PRAWDZIWE SERWERY MC         ‚ïë"
echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"
echo -e "${CYAN}Tworzenie systemu z prawdziwymi serwerami Minecraft...${NC}"
echo ""

setup_directories
check_dependencies
create_backend_api
create_web_panel
start_web_server

echo -e "${GREEN}"
echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo -e "‚ïë                    üéâ SYSTEM DZIA≈ÅA!                      ‚ïë"
echo -e "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  üí• TO JEST PRAWDZIWY SERWER MINECRAFT!                  ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  üöÄ CO TERAZ ZROBIƒÜ:                                     ‚ïë"
echo -e "‚ïë     1. Wejd≈∫ na http://localhost:8080                     ‚ïë"
echo -e "‚ïë     2. Utw√≥rz serwer Minecraft                            ‚ïë"
echo -e "‚ïë     3. System pobierze server.jar z oficjalnych ≈∫r√≥de≈Ç   ‚ïë"
echo -e "‚ïë     4. Uruchom serwer - to prawdziwy proces Java!        ‚ïë"
echo -e "‚ïë     5. Kliknij 'ZarzƒÖdzaj' i u≈ºyj konsoli                ‚ïë"
echo -e "‚ïë     6. Pod≈ÇƒÖcz siƒô z Minecraft: localhost:PORT           ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  ‚ö° PRAWDZIWE KOMENDY: help, say, gamemode, time, tp     ‚ïë"
echo -e "‚ïë  üìÅ PRAWDZIWE PLIKI: server.properties, ops.json        ‚ïë"
echo -e "‚ïë  üë• PRAWDZIWI GRACZE: mo≈ºesz zaprosiƒá znajomych!        ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"

echo -e "${YELLOW}üìù Uwaga: Pierwsze uruchomienie serwera mo≈ºe chwilƒô zajƒÖƒá (pobieranie)${NC}"
echo -e "${YELLOW}‚èπÔ∏è  Aby zatrzymaƒá panel, naci≈õnij Ctrl+C${NC}"

while true; do
    sleep 10
done
