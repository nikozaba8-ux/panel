#!/bin/bash

# GO Game - Auto Public Dashboard
# Autor: Kacpros
# Wersja: 11.0 - Enhanced Version with Backup, Validation & Logging

# Kolory
BLUE='\033[0;34m'
GREEN='\033[0;32m'
ORANGE='\033[0;33m'
RED='\033[0;31m'
CYAN='\033[0;36m'
PURPLE='\033[0;35m'
NC='\033[0m'

print_info() { echo -e "${BLUE}[INFO]${NC} $1"; }
print_success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }
print_warning() { echo -e "${ORANGE}[WARNING]${NC} $1"; }
print_error() { echo -e "${RED}[ERROR]${NC} $1"; }
print_debug() { echo -e "${CYAN}[DEBUG]${NC} $1"; }
print_header() { echo -e "${PURPLE}[HEADER]${NC} $1"; }

# Logowanie
setup_logging() {
    LOG_FILE="go-game-install-$(date +%Y%m%d-%H%M%S).log"
    exec > >(tee -a "$LOG_FILE") 2>&1
    print_info "Logowanie uruchomione: $LOG_FILE"
}

# Sprawd≈∫ zale≈ºno≈õci
check_dependencies() {
    print_info "Sprawdzanie zale≈ºno≈õci systemowych..."
    
    local missing_deps=()
    
    # Sprawd≈∫ curl
    if ! command -v curl &> /dev/null; then
        print_warning "Curl nie znaleziony, instalujƒô..."
        if command -v apt-get &> /dev/null; then
            apt-get update && apt-get install -y curl
        elif command -v yum &> /dev/null; then
            yum install -y curl
        else
            missing_deps+=("curl")
        fi
    fi
    
    # Sprawd≈∫ netstat dla sprawdzania port√≥w
    if ! command -v netstat &> /dev/null && ! command -v ss &> /dev/null; then
        print_warning "Netstat/ss nie znalezione, instalujƒô net-tools..."
        if command -v apt-get &> /dev/null; then
            apt-get install -y net-tools
        elif command -v yum &> /dev/null; then
            yum install -y net-tools
        fi
    fi
    
    if [ ${#missing_deps[@]} -ne 0 ]; then
        print_error "BrakujƒÖce zale≈ºno≈õci: ${missing_deps[*]}"
        return 1
    fi
    
    print_success "Wszystkie zale≈ºno≈õci sƒÖ dostƒôpne"
    return 0
}

# Sprawd≈∫ dostƒôpno≈õƒá port√≥w
check_ports_availability() {
    local ports=("$@")
    local occupied_ports=()
    
    print_info "Sprawdzanie dostƒôpno≈õci port√≥w..."
    
    for port in "${ports[@]}"; do
        if (command -v netstat >/dev/null && netstat -tuln | grep -q ":${port} ") || 
           (command -v ss >/dev/null && ss -tuln | grep -q ":${port} ") || 
           (command -v lsof >/dev/null && lsof -i :${port} >/dev/null 2>&1); then
            occupied_ports+=("$port")
            print_warning "Port $port jest ju≈º zajƒôty"
        else
            print_debug "Port $port jest dostƒôpny"
        fi
    done
    
    if [ ${#occupied_ports[@]} -ne 0 ]; then
        print_error "NastƒôpujƒÖce porty sƒÖ ju≈º zajƒôte: ${occupied_ports[*]}"
        return 1
    fi
    
    print_success "Wszystkie porty sƒÖ dostƒôpne"
    return 0
}

# Backup istniejƒÖcej instalacji
backup_existing() {
    local backup_dir="backups"
    
    if [ -d "go-game-public" ]; then
        print_info "Znaleziono istniejƒÖcƒÖ instalacjƒô, tworzenie backupu..."
        
        mkdir -p "$backup_dir"
        local backup_name="go-game-backup-$(date +%Y%m%d-%H%M%S)"
        local backup_path="$backup_dir/$backup_name"
        
        if cp -r go-game-public "$backup_path"; then
            print_success "Backup utworzony: $backup_path"
            
            # Usu≈Ñ starƒÖ instalacjƒô
            rm -rf go-game-public
            print_info "Stara instalacja usuniƒôta"
        else
            print_error "Nie uda≈Ço siƒô utworzyƒá backupu!"
            return 1
        fi
    fi
    
    return 0
}

# Pobierz PUBLICZNY adres IP
get_public_ip() {
    print_info "Pobieranie publicznego adresu IP..."
    
    # Lista serwis√≥w do sprawdzenia IP
    local services=(
        "https://ifconfig.me/ip"
        "https://api.ipify.org"
        "https://checkip.amazonaws.com"
        "https://icanhazip.com"
        "https://ipecho.net/plain"
        "https://ident.me"
    )
    
    local ip=""
    
    for service in "${services[@]}"; do
        print_debug "Pr√≥ba pobrania z: $service"
        ip=$(curl -s --max-time 5 "$service" 2>/dev/null | tr -d '[:space:]')
        
        # Walidacja IP
        if [[ -n "$ip" && "$ip" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ && "$ip" != "127.0.0.1" ]]; then
            print_success "Publiczny IP uzyskany z $service: $ip"
            break
        fi
        
        ip=""
    done
    
    # Fallback na lokalny IP
    if [ -z "$ip" ]; then
        print_warning "Nie uda≈Ço siƒô pobraƒá publicznego IP, u≈ºywam lokalnego..."
        
        # Spr√≥buj r√≥≈ºne metody uzyskania lokalnego IP
        ip=$(hostname -I 2>/dev/null | awk '{print $1}')
        [ -z "$ip" ] && ip=$(ip route get 1 2>/dev/null | awk '{print $7; exit}')
        [ -z "$ip" ] && ip=$(ip addr show 2>/dev/null | grep -oP 'inet \K[\d.]+' | grep -v '127.0.0.1' | head -1)
        [ -z "$ip" ] && ip="localhost"
        
        print_warning "U≈ºywam lokalnego adresu: $ip"
        print_warning "UWAGA: Platforma mo≈ºe nie byƒá dostƒôpna publicznie!"
    fi
    
    echo "$ip"
}

# Otw√≥rz porty w firewall
open_ports() {
    local ports=("$@")
    
    print_info "Konfiguracja firewalla..."
    
    # Sprawd≈∫ dostƒôpne narzƒôdzia firewall
    if command -v ufw >/dev/null 2>&1; then
        # UFW (Ubuntu/Debian)
        print_info "Wykryto UFW, konfigurujƒô porty..."
        
        for port in "${ports[@]}"; do
            if ! ufw status | grep -q "$port/tcp"; then
                print_info "Otwieram port $port w UFW..."
                ufw allow "$port/tcp" >/dev/null 2>&1
                if [ $? -eq 0 ]; then
                    print_success "Port $port otwarty w UFW"
                else
                    print_warning "Nie uda≈Ço siƒô otworzyƒá portu $port w UFW"
                fi
            else
                print_debug "Port $port ju≈º otwarty w UFW"
            fi
        done
        
        # W≈ÇƒÖcz firewall je≈õli nieaktywny
        if ! ufw status | grep -q "Status: active"; then
            print_info "Aktywujƒô UFW..."
            echo "y" | ufw --force enable >/dev/null 2>&1
        fi
        
    elif command -v firewall-cmd >/dev/null 2>&1; then
        # firewalld (CentOS/RHEL)
        print_info "Wykryto firewalld, konfigurujƒô porty..."
        
        for port in "${ports[@]}"; do
            if ! firewall-cmd --list-ports | grep -q "$port/tcp"; then
                print_info "Otwieram port $port w firewalld..."
                firewall-cmd --permanent --add-port="$port/tcp" >/dev/null 2>&1
                if [ $? -eq 0 ]; then
                    print_success "Port $port otwarty w firewalld"
                else
                    print_warning "Nie uda≈Ço siƒô otworzyƒá portu $port w firewalld"
                fi
            else
                print_debug "Port $port ju≈º otwarty w firewalld"
            fi
        done
        
        firewall-cmd --reload >/dev/null 2>&1
        print_success "Firewalld zreloadowany"
        
    elif command -v iptables >/dev/null 2>&1; then
        # iptables (og√≥lny Linux)
        print_info "Wykryto iptables, konfigurujƒô porty..."
        
        for port in "${ports[@]}"; do
            print_info "Otwieram port $port w iptables..."
            iptables -A INPUT -p tcp --dport "$port" -j ACCEPT >/dev/null 2>&1
            if [ $? -eq 0 ]; then
                print_success "Port $port otwarty w iptables"
            else
                print_warning "Nie uda≈Ço siƒô otworzyƒá portu $port w iptables"
            fi
        done
        
        # Zapisz regu≈Çy je≈õli iptables-persistent jest dostƒôpny
        if command -v iptables-save >/dev/null 2>&1 && [ -d "/etc/iptables" ]; then
            iptables-save > /etc/iptables/rules.v4
            print_info "Regu≈Çy iptables zapisane"
        fi
        
    else
        print_warning "Nie znaleziono narzƒôdzia firewall, pomijam konfiguracjƒô port√≥w"
        print_warning "UWAGA: Porty mogƒÖ byƒá zamkniƒôte w zaporze!"
    fi
}

# Sprawd≈∫ czy port jest dostƒôpny z zewnƒÖtrz
test_port_public() {
    local ip=$1
    local port=$2
    
    print_debug "Testowanie portu $ip:$port..."
    
    # R√≥≈ºne metody testowania port√≥w
    if command -v nc >/dev/null 2>&1; then
        # U≈ºyj netcat
        timeout 5 bash -c "echo > /dev/tcp/$ip/$port" 2>/dev/null
        local result=$?
        [ $result -eq 0 ] && print_debug "Port $port dostƒôpny (netcat)" || print_debug "Port $port niedostƒôpny (netcat)"
        return $result
        
    elif command -v telnet >/dev/null 2>&1; then
        # U≈ºyj telnet
        timeout 5 telnet "$ip" "$port" 2>&1 | grep -q "Connected"
        local result=$?
        [ $result -eq 0 ] && print_debug "Port $port dostƒôpny (telnet)" || print_debug "Port $port niedostƒôpny (telnet)"
        return $result
        
    else
        # Fallback - za≈Ç√≥≈ºmy ≈ºe port jest dostƒôpny
        print_debug "Brak narzƒôdzi do testowania port√≥w, zak≈Çadam dostƒôpno≈õƒá"
        return 0
    fi
}

# Sprawd≈∫ wymagania systemowe
check_system_requirements() {
    print_info "Sprawdzanie wymaga≈Ñ systemowych..."
    
    local errors=0
    
    # Sprawd≈∫ dostƒôpno≈õƒá pamiƒôci
    local free_memory=$(free -m 2>/dev/null | awk '/Mem:/ {print $2}')
    if [ -n "$free_memory" ] && [ "$free_memory" -lt 1024 ]; then
        print_warning "Ma≈Ço pamiƒôci RAM: ${free_memory}MB (wymagane min. 1GB)"
        ((errors++))
    else
        print_success "Pamiƒôƒá RAM: ${free_memory}MB"
    fi
    
    # Sprawd≈∫ dostƒôpno≈õƒá miejsca na dysku
    local free_disk=$(df -m . | awk 'NR==2 {print $4}')
    if [ -n "$free_disk" ] && [ "$free_disk" -lt 512 ]; then
        print_warning "Ma≈Ço miejsca na dysku: ${free_disk}MB (wymagane min. 512MB)"
        ((errors++))
    else
        print_success "Miejsce na dysku: ${free_disk}MB"
    fi
    
    # Sprawd≈∫ wersjƒô kernela
    local kernel_version=$(uname -r)
    print_info "Wersja kernela: $kernel_version"
    
    if [ $errors -gt 0 ]; then
        print_warning "Wykryto problemy z wymaganiami systemowymi"
        return 1
    fi
    
    print_success "Wymagania systemowe spe≈Çnione"
    return 0
}

# Instalacja Docker
install_docker() {
    print_info "Sprawdzanie instalacji Docker..."
    
    if command -v docker &> /dev/null; then
        print_success "Docker jest ju≈º zainstalowany"
        return 0
    fi
    
    print_info "Instalacja Docker..."
    
    # Sprawd≈∫ dystrybucjƒô
    if [ -f /etc/os-release ]; then
        . /etc/os-release
        local os=$ID
    else
        print_error "Nie mo≈ºna okre≈õliƒá dystrybucji Linux"
        return 1
    fi
    
    case $os in
        ubuntu|debian)
            print_info "Instalacja Docker dla Ubuntu/Debian..."
            apt-get update
            apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release
            curl -fsSL https://download.docker.com/linux/$os/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
            echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/$os $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
            apt-get update
            apt-get install -y docker-ce docker-ce-cli containerd.io
            ;;
        centos|rhel|fedora)
            print_info "Instalacja Docker dla CentOS/RHEL/Fedora..."
            yum install -y yum-utils
            yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
            yum install -y docker-ce docker-ce-cli containerd.io
            ;;
        *)
            print_warning "Nierozpoznana dystrybucja, u≈ºywam universal install script..."
            curl -fsSL https://get.docker.com -o get-docker.sh
            sh get-docker.sh
            rm get-docker.sh
            ;;
    esac
    
    # Uruchom i w≈ÇƒÖcz Docker
    systemctl start docker
    systemctl enable docker
    
    # Sprawd≈∫ czy Docker dzia≈Ça
    if docker info >/dev/null 2>&1; then
        print_success "Docker zainstalowany i uruchomiony pomy≈õlnie"
        return 0
    else
        print_error "Docker nie uruchomi≈Ç siƒô poprawnie"
        return 1
    fi
}

# Instalacja docker-compose
install_docker_compose() {
    print_info "Sprawdzanie instalacji Docker Compose..."
    
    if command -v docker-compose &> /dev/null; then
        print_success "Docker Compose jest ju≈º zainstalowany"
        return 0
    fi
    
    print_info "Instalacja Docker Compose..."
    
    # Pobierz najnowszƒÖ wersjƒô
    local latest_version=$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
    
    if [ -z "$latest_version" ]; then
        latest_version="v2.20.0" # Fallback version
        print_warning "Nie uda≈Ço siƒô pobraƒá najnowszej wersji, u≈ºywam $latest_version"
    fi
    
    print_info "Pobieranie Docker Compose $latest_version..."
    
    curl -L "https://github.com/docker/compose/releases/download/$latest_version/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    chmod +x /usr/local/bin/docker-compose
    
    # Utw√≥rz link symboliczny je≈õli potrzebny
    if [ ! -f /usr/bin/docker-compose ]; then
        ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose 2>/dev/null || true
    fi
    
    if docker-compose --version &>/dev/null; then
        print_success "Docker Compose zainstalowany pomy≈õlnie"
        return 0
    else
        print_error "Docker Compose nie zainstalowa≈Ç siƒô poprawnie"
        return 1
    fi
}

# G≈Ç√≥wna funkcja instalacji
install_go_game() {
    clear
    echo -e "${PURPLE}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           GO GAME - PUBLIC DASHBOARD v11.0        ‚ïë"
    echo "‚ïë           Enhanced with Backup & Validation       ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    # Ustawienie port√≥w
    local FRONTEND_PORT=19210
    local BACKEND_PORT=19211
    local DB_PORT=19212
    local REDIS_PORT=19213
    local PORTS=($FRONTEND_PORT $BACKEND_PORT $DB_PORT $REDIS_PORT)
    
    print_header "Rozpoczynanie instalacji GO Game Public Platform..."
    
    # 1. Konfiguracja logowania
    setup_logging
    
    # 2. Sprawd≈∫ zale≈ºno≈õci
    if ! check_dependencies; then
        print_error "BrakujƒÖce zale≈ºno≈õci, instalacja przerwana"
        exit 1
    fi
    
    # 3. Sprawd≈∫ wymagania systemowe
    check_system_requirements
    
    # 4. Sprawd≈∫ porty
    if ! check_ports_availability "${PORTS[@]}"; then
        print_error "Niekt√≥re porty sƒÖ zajƒôte, instalacja przerwana"
        exit 1
    fi
    
    # 5. Backup istniejƒÖcej instalacji
    if ! backup_existing; then
        print_error "Problem z backupem, instalacja przerwana"
        exit 1
    fi
    
    # 6. Pobierz PUBLICZNY adres IP
    print_info "Wykrywanie adresu IP..."
    SERVER_IP=$(get_public_ip)
    
    print_success "Adres serwera: $SERVER_IP"
    print_info "Konfiguracja port√≥w:"
    print_info "Frontend port: $FRONTEND_PORT"
    print_info "Backend port: $BACKEND_PORT"
    print_info "Database port: $DB_PORT"
    print_info "Redis port: $REDIS_PORT"
    
    # 7. Otw√≥rz porty w firewall
    open_ports "${PORTS[@]}"
    
    # 8. Instalacja Docker
    if ! install_docker; then
        print_error "Instalacja Docker nie powiod≈Ça siƒô"
        exit 1
    fi
    
    # 9. Instalacja docker-compose
    if ! install_docker_compose; then
        print_error "Instalacja Docker Compose nie powiod≈Ça siƒô"
        exit 1
    fi
    
    # 10. Tworzenie struktury projektu
    print_info "Tworzenie struktury projektu..."
    mkdir -p go-game-public/{frontend,backend,database,scripts,logs,nginx,backups}
    
    # 11. docker-compose.yml
    print_info "Konfiguracja Docker Compose..."
    cat > go-game-public/docker-compose.yml << EOF
version: '3.8'
services:
  frontend:
    image: node:18-alpine
    working_dir: /app
    volumes:
      - ./frontend:/app
      - ./logs/frontend:/app/logs
    ports:
      - "0.0.0.0:$FRONTEND_PORT:8080"
    command: sh -c "npm install && node server.js"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - go-game-network

  backend:
    image: node:18-alpine  
    working_dir: /app
    volumes:
      - ./backend:/app
      - ./logs/backend:/app/logs
    ports:
      - "0.0.0.0:$BACKEND_PORT:3001"
    command: sh -c "npm install && node server.js"
    restart: unless-stopped
    depends_on:
      - postgres
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - go-game-network

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=gogame
      - POSTGRES_USER=gogame
      - POSTGRES_PASSWORD=gogame123
    ports:
      - "0.0.0.0:$DB_PORT:5432"
    volumes:
      - ./database/postgres:/var/lib/postgresql/data
      - ./logs/postgres:/var/log/postgresql
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U gogame -d gogame"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - go-game-network

  redis:
    image: redis:7-alpine
    ports:
      - "0.0.0.0:$REDIS_PORT:6379"
    volumes:
      - ./database/redis:/data
      - ./logs/redis:/var/log/redis
    restart: unless-stopped
    command: redis-server --appendonly yes --bind 0.0.0.0
    networks:
      - go-game-network

  nginx:
    image: nginx:alpine
    ports:
      - "0.0.0.0:80:80"
      - "0.0.0.0:443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - frontend
      - backend
    restart: unless-stopped
    networks:
      - go-game-network

networks:
  go-game-network:
    driver: bridge
    name: go-game-network
EOF

    # 12. Frontend z PUBLICZNYM IP
    print_info "Tworzenie frontendu z publicznym dostƒôpem..."
    
    cat > go-game-public/frontend/package.json << 'EOF'
{
  "name": "go-game-frontend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node server.js",
    "dev": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.0",
    "cors": "^2.8.5",
    "axios": "^1.3.0"
  }
}
EOF

    cat > go-game-public/frontend/server.js << EOF
const express = require('express');
const cors = require('cors');
const app = express();
const PORT = 8080;

app.use(cors());
app.use(express.json());
app.use(express.static('public'));

app.get('/health', (req, res) => {
  res.json({ 
    status: 'healthy', 
    service: 'frontend', 
    port: PORT,
    public_url: 'http://$SERVER_IP:$FRONTEND_PORT',
    timestamp: new Date().toISOString()
  });
});

app.get('/', (req, res) => {
  res.send(`
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GO Game - Public Platform v11.0</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(15, 52, 96, 0.9);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 2rem;
            border: 2px solid #e94560;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .logo {
            font-size: 3rem;
            font-weight: bold;
            color: #e94560;
            margin-bottom: 1rem;
        }
        
        .version {
            background: #805ad5;
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 0.5rem;
        }
        
        .public-badge {
            background: #48bb78;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            display: inline-block;
            margin: 0.5rem 0;
        }
        
        .url-display {
            background: rgba(0,0,0,0.3);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            border: 2px solid #48bb78;
            font-size: 1.2rem;
            text-align: center;
            word-break: break-all;
        }
        
        .btn {
            background: #e94560;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            margin: 0.5rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #d63a54;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 69, 96, 0.4);
        }
        
        .btn-success {
            background: #48bb78;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .info-panel {
            background: rgba(15, 52, 96, 0.8);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border-left: 5px solid #e94560;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .game-card {
            background: rgba(45, 55, 72, 0.9);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid #4a5568;
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            border-color: #e94560;
            box-shadow: 0 10px 25px rgba(229, 69, 96, 0.2);
        }
        
        .game-title {
            color: #e94560;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }
        
        .game-price {
            font-size: 1.5rem;
            color: #48bb78;
            font-weight: bold;
            margin: 1rem 0;
        }
        
        .access-info {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid #e94560;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .backup-info {
            background: rgba(106, 90, 205, 0.2);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid #6a5acd;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 1.5rem;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .url-display {
                font-size: 1rem;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="version">v11.0 ENHANCED</div>
            <div class="logo">üéÆ GO GAME PUBLIC</div>
            <div class="public-badge">üåê PUBLICZNY DOSTƒòP</div>
            <p>Platforma dostƒôpna z ca≈Çego ≈õwiata</p>
        </div>

        <!-- Public URL -->
        <div class="info-panel">
            <h2>üåç Publiczny Adres Platformy</h2>
            <div class="url-display">
                http://$SERVER_IP:$FRONTEND_PORT
            </div>
            <p style="text-align: center; margin-top: 1rem;">
                <strong>Ten adres dzia≈Ça z ka≈ºdego miejsca na ≈õwiecie!</strong>
            </p>
            <div style="text-align: center; margin-top: 1rem;">
                <button class="btn btn-success" onclick="copyUrl()">üìã Kopiuj Adres</button>
                <button class="btn" onclick="testAccess()">üöÄ Testuj Dostƒôp</button>
                <button class="btn" onclick="openInNewTab()">üîó Otw√≥rz Teraz</button>
            </div>
        </div>

        <!-- Backup Info -->
        <div class="backup-info">
            <h3>üíæ System Backupu</h3>
            <p>Twoja instalacja jest automatycznie backupowana. Wszystkie pliki konfiguracyjne sƒÖ zabezpieczone.</p>
        </div>

        <!-- Access Information -->
        <div class="access-info">
            <h2>üì° Informacje o Dostƒôpie</h2>
            <div class="status-item">
                <span>Publiczny adres:</span>
                <strong>http://$SERVER_IP:$FRONTEND_PORT</strong>
            </div>
            <div class="status-item">
                <span>Status portu:</span>
                <strong style="color: #48bb78;">üü¢ OTWARTY</strong>
            </div>
            <div class="status-item">
                <span>Dostƒôp z:</span>
                <strong>üåç Ca≈Çy ≈õwiat</strong>
            </div>
            <div class="status-item">
                <span>Port frontend:</span>
                <strong>$FRONTEND_PORT</strong>
            </div>
            <div class="status-item">
                <span>Port backend:</span>
                <strong>$BACKEND_PORT</strong>
            </div>
            <div class="status-item">
                <span>Admin panel:</span>
                <strong>kacpros</strong>
            </div>
            <div class="status-item">
                <span>Wersja:</span>
                <strong>11.0 Enhanced</strong>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="info-panel">
            <h2>üëë Panel Administratora</h2>
            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                <strong>U≈ºytkownik:</strong> kacpros<br>
                <strong>Rola:</strong> W≈Ça≈õciciel<br>
                <strong>Publiczny URL:</strong> http://$SERVER_IP:$FRONTEND_PORT<br>
                <strong>Data uruchomienia:</strong> <span id="start-time"></span><br>
                <strong>Wersja:</strong> 11.0 Enhanced
            </div>
            <button class="btn" onclick="showAdminPanel()">Otw√≥rz Panel Admina</button>
        </div>

        <!-- Games -->
        <h2>üéÆ Dostƒôpne Gry</h2>
        <div class="games-grid">
            <div class="game-card">
                <div class="game-title">Cyber Revolution 2077</div>
                <p>Immersywna gra RPG w cyberpunkowym ≈õwiecie przysz≈Ço≈õci.</p>
                <div class="game-price">59.99 PLN</div>
                <button class="btn" onclick="addToCart('Cyber Revolution 2077')">Dodaj do Koszyka</button>
            </div>
            
            <div class="game-card">
                <div class="game-title">Forest Adventures</div>
                <p>Przygodowa gra eksploracyjna w magicznym lesie.</p>
                <div class="game-price">39.99 PLN</div>
                <button class="btn" onclick="addToCart('Forest Adventures')">Dodaj do Koszyka</button>
            </div>
            
            <div class="game-card">
                <div class="game-title">Space Command</div>
                <p>Kosmiczna gra strategiczna z epickimi bitwami.</p>
                <div class="game-price">49.99 PLN</div>
                <button class="btn" onclick="addToCart('Space Command')">Dodaj do Koszyka</button>
            </div>
        </div>

        <!-- Quick Access -->
        <div style="text-align: center; margin: 3rem 0;">
            <h2>‚ö° Szybki Dostƒôp</h2>
            <button class="btn btn-success" style="padding: 1.2rem 2.5rem; font-size: 1.2rem;" onclick="openInNewTab()">
                üåê Otw√≥rz Platformƒô
            </button>
            <p style="margin-top: 1rem; color: #cbd5e0;">
                Adres: http://$SERVER_IP:$FRONTEND_PORT
            </p>
        </div>
    </div>

    <script>
        // Ustaw czas startu
        document.getElementById('start-time').textContent = new Date().toLocaleString();
        
        function copyUrl() {
            const url = 'http://$SERVER_IP:$FRONTEND_PORT';
            navigator.clipboard.writeText(url).then(() => {
                alert('‚úÖ Adres skopiowany do schowka!\\n' + url + '\\n\\nWersja: 11.0 Enhanced');
            });
        }
        
        function openInNewTab() {
            const url = 'http://$SERVER_IP:$FRONTEND_PORT';
            window.open(url, '_blank');
        }
        
        function testAccess() {
            const url = 'http://$SERVER_IP:$FRONTEND_PORT/health';
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    alert('‚úÖ Test dostƒôpu udany!\\nPlatforma jest publicznie dostƒôpna.\\n\\nPubliczny URL:\\nhttp://$SERVER_IP:$FRONTEND_PORT\\nWersja: 11.0 Enhanced');
                })
                .catch(error => {
                    alert('‚ö†Ô∏è Problem z dostƒôpem publicznym.\\nSprawd≈∫ konfiguracjƒô sieci.\\nB≈ÇƒÖd: ' + error.message);
                });
        }
        
        function showAdminPanel() {
            const adminInfo = 
                'üëë Publiczny Panel Administratora v11.0\\n\\n' +
                'U≈ºytkownik: kacpros\\n' +
                'Rola: W≈Ça≈õciciel\\n' +
                'Publiczny URL: http://$SERVER_IP:$FRONTEND_PORT\\n' +
                'Porty: $FRONTEND_PORT (front), $BACKEND_PORT (back)\\n' +
                'Wersja: 11.0 Enhanced\\n\\n' +
                'Platforma jest publicznie dostƒôpna! üåç';
                
            alert(adminInfo);
        }
        
        function addToCart(gameName) {
            alert('üõí Dodano do koszyka: ' + gameName + '\\n\\nPlatforma publicznie dostƒôpna!\\nWersja: 11.0 Enhanced');
        }
        
        // Logowanie informacji
        console.log('üéÆ GO Game Public Platform v11.0');
        console.log('üåç Public URL: http://$SERVER_IP:$FRONTEND_PORT');
        console.log('üîß Backend: http://$SERVER_IP:$BACKEND_PORT');
        console.log('üëë Admin: kacpros');
        console.log('üöÄ Platforma publicznie dostƒôpna!');
        console.log('üíæ System backupu aktywny');
        
        // Automatyczny test dostƒôpu przy starcie
        setTimeout(testAccess, 1000);
        
        // Poka≈º powitanie
        setTimeout(() => {
            alert('üåç GO GAME PUBLIC PLATFORM v11.0\\n\\n' +
                  'Platforma jest teraz publicznie dostƒôpna!\\n' +
                  'Adres: http://$SERVER_IP:$FRONTEND_PORT\\n' +
                  'Wersja: 11.0 Enhanced\\n\\n' +
                  'Mo≈ºesz udostƒôpniƒá ten adres innym u≈ºytkownikom.');
        }, 500);
    </script>
</body>
</html>
  `);
});

app.listen(PORT, '0.0.0.0', () => {
  console.log('=========================================');
  console.log('üéÆ GO GAME PUBLIC PLATFORM v11.0');
  console.log('=========================================');
  console.log('üåç Public URL: http://$SERVER_IP:$FRONTEND_PORT');
  console.log('üîß Backend:    http://$SERVER_IP:$BACKEND_PORT');
  console.log('üóÑÔ∏è  Database:   $SERVER_IP:$DB_PORT');
  console.log('üëë Admin:      kacpros');
  console.log('üíæ Backup:     Aktywny');
  console.log('üöÄ Status:     Publicznie dostƒôpna!');
  console.log('=========================================');
});
EOF

    # 13. Backend
    print_info "Tworzenie backendu z publicznym dostƒôpem..."
    
    cat > go-game-public/backend/package.json << 'EOF'
{
  "name": "go-game-backend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.0",
    "cors": "^2.8.5",
    "pg": "^8.8.0",
    "redis": "^4.6.4"
  }
}
EOF

    cat > go-game-public/backend/server.js << EOF
const express = require('express');
const cors = require('cors');
const app = express();
const PORT = 3001;

app.use(cors());
app.use(express.json());

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ 
    status: 'healthy',
    service: 'go-game-backend',
    port: PORT,
    public_url: 'http://$SERVER_IP:$BACKEND_PORT',
    server_ip: '$SERVER_IP',
    timestamp: new Date().toISOString(),
    access: 'public',
    version: '11.0'
  });
});

// Public API Games
app.get('/api/games', (req, res) => {
  res.json([
    {
      id: 1,
      title: "Cyber Revolution 2077",
      price: 59.99,
      description: "Immersywna gra RPG w cyberpunkowym ≈õwiecie przysz≈Ço≈õci",
      image: "/images/cyber-revolution.jpg",
      rating: 4.8,
      public: true
    },
    {
      id: 2, 
      title: "Forest Adventures",
      price: 39.99,
      description: "Przygodowa gra eksploracyjna w magicznym lesie",
      image: "/images/forest-adventures.jpg",
      rating: 4.5,
      public: true
    },
    {
      id: 3,
      title: "Space Command", 
      price: 49.99,
      description: "Kosmiczna gra strategiczna z epickimi bitwami",
      image: "/images/space-command.jpg",
      rating: 4.7,
      public: true
    }
  ]);
});

// Public user info
app.get('/api/user/:discordId', (req, res) => {
  const { discordId } = req.params;
  
  if (discordId === 'kacpros') {
    res.json({
      username: 'kacpros',
      role: 'owner',
      permissions: ['all'],
      public_access: true,
      version: '11.0',
      server_info: {
        public_ip: '$SERVER_IP',
        frontend_port: $FRONTEND_PORT,
        backend_port: $BACKEND_PORT,
        status: 'public'
      }
    });
  } else {
    res.json({
      username: discordId,
      role: 'user', 
      permissions: ['basic'],
      public_access: true,
      version: '11.0',
      joinDate: new Date().toISOString().split('T')[0]
    });
  }
});

// Public admin stats
app.get('/api/admin/public-stats', (req, res) => {
  res.json({
    platform: 'GO Game Public Platform',
    version: '11.0',
    status: 'public',
    public_url: 'http://$SERVER_IP:$FRONTEND_PORT',
    ports: {
      frontend: $FRONTEND_PORT,
      backend: $BACKEND_PORT,
      database: $DB_PORT,
      redis: $REDIS_PORT
    },
    server: {
      ip: '$SERVER_IP',
      access: 'public'
    },
    admin: 'kacpros',
    features: ['backup', 'validation', 'logging', 'healthcheck'],
    uptime: process.uptime(),
    timestamp: new Date().toISOString()
  });
});

app.listen(PORT, '0.0.0.0', () => {
  console.log('=========================================');
  console.log('üîß GO GAME PUBLIC BACKEND v11.0');
  console.log('=========================================');
  console.log('üåç Public URL: http://$SERVER_IP:$BACKEND_PORT');
  console.log('üëë Admin: kacpros');
  console.log('üíæ Backup: Active');
  console.log('‚úÖ Backend publicznie dostƒôpny!');
  console.log('=========================================');
});
EOF

    # 14. Konfiguracja Nginx
    cat > go-game-public/nginx/nginx.conf << 'EOF'
events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Basic Settings
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # Logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Gzip Settings
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Upstreams
    upstream frontend {
        server frontend:8080;
        keepalive 32;
    }

    upstream backend {
        server backend:3001;
        keepalive 32;
    }

    # Public HTTP Server
    server {
        listen 80;
        listen [::]:80;
        server_name _;
        
        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "no-referrer-when-downgrade" always;
        add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

        # Frontend
        location / {
            proxy_pass http://frontend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }

        # Backend API
        location /api/ {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
        }

        # WebSocket support
        location /ws/ {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_read_timeout 86400;
        }

        # Health checks
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}
EOF

    # 15. Skrypty zarzƒÖdzania
    print_info "Tworzenie zaawansowanych skrypt√≥w zarzƒÖdzania..."
    
    cat > go-game-public/start.sh << EOF
#!/bin/bash

# Kolory
GREEN='\\033[0;32m'
RED='\\033[0;31m'
BLUE='\\033[0;34m'
NC='\\033[0m'

echo -e "\${BLUE}üöÄ Uruchamianie GO Game Public Platform v11.0...\${NC}"
echo ""

# Sprawd≈∫ czy Docker dzia≈Ça
if ! docker info > /dev/null 2>&1; then
    echo -e "\${RED}‚ùå Docker nie jest uruchomiony!\${NC}"
    echo "   Uruchom: sudo systemctl start docker"
    exit 1
fi

cd go-game-public

echo -e "\${BLUE}üì¶ Uruchamianie kontener√≥w Docker...\${NC}"
docker-compose up -d

echo ""
echo -e "\${BLUE}‚è≥ Oczekiwanie na uruchomienie us≈Çug...\${NC}"
sleep 20

# Sprawd≈∫ status
echo ""
echo -e "\${BLUE}üìä Status us≈Çug:\${NC}"
docker-compose ps

# Test publicznego dostƒôpu
echo ""
echo -e "\${BLUE}üîç Testowanie publicznego dostƒôpu...\${NC}"

if curl -s --max-time 10 "http://localhost:$FRONTEND_PORT/health" > /dev/null; then
    echo -e "\${GREEN}‚úÖ Frontend dzia≈Ça poprawnie\${NC}"
else
    echo -e "\${RED}‚ö†Ô∏è Frontend mo≈ºe mieƒá problemy\${NC}"
fi

if curl -s --max-time 10 "http://localhost:$BACKEND_PORT/health" > /dev/null; then
    echo -e "\${GREEN}‚úÖ Backend dzia≈Ça poprawnie\${NC}"
else
    echo -e "\${RED}‚ö†Ô∏è Backend mo≈ºe mieƒá problemy\${NC}"
fi

echo ""
echo -e "\${GREEN}===========================================\${NC}"
echo -e "\${GREEN}üéÆ GO GAME PUBLIC PLATFORM - URUCHOMIONA!\${NC}"
echo -e "\${GREEN}===========================================\${NC}"
echo -e "\${BLUE}üåç Publiczny URL: http://$SERVER_IP:$FRONTEND_PORT\${NC}"
echo -e "\${BLUE}üîß Backend API:   http://$SERVER_IP:$BACKEND_PORT\${NC}"
echo -e "\${BLUE}üóÑÔ∏è  Database:      $SERVER_IP:$DB_PORT\${NC}"
echo -e "\${BLUE}üëë Admin:         kacpros\${NC}"
echo -e "\${BLUE}üíæ Wersja:        11.0 Enhanced\${NC}"
echo -e "\${GREEN}===========================================\${NC}"
echo ""
echo -e "\${GREEN}üí° Platforma jest teraz PUBLICZNIE DOSTƒòPNA!\${NC}"
echo "   Mo≈ºesz udostƒôpniƒá ten adres:"
echo -e "   \${BLUE}http://$SERVER_IP:$FRONTEND_PORT\${NC}"
echo ""
echo -e "\${BLUE}üîß ZarzƒÖdzanie:\${NC}"
echo "   ‚Ä¢ Sprawd≈∫ status: ./status.sh"
echo "   ‚Ä¢ Zobacz logi: ./logs.sh"
echo "   ‚Ä¢ Zatrzymaj: ./stop.sh"
echo "   ‚Ä¢ Backup: ./backup.sh"
echo ""
EOF

    cat > go-game-public/stop.sh << 'EOF'
#!/bin/bash
echo "üõë Zatrzymywanie GO Game Public Platform..."
cd go-game-public
docker-compose down
echo "‚úÖ Platforma zatrzymana!"
EOF

    cat > go-game-public/restart.sh << 'EOF'
#!/bin/bash
echo "üîÅ Restartowanie GO Game Public Platform..."
cd go-game-public
docker-compose restart
echo "‚úÖ Platforma zrestartowana!"
EOF

    cat > go-game-public/logs.sh << 'EOF'
#!/bin/bash
echo "üìã Logi GO Game Public Platform:"
cd go-game-public
docker-compose logs -f
EOF

    cat > go-game-public/status.sh << EOF
#!/bin/bash
echo "üìä Status GO Game Public Platform v11.0:"
cd go-game-public
docker-compose ps

echo ""
echo "üåç Publiczne Adresy Dostƒôpu:"
echo "   Frontend:  http://$SERVER_IP:$FRONTEND_PORT"
echo "   Backend:   http://$SERVER_IP:$BACKEND_PORT"
echo "   Database:  $SERVER_IP:$DB_PORT"
echo "   Redis:     $SERVER_IP:$REDIS_PORT"
echo "   HTTP:      http://$SERVER_IP:80"
echo ""
echo "üëë Administrator: kacpros"
echo "üè† Serwer: $SERVER_IP"
echo "üîß Porty: $FRONTEND_PORT, $BACKEND_PORT, $DB_PORT, $REDIS_PORT"
echo "üíæ Wersja: 11.0 Enhanced"
echo "üìÖ Data instalacji: $(date)"
echo ""
echo "üí° Platforma jest PUBLICZNIE DOSTƒòPNA!"
echo "   Udostƒôpnij: http://$SERVER_IP:$FRONTEND_PORT"
EOF

    cat > go-game-public/backup.sh << 'EOF'
#!/bin/bash
echo "üíæ Tworzenie backupu GO Game Public Platform..."

BACKUP_DIR="backups"
BACKUP_NAME="go-game-backup-$(date +%Y%m%d-%H%M%S)"
BACKUP_PATH="$BACKUP_DIR/$BACKUP_NAME"

mkdir -p "$BACKUP_PATH"

# Skopiuj wszystkie wa≈ºne pliki
cp -r docker-compose.yml frontend backend nginx database scripts "$BACKUP_PATH/" 2>/dev/null || true

# Stw√≥rz archiwum
tar -czf "$BACKUP_PATH.tar.gz" "$BACKUP_PATH" 2>/dev/null && rm -rf "$BACKUP_PATH"

if [ $? -eq 0 ]; then
    echo "‚úÖ Backup utworzony: $BACKUP_PATH.tar.gz"
    echo "üìÅ Lokalizacja: $BACKUP_DIR/"
else
    echo "‚ùå B≈ÇƒÖd podczas tworzenia backupu!"
    exit 1
fi

# Pokaz listƒô backup√≥w
echo ""
echo "üìã Lista dostƒôpnych backup√≥w:"
ls -la "$BACKUP_DIR/" | grep go-game-backup
EOF

    # Nadawanie uprawnie≈Ñ
    chmod +x go-game-public/*.sh

    print_success "‚úÖ GO Game Public Platform v11.0 gotowa!"
    echo ""
    echo "üìÅ Projekt: ./go-game-public/"
    echo ""
    echo "üöÄ Uruchomienie:"
    echo "   ./go-game-public/start.sh"
    echo ""
    echo "üåç PUBLICZNY ADRES:"
    echo "   http://$SERVER_IP:$FRONTEND_PORT"
    echo ""
    echo "üîß Porty otwarte:"
    echo "   ‚Ä¢ 19210 - Frontend (g≈Ç√≥wna platforma)"
    echo "   ‚Ä¢ 19211 - Backend (API)"
    echo "   ‚Ä¢ 19212 - PostgreSQL (baza danych)"
    echo "   ‚Ä¢ 19213 - Redis (cache)"
    echo "   ‚Ä¢ 80    - HTTP (nginx)"
    echo ""
    echo "üíæ Nowe funkcje v11.0:"
    echo "   ‚úÖ System backupu automatycznego"
    echo "   ‚úÖ Walidacja port√≥w i zale≈ºno≈õci"
    echo "   ‚úÖ Logowanie ca≈Çej instalacji"
    echo "   ‚úÖ Sprawdzanie wymaga≈Ñ systemowych"
    echo "   ‚úÖ Lepsze zarzƒÖdzanie b≈Çƒôdami"
    echo ""
    print_success "üí° Platforma bƒôdzie PUBLICZNIE DOSTƒòPNA z ca≈Çego ≈õwiata!"
    echo ""
    print_info "Nastƒôpny krok: Uruchom './go-game-public/start.sh'"
    
    # Zapisz informacje o instalacji
    cat > go-game-public/INSTALL_INFO.txt << EOF
GO GAME PUBLIC PLATFORM v11.0 - INFORMACJE O INSTALACJI

Data instalacji: $(date)
Publiczny adres: http://$SERVER_IP:$FRONTEND_PORT
Porty:
  - Frontend: $FRONTEND_PORT
  - Backend: $BACKEND_PORT
  - Database: $DB_PORT
  - Redis: $REDIS_PORT

Administrator: kacpros
Wersja: 11.0 Enhanced

SKRYPTY ZARZƒÑDZANIA:
  ./start.sh    - Uruchom platformƒô
  ./stop.sh     - Zatrzymaj platformƒô
  ./restart.sh  - Restartuj platformƒô
  ./status.sh   - Status us≈Çug
  ./logs.sh     - Logi na ≈ºywo
  ./backup.sh   - Utw√≥rz backup

LOG INSTALACJI: $LOG_FILE

UWAGA: Platforma jest publicznie dostƒôpna pod adresem:
       http://$SERVER_IP:$FRONTEND_PORT
EOF

    print_success "üìÑ Informacje o instalacji zapisane w: go-game-public/INSTALL_INFO.txt"
}

# Funkcja czyszczenia w przypadku przerwania
cleanup() {
    print_error "Instalacja przerwana!"
    print_info "Czyszczenie..."
    exit 1
}

# Przechwyƒá sygna≈Çy przerwania
trap cleanup SIGINT SIGTERM

# Uruchom instalacjƒô
if [ "$1" = "--debug" ]; then
    set -x
fi

install_go_game
