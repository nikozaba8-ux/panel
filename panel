#!/bin/bash

# =============================================
# ğŸ¦– TWORZENIE PANELU WEB
# =============================================

# Konfiguracja
PANEL_DIR="/home/panel"
WEB_DIR="$PANEL_DIR/web"
PORT=8080

# Kolory
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# =============================================
# ğŸ› ï¸ FUNKCJE POMOCNICZE
# =============================================

log() {
    echo -e "${GREEN}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}

error() {
    echo -e "${RED}[BÅÄ„D]${NC} $1"
}

warning() {
    echo -e "${YELLOW}[OSTRZEÅ»ENIE]${NC} $1"
}

setup_directories() {
    mkdir -p "$PANEL_DIR" "$WEB_DIR"
    log "Katalogi utworzone"
}

check_dependencies() {
    echo -e "${YELLOW}ğŸ” Sprawdzanie zaleÅ¼noÅ›ci...${NC}"
    
    if ! command -v python3 &> /dev/null; then
        echo -e "${YELLOW}ğŸ“¦ Instalowanie Pythona 3...${NC}"
        apt update > /dev/null 2>&1
        apt install -y python3 > /dev/null 2>&1
    fi
    
    echo -e "${GREEN}âœ… Wszystkie zaleÅ¼noÅ›ci sÄ… dostÄ™pne${NC}"
}

# =============================================
# ğŸŒ TWORZENIE PANELU WEB
# =============================================

create_web_panel() {
    echo -e "${YELLOW}ğŸŒ TWORZENIE PANELU WEB...${NC}"
    
    # UtwÃ³rz gÅ‚Ã³wnÄ… stronÄ™
    cat > "$WEB_DIR/index.html" << 'HTML'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦– Panel SerwerÃ³w</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            color: #333;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .header h1 { 
            font-size: 2.5em; 
            color: #2d3748;
            margin-bottom: 10px;
        }
        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .feature-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid #4299e1;
        }
        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: #4299e1;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin: 10px 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
        .btn-success {
            background: #48bb78;
        }
        .btn-success:hover {
            background: #38a169;
        }
        .status-list {
            list-style: none;
            padding: 0;
        }
        .status-item {
            padding: 10px 15px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #48bb78;
        }
        .status-item.offline {
            border-left-color: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦– Panel SerwerÃ³w</h1>
            <p>Profesjonalne zarzÄ…dzanie serwerami gry</p>
        </div>

        <div class="success-box">
            <div style="font-size: 3em; margin-bottom: 15px;">âœ…</div>
            <h2 style="color: #276749; margin-bottom: 10px;">Panel zostaÅ‚ utworzony pomyÅ›lnie!</h2>
            <p style="font-size: 1.1em; color: #2d3748;">TwÃ³j panel web jest gotowy do uÅ¼ycia.</p>
        </div>

        <div class="info-box">
            <h3>ğŸ“Š Informacje o panelu:</h3>
            <ul class="status-list">
                <li class="status-item">ğŸŒ <strong>Adres panelu:</strong> http://localhost:8080</li>
                <li class="status-item">ğŸ“ <strong>Katalog panelu:</strong> /home/panel/web</li>
                <li class="status-item">âš¡ <strong>Status:</strong> <span style="color: #48bb78;">AKTYWNY</span></li>
                <li class="status-item">ğŸ”§ <strong>Wersja:</strong> 1.0</li>
            </ul>
        </div>

        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">ğŸ®</div>
                <h3>ZarzÄ…dzanie Serwerami</h3>
                <p>TwÃ³rz, uruchamiaj i zarzÄ…dzaj serwerami gry przez intuicyjny interfejs.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">ğŸ“Š</div>
                <h3>Monitorowanie w Czasie Rzeczywistym</h3>
                <p>ÅšledÅº statystyki serwerÃ³w, uÅ¼ycie zasobÃ³w i aktywnoÅ›Ä‡ graczy.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">âš™ï¸</div>
                <h3>Konfiguracja</h3>
                <p>Åatwa konfiguracja ustawieÅ„ serwera przez przeglÄ…darkÄ™.</p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn btn-success" onclick="showDemo()">ğŸš€ Zobacz Demo</button>
            <button class="btn" onclick="showHelp()">â“ Pomoc</button>
            <a href="/status" class="btn">ğŸ“Š Status Systemu</a>
        </div>

        <div id="demoSection" style="display: none; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
            <h3>ğŸ® Demo Panelu</h3>
            <p>To jest demonstracja dziaÅ‚ania panelu. W peÅ‚nej wersji tutaj bÄ™dzie:</p>
            <ul style="margin: 15px 0 15px 20px;">
                <li>Lista aktywnych serwerÃ³w</li>
                <li>Formularz tworzenia nowego serwera</li>
                <li>Statystyki uÅ¼ycia zasobÃ³w</li>
                <li>Panel zarzÄ…dzania uÅ¼ytkownikami</li>
            </ul>
            <button class="btn" onclick="hideDemo()">âœ–ï¸ Zamknij demo</button>
        </div>

        <div id="helpSection" style="display: none; margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 10px;">
            <h3>â“ Pomoc - Jak uÅ¼ywaÄ‡ panelu</h3>
            <h4>Adresy dostÄ™pu:</h4>
            <ul style="margin: 10px 0 20px 20px;">
                <li><strong>Local:</strong> http://localhost:8080</li>
                <li><strong>Z sieci:</strong> http://[TWÃ“J-IP]:8080</li>
            </ul>
            <h4>FunkcjonalnoÅ›ci:</h4>
            <ul style="margin: 10px 0 20px 20px;">
                <li>ZarzÄ…dzanie serwerami Minecraft, Rust, ARK i innych gier</li>
                <li>Monitorowanie zasobÃ³w systemowych</li>
                <li>Tworzenie kopii zapasowych</li>
                <li>ZarzÄ…dzanie uÅ¼ytkownikami</li>
            </ul>
            <button class="btn" onclick="hideHelp()">âœ–ï¸ Zamknij pomoc</button>
        </div>
    </div>

    <script>
        function showDemo() {
            document.getElementById('demoSection').style.display = 'block';
            document.getElementById('helpSection').style.display = 'none';
        }

        function hideDemo() {
            document.getElementById('demoSection').style.display = 'none';
        }

        function showHelp() {
            document.getElementById('helpSection').style.display = 'block';
            document.getElementById('demoSection').style.display = 'none';
        }

        function hideHelp() {
            document.getElementById('helpSection').style.display = 'none';
        }

        // Pokazuj informacje o przeglÄ…darce
        console.log('ğŸ¦– Panel SerwerÃ³w zaÅ‚adowany pomyÅ›lnie!');
        console.log('ğŸŒ Adres: http://localhost:8080');
        console.log('ğŸ“ Katalog: /home/panel/web');
    </script>
</body>
</html>
HTML

    # Strona statusu
    cat > "$WEB_DIR/status.html" << 'STATUS'
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Panelu</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            color: #333;
            padding: 20px;
        }
        .container { 
            max-width: 800px; 
            margin: 50px auto; 
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .header h1 { 
            font-size: 2.5em; 
            color: #2d3748;
            margin-bottom: 10px;
        }
        .status-grid {
            display: grid;
            gap: 15px;
            margin: 25px 0;
        }
        .status-item {
            padding: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .status-online { 
            background: #d4edda; 
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-offline { 
            background: #f8d7da; 
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-icon {
            font-size: 2em;
        }
        .status-info h3 {
            margin-bottom: 5px;
        }
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: #4299e1;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Status Systemu</h1>
            <p>Monitorowanie dziaÅ‚ania panelu serwerÃ³w</p>
        </div>

        <div class="status-grid">
            <div class="status-item status-online">
                <div class="status-icon">ğŸŒ</div>
                <div class="status-info">
                    <h3>Serwer Web</h3>
                    <p><strong>Status:</strong> DZIAÅA â€¢ <strong>Port:</strong> 8080</p>
                </div>
            </div>
            
            <div class="status-item status-online">
                <div class="status-icon">âœ…</div>
                <div class="status-info">
                    <h3>Panel GÅ‚Ã³wny</h3>
                    <p><strong>Status:</strong> AKTYWNY â€¢ <strong>Wersja:</strong> 1.0</p>
                </div>
            </div>
            
            <div class="status-item status-online">
                <div class="status-icon">ğŸ“</div>
                <div class="status-info">
                    <h3>System PlikÃ³w</h3>
                    <p><strong>Status:</strong> DOSTÄ˜PNY â€¢ <strong>Katalog:</strong> /home/panel/web</p>
                </div>
            </div>
            
            <div class="status-item status-online">
                <div class="status-icon">âš¡</div>
                <div class="status-info">
                    <h3>WydajnoÅ›Ä‡</h3>
                    <p><strong>Status:</strong> OPTYMALNA â€¢ <strong>Czas dziaÅ‚ania:</strong> 0:00:01</p>
                </div>
            </div>
        </div>

        <div style="text-align: center;">
            <a href="/" class="btn">â† PowrÃ³t do Panelu GÅ‚Ã³wnego</a>
        </div>
    </div>

    <script>
        // Aktualizuj czas dziaÅ‚ania
        function updateUptime() {
            const startTime = new Date();
            setInterval(() => {
                const now = new Date();
                const diff = Math.floor((now - startTime) / 1000);
                const hours = Math.floor(diff / 3600);
                const minutes = Math.floor((diff % 3600) / 60);
                const seconds = diff % 60;
                
                const uptimeElement = document.querySelector('.status-item:nth-child(4) p');
                if (uptimeElement) {
                    uptimeElement.innerHTML = `<strong>Status:</strong> OPTYMALNA â€¢ <strong>Czas dziaÅ‚ania:</strong> ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        updateUptime();
    </script>
</body>
</html>
STATUS

    echo -e "${GREEN}âœ… Panel web zostaÅ‚ utworzony!${NC}"
    echo -e "${CYAN}ğŸ“ Lokalizacja: $WEB_DIR/${NC}"
    echo -e "${CYAN}ğŸŒ GÅ‚Ã³wna strona: $WEB_DIR/index.html${NC}"
    echo -e "${CYAN}ğŸ“Š Strona statusu: $WEB_DIR/status.html${NC}"
}

start_web_server() {
    echo -e "${YELLOW}ğŸŒ URUCHAMIANIE SERWERA WEB...${NC}"
    
    # SprawdÅº czy panel web istnieje, jeÅ›li nie - utwÃ³rz
    if [ ! -f "$WEB_DIR/index.html" ]; then
        echo -e "${YELLOW}ğŸ“ Tworzenie panelu web...${NC}"
        create_web_panel
    fi
    
    # SprawdÅº czy port jest dostÄ™pny
    if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null ; then
        echo -e "${YELLOW}ğŸ”„ Port $PORT jest zajÄ™ty, zatrzymywanie istniejÄ…cego serwera...${NC}"
        pkill -f "python3 -m http.server $PORT"
        sleep 2
    fi
    
    # Uruchom serwer HTTP
    cd "$WEB_DIR"
    python3 -m http.server $PORT &
    local web_pid=$!
    
    # Poczekaj chwilÄ™ aÅ¼ serwer siÄ™ uruchomi
    sleep 2
    
    # SprawdÅº czy serwer dziaÅ‚a
    if ps -p $web_pid > /dev/null 2>&1; then
        local ip=$(hostname -I | awk '{print $1}')
        
        echo -e "${GREEN}âœ… Serwer web uruchomiony!${NC}"
        echo -e "${CYAN}ğŸŒ Adresy dostÄ™pu:${NC}"
        echo -e "   ğŸ“ Local:    http://localhost:$PORT"
        echo -e "   ğŸŒ SieÄ‡:     http://$ip:$PORT"
        echo -e "   ğŸ“Š Status:   http://localhost:$PORT/status"
        echo -e ""
        echo -e "${YELLOW}ğŸ’¡ OtwÃ³rz przeglÄ…darkÄ™ i wejdÅº na jeden z powyÅ¼szych adresÃ³w${NC}"
        echo -e "${GREEN}ğŸš€ Panel web jest gotowy do uÅ¼ycia!${NC}"
        
        # OtwÃ³rz przeglÄ…darkÄ™ jeÅ›li jest graficzne Å›rodowisko
        if [ -n "$DISPLAY" ]; then
            echo -e "${YELLOW}ğŸ–¥ï¸  Otwieranie przeglÄ…darki...${NC}"
            xdg-open "http://localhost:$PORT" 2>/dev/null &
        fi
    else
        error "âŒ Nie udaÅ‚o siÄ™ uruchomiÄ‡ serwera web!"
    fi
}

stop_web_server() {
    echo -e "${YELLOW}ğŸ›‘ Zatrzymywanie serwera web...${NC}"
    pkill -f "python3 -m http.server $PORT"
    echo -e "${GREEN}âœ… Serwer web zatrzymany${NC}"
}

# =============================================
# ğŸ¯ MENU GÅÃ“WNE
# =============================================

show_menu() {
    echo -e "${GREEN}"
    echo -e "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo -e "â•‘        ğŸ¦– TWORZENIE PANELU WEB       â•‘"
    echo -e "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo -e "â•‘                                      â•‘"
    echo -e "â•‘  ${YELLOW}1${GREEN}ï¸âƒ£  - UtwÃ³rz panel web              â•‘"
    echo -e "â•‘  ${YELLOW}2${GREEN}ï¸âƒ£  - Uruchom serwer web           â•‘"
    echo -e "â•‘  ${YELLOW}3${GREEN}ï¸âƒ£  - Zatrzymaj serwer web         â•‘"
    echo -e "â•‘  ${YELLOW}4${GREEN}ï¸âƒ£  - UtwÃ³rz i uruchom panel       â•‘"
    echo -e "â•‘  ${YELLOW}5${GREEN}ï¸âƒ£  - Informacje o panelu          â•‘"
    echo -e "â•‘  ${YELLOW}0${GREEN}ï¸âƒ£  - WyjÅ›cie                      â•‘"
    echo -e "â•‘                                      â•‘"
    echo -e "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo -e "â•‘        Wybierz opcjÄ™ (0-5):          â•‘"
    echo -e "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
}

show_panel_info() {
    echo ""
    echo -e "${BLUE}ğŸ“Š INFORMACJE O PANELU${NC}"
    echo -e "${CYAN}================================${NC}"
    echo -e " ğŸ“ Katalog panelu: $WEB_DIR"
    echo -e " ğŸŒ Port serwera: $PORT"
    echo -e " ğŸ“„ GÅ‚Ã³wna strona: $WEB_DIR/index.html"
    echo -e " ğŸ“Š Strona statusu: $WEB_DIR/status.html"
    echo -e ""
    
    if [ -f "$WEB_DIR/index.html" ]; then
        echo -e "${GREEN}âœ… Panel web istnieje${NC}"
    else
        echo -e "${YELLOW}ğŸ“­ Panel web nie zostaÅ‚ jeszcze utworzony${NC}"
    fi
    
    if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null ; then
        echo -e "${GREEN}âœ… Serwer web dziaÅ‚a na porcie $PORT${NC}"
    else
        echo -e "${YELLOW}ğŸ”´ Serwer web nie jest uruchomiony${NC}"
    fi
    echo -e "${CYAN}================================${NC}"
}

# =============================================
# ğŸ“œ MAIN SCRIPT
# =============================================

# Inicjalizacja
mkdir -p "$PANEL_DIR"
setup_directories
check_dependencies

clear

echo -e "${BLUE}"
echo -e "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo -e "â•‘        ğŸ¦– TWORZENIE PANELU WEB       â•‘"
echo -e "â•‘         Simple Web Panel             â•‘"
echo -e "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"
echo -e "${CYAN}Katalog panelu: $PANEL_DIR${NC}"
echo -e "${CYAN}Port serwera: $PORT${NC}"
echo ""

while true; do
    show_menu
    read -p "TwÃ³j wybÃ³r: " choice
    
    case $choice in
        1)
            create_web_panel
            ;;
        2)
            start_web_server
            ;;
        3)
            stop_web_server
            ;;
        4)
            echo -e "${YELLOW}ğŸš€ Tworzenie i uruchamianie panelu...${NC}"
            create_web_panel
            start_web_server
            ;;
        5)
            show_panel_info
            ;;
        0)
            echo -e "${GREEN}ğŸ‘‹ Do widzenia!${NC}"
            stop_web_server
            exit 0
            ;;
        *)
            echo -e "${RED}âŒ NieprawidÅ‚owy wybÃ³r!${NC}"
            ;;
    esac
    
    echo ""
    read -p "NaciÅ›nij Enter aby kontynuowaÄ‡..."
    clear
done
