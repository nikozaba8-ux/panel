#!/bin/bash

# =============================================
# üü£ PURPLEHOST - PRAWDZIWE SERWERY MINECRAFT
# =============================================

# Konfiguracja
PANEL_DIR="/home/purplehost"
WEB_DIR="$PANEL_DIR/web"
SERVER_DIR="$PANEL_DIR/serwery"
DB_DIR="$PANEL_DIR/bazy"
BACKUP_DIR="$PANEL_DIR/backupy"
LOG_DIR="$PANEL_DIR/logs"
NODE_DIR="$PANEL_DIR/node"
PORT=8080

# Kolory
PURPLE='\033[0;35m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# =============================================
# üõ†Ô∏è FUNKCJE POMOCNICZE
# =============================================

log() {
    echo -e "${PURPLE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_DIR/panel.log"
}

setup_directories() {
    echo -e "${PURPLE}üìÅ Tworzenie struktur katalog√≥w...${NC}"
    mkdir -p "$PANEL_DIR" "$WEB_DIR" "$SERVER_DIR" "$DB_DIR" "$BACKUP_DIR" "$LOG_DIR" "$NODE_DIR"
    mkdir -p "$SERVER_DIR/minecraft" "$SERVER_DIR/rust" "$SERVER_DIR/ark" "$SERVER_DIR/csgo" "$SERVER_DIR/teamspeak"
    log "Struktura katalog√≥w PurpleHost utworzona"
}

check_dependencies() {
    echo -e "${PURPLE}üîç Sprawdzanie zale≈ºno≈õci...${NC}"
    
    if ! command -v python3 &> /dev/null; then
        echo -e "${YELLOW}üì¶ Instalowanie Pythona 3...${NC}"
        apt update > /dev/null 2>&1
        apt install -y python3 > /dev/null 2>&1
    fi
    
    if ! command -v java &> /dev/null; then
        echo -e "${YELLOW}‚òï Instalowanie Java...${NC}"
        apt install -y default-jre > /dev/null 2>&1
    fi
    
    if ! command -v wget &> /dev/null; then
        echo -e "${YELLOW}üì• Instalowanie wget...${NC}"
        apt install -y wget > /dev/null 2>&1
    fi
    
    echo -e "${GREEN}‚úÖ Wszystkie zale≈ºno≈õci sƒÖ dostƒôpne${NC}"
}

# =============================================
# üéÆ FUNKCJE PRAWDZIWYCH SERWER√ìW MINECRAFT
# =============================================

download_minecraft_server() {
    local server_id="$1"
    local version="$2"
    
    echo -e "${PURPLE}üì• Pobieranie serwera Minecraft $version...${NC}"
    
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    mkdir -p "$server_dir"
    
    cd "$server_dir"
    
    # Pobierz official Minecraft server
    if [ "$version" == "Najnowsza" ] || [ "$version" == "latest" ]; then
        echo -e "${CYAN}‚¨áÔ∏è  Pobieranie najnowszej wersji Minecraft...${NC}"
        wget -q "https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar" -O server.jar
    else
        # Tutaj mo≈ºna dodaƒá pobieranie konkretnych wersji
        echo -e "${CYAN}‚¨áÔ∏è  Pobieranie wersji $version...${NC}"
        wget -q "https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar" -O server.jar
    fi
    
    # Utw√≥rz podstawowƒÖ konfiguracjƒô
    echo -e "${CYAN}‚öôÔ∏è  Konfigurowanie serwera...${NC}"
    
    # Plik eula.txt (wymagany)
    echo "eula=true" > eula.txt
    
    # Server properties
    cat > server.properties << EOF
# Minecraft Server Properties
# Generated by PurpleHost
server-port=25565
online-mode=false
level-type=default
max-players=20
motd=PurpleHost Minecraft Server
view-distance=10
simulation-distance=10
spawn-protection=0
enable-command-block=true
max-world-size=29999984
EOF

    # Skrypt startowy
    cat > start.sh << 'EOF'
#!/bin/bash
cd "$(dirname "$0")"
echo "üü£ Uruchamianie serwera Minecraft..."
java -Xmx1024M -Xms1024M -jar server.jar nogui
EOF

    chmod +x start.sh
    
    echo -e "${GREEN}‚úÖ Serwer Minecraft zosta≈Ç pobrany i skonfigurowany${NC}"
    echo -e "${CYAN}üìÅ Katalog: $server_dir${NC}"
    
    return 0
}

start_minecraft_server() {
    local server_id="$1"
    
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -d "$server_dir" ]; then
        echo -e "${RED}‚ùå Katalog serwera nie istnieje: $server_dir${NC}"
        return 1
    fi
    
    cd "$server_dir"
    
    # Sprawd≈∫ czy serwer ju≈º dzia≈Ça
    if [ -f "server.pid" ]; then
        local pid=$(cat server.pid)
        if ps -p $pid > /dev/null 2>&1; then
            echo -e "${YELLOW}‚ö†Ô∏è  Serwer ju≈º dzia≈Ça (PID: $pid)${NC}"
            return 0
        fi
    fi
    
    echo -e "${PURPLE}üöÄ Uruchamianie serwera Minecraft...${NC}"
    
    # Uruchom serwer w tle
    java -Xmx1024M -Xms1024M -jar server.jar nogui > server.log 2>&1 &
    local minecraft_pid=$!
    
    # Zapisz PID
    echo $minecraft_pid > server.pid
    
    echo -e "${GREEN}‚úÖ Serwer Minecraft uruchomiony (PID: $minecraft_pid)${NC}"
    echo -e "${CYAN}üìù Logi: $server_dir/server.log${NC}"
    
    # Poczekaj chwilƒô na inicjalizacjƒô
    sleep 5
    
    # Sprawd≈∫ czy serwer dzia≈Ça
    if ps -p $minecraft_pid > /dev/null 2>&1; then
        echo -e "${GREEN}üéÆ Serwer Minecraft jest teraz LIVE!${NC}"
        return 0
    else
        echo -e "${RED}‚ùå Nie uda≈Ço siƒô uruchomiƒá serwera Minecraft${NC}"
        return 1
    fi
}

stop_minecraft_server() {
    local server_id="$1"
    
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -f "$server_dir/server.pid" ]; then
        echo -e "${YELLOW}‚ö†Ô∏è  Serwer nie by≈Ç uruchomiony${NC}"
        return 0
    fi
    
    cd "$server_dir"
    local pid=$(cat server.pid)
    
    echo -e "${PURPLE}üõë Zatrzymywanie serwera Minecraft (PID: $pid)...${NC}"
    
    # Wy≈õlij polecenie stop do konsoli Minecraft
    if ps -p $pid > /dev/null 2>&1; then
        # Spr√≥buj gracyjnie zatrzymaƒá
        echo "stop" > /proc/$pid/fd/0 2>/dev/null || true
        sleep 5
        
        # Je≈õli nadal dzia≈Ça, zabij proces
        if ps -p $pid > /dev/null 2>&1; then
            kill $pid
            sleep 2
        fi
        
        # Wymu≈õ zabicie je≈õli nadal ≈ºyje
        if ps -p $pid > /dev/null 2>&1; then
            kill -9 $pid
        fi
    fi
    
    # Usu≈Ñ plik PID
    rm -f server.pid
    
    echo -e "${GREEN}‚úÖ Serwer Minecraft zosta≈Ç zatrzymany${NC}"
    return 0
}

get_server_status() {
    local server_id="$1"
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -f "$server_dir/server.pid" ]; then
        echo "offline"
        return
    fi
    
    local pid=$(cat "$server_dir/server.pid" 2>/dev/null)
    if [ -z "$pid" ] || ! ps -p $pid > /dev/null 2>&1; then
        echo "offline"
    else
        echo "online"
    fi
}

get_server_logs() {
    local server_id="$1"
    local lines="${2:-50}"
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -f "$server_dir/server.log" ]; then
        echo "Brak log√≥w serwera"
        return
    fi
    
    tail -n $lines "$server_dir/server.log"
}

send_server_command() {
    local server_id="$1"
    local command="$2"
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    local pid=$(cat "$server_dir/server.pid" 2>/dev/null)
    if [ -z "$pid" ] || ! ps -p $pid > /dev/null 2>&1; then
        echo "Serwer nie jest uruchomiony"
        return 1
    fi
    
    # Wy≈õlij komendƒô do konsoli Minecraft
    echo "$command" > /proc/$pid/fd/0 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "Komenda wys≈Çana: $command"
        return 0
    else
        echo "Nie uda≈Ço siƒô wys≈Çaƒá komendy"
        return 1
    fi
}

# =============================================
# üåê TWORZENIE PANELU Z PRAWDZIWYMI SERWERAMI
# =============================================

create_web_panel() {
    echo -e "${PURPLE}üåê Tworzenie panelu z prawdziwymi serwerami Minecraft...${NC}"
    
    # Strona g≈Ç√≥wna - Sklep
    cat > "$WEB_DIR/index.html" << 'HTML'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üü£ PurpleHost - Professional Game Hosting</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #6a11cb;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background: #6a11cb;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .hero {
            text-align: center;
            padding: 80px 20px;
            color: white;
        }
        
        .hero h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.3em;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 1.1em;
        }
        
        .btn-primary {
            background: #6a11cb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a0db3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #856404;
        }
        
        .shop-section {
            background: white;
            border-radius: 20px;
            padding: 50px 30px;
            margin: 40px 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .section-title {
            text-align: center;
            color: #6a11cb;
            margin-bottom: 40px;
            font-size: 2.5em;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .product-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .product-card:hover {
            transform: translateY(-10px);
            border-color: #6a11cb;
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .product-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .product-title {
            color: #6a11cb;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .product-price {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
            margin: 20px 0;
        }
        
        .product-features {
            list-style: none;
            margin: 20px 0;
            text-align: left;
        }
        
        .product-features li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .product-features li:before {
            content: "‚úÖ ";
            margin-right: 10px;
        }
        
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: white;
            margin-top: 60px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .client-panel-section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 50px 30px;
            margin: 40px 0;
            text-align: center;
        }
        
        .live-badge {
            background: #dc3545;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav-container">
            <div class="logo">üü£ PurpleHost <span class="live-badge">LIVE</span></div>
            <ul class="nav-menu">
                <li><a href="#" class="active">Strona G≈Ç√≥wna</a></li>
                <li><a href="#" onclick="showSection('sklep')">Sklep</a></li>
                <li><a href="/client">Panel Klienta</a></li>
                <li><a href="#">Kontakt</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h1>üü£ PurpleHost <span class="live-badge">PRAWDZIWE SERWERY</span></h1>
            <p>Profesjonalny hosting z LIVE serwerami Minecraft ‚Ä¢ Java Edition ‚Ä¢ Najlepsze ceny</p>
            <div style="margin-top: 30px;">
                <a href="#" onclick="showSection('sklep')" class="btn btn-primary">üéÆ Kup Serwer Minecraft</a>
                <a href="/client" class="btn" style="background: white; color: #6a11cb; margin-left: 15px;">üë§ Panel Klienta</a>
            </div>
        </div>

        <div class="warning-banner">
            ‚ö†Ô∏è <strong>Warning out...</strong> Not this convention postupancy is a twoism location.
        </div>

        <!-- Sklep -->
        <div id="sklep" class="shop-section">
            <h2 class="section-title">üéÆ Prawdziwe Serwery Minecraft</h2>
            <p style="text-align: center; font-size: 1.2em; margin-bottom: 30px; color: #666;">
                Kupuj i uruchamiaj prawdziwe serwery Minecraft z oficjalnymi plikami od Mojang
            </p>
            
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-icon">‚õèÔ∏è</div>
                    <h3 class="product-title">Minecraft Basic</h3>
                    <div class="product-price">$5/miesiƒÖc</div>
                    <ul class="product-features">
                        <li>Official Minecraft Server</li>
                        <li>1GB RAM ‚Ä¢ 10GB SSD</li>
                        <li>Nieograniczone sloty</li>
                        <li>Panel kontrolny</li>
                        <li>Automatyczne backupy</li>
                        <li>Support 24/7</li>
                    </ul>
                    <button class="btn btn-primary" onclick="buyProduct('minecraft')">üõí Kup Teraz</button>
                </div>
                
                <div class="product-card">
                    <div class="product-icon">‚ö°</div>
                    <h3 class="product-title">Minecraft Premium</h3>
                    <div class="product-price">$10/miesiƒÖc</div>
                    <ul class="product-features">
                        <li>Official Minecraft Server</li>
                        <li>4GB RAM ‚Ä¢ 20GB SSD</li>
                        <li>Mod/Plugin support</li>
                        <li>FTP dostƒôp</li>
                        <li>MySQL baza danych</li>
                        <li>DDOS Protection</li>
                    </ul>
                    <button class="btn btn-primary" onclick="buyProduct('minecraft')">üõí Kup Teraz</button>
                </div>
                
                <div class="product-card">
                    <div class="product-icon">üöÄ</div>
                    <h3 class="product-title">Minecraft Pro</h3>
                    <div class="product-price">$20/miesiƒÖc</div>
                    <ul class="product-features">
                        <li>Official Minecraft Server</li>
                        <li>8GB RAM ‚Ä¢ 50GB SSD</li>
                        <li>Dedykowane zasoby</li>
                        <li>Custom JAR support</li>
                        <li>Priority support</li>
                        <li>Free domain</li>
                    </ul>
                    <button class="btn btn-primary" onclick="buyProduct('minecraft')">üõí Kup Teraz</button>
                </div>
            </div>
        </div>

        <!-- Panel Klienta Info -->
        <div class="client-panel-section">
            <h2 style="color: #6a11cb; margin-bottom: 20px; font-size: 2em;">üë§ Panel Klienta - Prawdziwe Serwery</h2>
            <p style="font-size: 1.2em; margin-bottom: 30px; color: #666;">
                ZarzƒÖdzaj prawdziwymi serwerami Minecraft z oficjalnymi plikami od Mojang.<br>
                Uruchamiaj, zatrzymuj, konfiguruj i graj na ≈ºywych serwerach!
            </p>
            <a href="/client" class="btn btn-primary" style="font-size: 1.2em; padding: 15px 40px;">
                üöÄ Przejd≈∫ do Panelu Klienta
            </a>
        </div>
    </div>

    <div class="footer">
        Copyright ¬© 2025 purpleHost.ru - Prawdziwe Serwery Minecraft LIVE
    </div>

    <script>
        function showSection(section) {
            if (section === 'sklep') {
                document.getElementById('sklep').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }
        
        function buyProduct(product) {
            alert('üõí Dodano do koszyka: ' + product.toUpperCase() + '\n\nPrzejd≈∫ do panelu klienta aby utworzyƒá prawdziwy serwer Minecraft!');
            setTimeout(() => {
                window.location.href = '/client';
            }, 2000);
        }
    </script>
</body>
</html>
HTML

    # Panel Klienta z prawdziwymi serwerami
    mkdir -p "$WEB_DIR/client"
    
    cat > "$WEB_DIR/client/index.html" << 'HTML'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë§ Panel Klienta - Prawdziwe Serwery Minecraft</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #6a11cb;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background: #6a11cb;
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .welcome-banner {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #856404;
        }
        
        .servers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .server-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #6a11cb;
        }
        
        .server-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .server-icon {
            font-size: 2em;
        }
        
        .server-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
        }
        
        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        .server-info {
            margin-bottom: 15px;
        }
        
        .server-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            flex: 1;
        }
        
        .btn-primary {
            background: #6a11cb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a0db3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .create-server-btn {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            margin: 20px 0;
            display: block;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .create-server-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .server-details {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .server-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .tab {
            padding: 12px 25px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: #6a11cb;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .file-manager {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            height: 500px;
        }
        
        .file-tree {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
        }
        
        .file-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: white;
            font-size: 0.9em;
        }
        
        .no-servers {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6a11cb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav-container">
            <div class="logo">üü£ PurpleHost - Prawdziwe Serwery</div>
            <ul class="nav-menu">
                <li><a href="/">üè† Strona G≈Ç√≥wna</a></li>
                <li><a href="#" class="active">üë§ Moje Serwery</a></li>
                <li><a href="#">üìä Statystyki</a></li>
                <li><a href="#">üí≥ P≈Çatno≈õci</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div class="welcome-banner">
            <h1>üë§ Prawdziwe Serwery Minecraft</h1>
            <p>Tw√≥rz i zarzƒÖdzaj prawdziwymi serwerami Minecraft z oficjalnymi plikami od Mojang</p>
        </div>

        <div class="warning-banner">
            ‚ö†Ô∏è <strong>Warning out...</strong> Not this convention postupancy is a twoism location.
        </div>

        <!-- Przycisk tworzenia serwera -->
        <button class="create-server-btn" onclick="showCreateServerForm()">
            ‚ûï Utw√≥rz Prawdziwy Serwer Minecraft
        </button>

        <!-- Lista serwer√≥w -->
        <div id="serversList">
            <div class="no-servers" id="noServersMessage">
                <div style="font-size: 4em; margin-bottom: 20px; opacity: 0.5;">‚õèÔ∏è</div>
                <h2>Brak serwer√≥w Minecraft</h2>
                <p>Nie masz jeszcze ≈ºadnych serwer√≥w. Utw√≥rz pierwszy prawdziwy serwer Minecraft!</p>
                <button class="btn btn-primary" onclick="showCreateServerForm()" style="margin-top: 20px;">
                    üöÄ Utw√≥rz Pierwszy Serwer
                </button>
            </div>
            
            <div class="servers-grid" id="serversGrid" style="display: none;">
                <!-- Serwery bƒôdƒÖ dodawane dynamicznie -->
            </div>
        </div>

        <!-- Formularz tworzenia serwera -->
        <div id="createServerForm" class="server-details">
            <h2 style="color: #6a11cb; margin-bottom: 25px;">üõ†Ô∏è Tworzenie Prawdziwego Serwera Minecraft</h2>
            
            <div class="form-group">
                <label for="serverName">Nazwa Serwera:</label>
                <input type="text" class="form-control" id="serverName" placeholder="Moj Super Serwer Minecraft">
            </div>
            
            <div class="form-group">
                <label for="serverVersion">Wersja Minecraft:</label>
                <select class="form-control" id="serverVersion">
                    <option value="latest">Najnowsza (1.20.4)</option>
                    <option value="1.20.1">1.20.1</option>
                    <option value="1.19.4">1.19.4</option>
                    <option value="1.18.2">1.18.2</option>
                    <option value="1.17.1">1.17.1</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="serverSlots">Maksymalna liczba graczy:</label>
                <select class="form-control" id="serverSlots">
                    <option value="10">10 graczy</option>
                    <option value="20">20 graczy</option>
                    <option value="30">30 graczy</option>
                    <option value="50">50 graczy</option>
                </select>
            </div>
            
            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h4 style="color: #1976d2; margin-bottom: 10px;">‚ÑπÔ∏è Informacje</h4>
                <p>Tworzysz <strong>prawdziwy serwer Minecraft</strong> z oficjalnymi plikami od Mojang.</p>
                <p>Serwer bƒôdzie pobiera≈Ç official server.jar i uruchomi siƒô jako prawdziwy proces systemowy.</p>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-success" onclick="createRealMinecraftServer()" style="flex: 2;">
                    üöÄ Utw√≥rz Prawdziwy Serwer
                </button>
                <button class="btn btn-danger" onclick="hideCreateServerForm()" style="flex: 1;">‚ùå Anuluj</button>
            </div>
            
            <div id="creationLog" style="background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 5px; margin-top: 20px; font-family: monospace; display: none;"></div>
        </div>

        <!-- Szczeg√≥≈Çy serwera -->
        <div id="serverDetails" class="server-details">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #6a11cb; margin: 0;" id="serverDetailsTitle">Szczeg√≥≈Çy Serwera</h2>
                <button class="btn btn-danger" onclick="hideServerDetails()">‚úñÔ∏è Zamknij</button>
            </div>
            
            <div id="serverInfo" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Status:</strong> <span id="serverStatusInfo">≈Åadowanie...</span>
                        <span class="live-indicator" id="liveIndicator" style="display: none;"></span>
                    </div>
                    <div>
                        <strong>PID:</strong> <span id="serverPidInfo">-</span>
                    </div>
                    <div>
                        <strong>Port:</strong> <span id="serverPortInfo">25565</span>
                    </div>
                    <div>
                        <strong>Wersja:</strong> <span id="serverVersionInfo">-</span>
                    </div>
                </div>
            </div>
            
            <div class="server-tabs">
                <button class="tab active" data-tab="console">üíª Konsola LIVE</button>
                <button class="tab" data-tab="files">üìÅ Pliki Serwera</button>
                <button class="tab" data-tab="settings">‚öôÔ∏è Ustawienia</button>
                <button class="tab" data-tab="backups">üíæ Backupy</button>
            </div>
            
            <!-- Konsola LIVE -->
            <div id="console" class="tab-content active">
                <div class="console-output" id="serverConsole">
                    üü£ PurpleHost Minecraft Server Console<br>
                    Serwer: <span id="consoleServerName">≈Åadowanie...</span><br>
                    Status: <span id="consoleStatus">≈Åadowanie...</span><br>
                    ----------------------------------------<br>
                    <div id="consoleContent">≈Åadowanie log√≥w serwera...</div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" class="form-control" id="serverCommand" placeholder="Wprowad≈∫ komendƒô Minecraft (np: say hello, list, stop)...">
                    <button class="btn btn-primary" onclick="sendMinecraftCommand()">‚ñ∂ Wykonaj</button>
                    <button class="btn" onclick="refreshConsole()">üîÑ Od≈õwie≈º</button>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="startMinecraftServer()" id="startServerBtn">‚ñ∂ Uruchom Serwer</button>
                    <button class="btn btn-danger" onclick="stopMinecraftServer()" id="stopServerBtn">‚èπ Zatrzymaj Serwer</button>
                    <button class="btn" onclick="restartMinecraftServer()">üîÑ Restartuj</button>
                </div>
            </div>
            
            <!-- Pliki -->
            <div id="files" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #6a11cb;">üìÅ Pliki Serwera Minecraft</h3>
                <div class="file-manager">
                    <div class="file-tree">
                        <h4>Struktura Serwera</h4>
                        <div style="margin-top: 15px; font-family: monospace;">
                            <div>üìÅ world/</div>
                            <div>üìÅ logs/</div>
                            <div>üìÅ plugins/</div>
                            <div>üìÑ server.properties</div>
                            <div>üìÑ eula.txt</div>
                            <div>üìÑ server.jar</div>
                            <div>üìÑ start.sh</div>
                        </div>
                    </div>
                    <div class="file-content">
                        <h4>Informacje o Plikach</h4>
                        <p>Katalog serwera: <code id="serverPath">/home/purplehost/serwery/minecraft/</code></p>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary">üì§ Upload Pliku</button>
                            <button class="btn">üì• Pobierz Backup</button>
                            <button class="btn" onclick="editServerProperties()">‚úèÔ∏è Edytuj server.properties</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ustawienia -->
            <div id="settings" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #6a11cb;">‚öôÔ∏è Konfiguracja Serwera</h3>
                <div class="form-group">
                    <label for="serverMotd">MOTD (Message of the Day):</label>
                    <input type="text" class="form-control" id="serverMotd" value="PurpleHost Minecraft Server">
                </div>
                <div class="form-group">
                    <label for="serverMaxPlayers">Maksymalna liczba graczy:</label>
                    <input type="number" class="form-control" id="serverMaxPlayers" value="20">
                </div>
                <button class="btn btn-success" onclick="saveServerSettings()">üíæ Zapisz Ustawienia</button>
            </div>
            
            <!-- Backupy -->
            <div id="backups" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #6a11cb;">üíæ System Backup√≥w</h3>
                <p>ZarzƒÖdzaj kopiami zapasowymi ≈õwiata Minecraft.</p>
                <div style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="createBackup()">üîÑ Utw√≥rz Backup</button>
                    <button class="btn btn-primary">‚è∞ Harmonogram</button>
                    <button class="btn">üì• Pobierz ≈öwiat</button>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        Copyright ¬© 2025 purpleHost.ru - Prawdziwe Serwery Minecraft LIVE
    </div>

    <script>
        let servers = JSON.parse(localStorage.getItem('purplehost_servers')) || [];
        let currentServer = null;
        let consoleRefreshInterval = null;
        
        // API calls do backendu
        async function apiCall(action, data = {}) {
            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action, ...data })
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, error: error.message };
            }
        }
        
        // ≈Åadowanie serwer√≥w
        async function loadServers() {
            const serversGrid = document.getElementById('serversGrid');
            const noServersMessage = document.getElementById('noServersMessage');
            
            if (servers.length === 0) {
                serversGrid.style.display = 'none';
                noServersMessage.style.display = 'block';
            } else {
                serversGrid.style.display = 'grid';
                noServersMessage.style.display = 'none';
                
                serversGrid.innerHTML = '';
                
                for (const server of servers) {
                    // Sprawd≈∫ status serwera
                    const statusResult = await apiCall('get_server_status', { server_id: server.id });
                    server.status = statusResult.success ? statusResult.status : 'offline';
                    server.pid = statusResult.pid;
                    
                    const serverCard = document.createElement('div');
                    serverCard.className = 'server-card';
                    serverCard.innerHTML = `
                        <div class="server-header">
                            <div class="server-icon">‚õèÔ∏è</div>
                            <div class="server-status ${server.status === 'online' ? 'status-online' : 'status-offline'}">
                                ${server.status === 'online' ? 'üü¢ ONLINE' : 'üî¥ OFFLINE'}
                                ${server.status === 'online' ? '<span class="live-indicator"></span>' : ''}
                            </div>
                        </div>
                        <div class="server-info">
                            <h3 style="color: #6a11cb; margin-bottom: 10px;">${server.name}</h3>
                            <p><strong>Typ:</strong> Minecraft</p>
                            <p><strong>Wersja:</strong> ${server.version}</p>
                            <p><strong>Gracze:</strong> ${server.slots}</p>
                            <p><strong>Utworzono:</strong> ${server.created}</p>
                            ${server.pid ? `<p><strong>PID:</strong> ${server.pid}</p>` : ''}
                        </div>
                        <div class="server-actions">
                            <button class="btn btn-primary" onclick="showServerDetails(${server.id})">
                                üîß ZarzƒÖdzaj
                            </button>
                            ${server.status === 'online' ? 
                                '<button class="btn btn-danger" onclick="stopServer(' + server.id + ')">‚èπ Stop</button>' : 
                                '<button class="btn btn-success" onclick="startServer(' + server.id + ')">‚ñ∂ Start</button>'
                            }
                        </div>
                    `;
                    serversGrid.appendChild(serverCard);
                }
                
                // Zapisz zaktualizowany status
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
            }
        }
        
        async function createRealMinecraftServer() {
            const name = document.getElementById('serverName').value;
            const version = document.getElementById('serverVersion').value;
            const slots = document.getElementById('serverSlots').value;
            
            if (!name) {
                alert('Proszƒô wprowadziƒá nazwƒô serwera!');
                return;
            }
            
            const logElement = document.getElementById('creationLog');
            logElement.style.display = 'block';
            logElement.innerHTML = 'üü£ Rozpoczynanie tworzenia prawdziwego serwera Minecraft...\n';
            
            const result = await apiCall('create_minecraft_server', {
                name: name,
                version: version,
                slots: slots
            });
            
            if (result.success) {
                logElement.innerHTML += '‚úÖ Serwer Minecraft utworzony pomy≈õlnie!\n';
                logElement.innerHTML += `üìÅ Katalog: ${result.server_dir}\n`;
                logElement.innerHTML += `‚öôÔ∏è Skonfigurowano server.properties\n`;
                logElement.innerHTML += `üì• Pobrano official server.jar\n`;
                
                const newServer = {
                    id: result.server_id,
                    name: name,
                    type: 'minecraft',
                    version: version,
                    slots: slots,
                    status: 'offline',
                    created: new Date().toLocaleString(),
                    directory: result.server_dir
                };
                
                servers.push(newServer);
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
                
                setTimeout(() => {
                    loadServers();
                    hideCreateServerForm();
                    alert('üéâ Prawdziwy serwer Minecraft zosta≈Ç utworzony!\n\nMo≈ºesz go teraz uruchomiƒá i graƒá!');
                }, 2000);
            } else {
                logElement.innerHTML += `‚ùå B≈ÇƒÖd: ${result.error}\n`;
            }
        }
        
        async function startServer(serverId) {
            const server = servers.find(s => s.id === serverId);
            if (!server) return;
            
            const result = await apiCall('start_minecraft_server', { server_id: serverId });
            
            if (result.success) {
                server.status = 'online';
                server.pid = result.pid;
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
                loadServers();
                alert('üü¢ Serwer Minecraft uruchomiony! PID: ' + result.pid);
            } else {
                alert('‚ùå B≈ÇƒÖd uruchamiania: ' + result.error);
            }
        }
        
        async function stopServer(serverId) {
            const server = servers.find(s => s.id === serverId);
            if (!server) return;
            
            const result = await apiCall('stop_minecraft_server', { server_id: serverId });
            
            if (result.success) {
                server.status = 'offline';
                server.pid = null;
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
                loadServers();
                alert('üî¥ Serwer Minecraft zatrzymany!');
            } else {
                alert('‚ùå B≈ÇƒÖd zatrzymywania: ' + result.error);
            }
        }
        
        function showCreateServerForm() {
            document.getElementById('createServerForm').style.display = 'block';
            document.getElementById('serverDetails').style.display = 'none';
            document.getElementById('creationLog').style.display = 'none';
            document.getElementById('creationLog').innerHTML = '';
        }
        
        function hideCreateServerForm() {
            document.getElementById('createServerForm').style.display = 'none';
        }
        
        async function showServerDetails(serverId) {
            currentServer = servers.find(s => s.id === serverId);
            if (!currentServer) return;
            
            document.getElementById('serverDetailsTitle').textContent = 'Serwer: ' + currentServer.name;
            document.getElementById('consoleServerName').textContent = currentServer.name;
            document.getElementById('serverDetails').style.display = 'block';
            document.getElementById('createServerForm').style.display = 'none';
            
            // Za≈Çaduj informacje o serwerze
            await updateServerInfo();
            
            // Rozpocznij auto-od≈õwie≈ºanie konsoli
            startConsoleRefresh();
            
            // Reset tabs
            showTab('console');
        }
        
        function hideServerDetails() {
            document.getElementById('serverDetails').style.display = 'none';
            stopConsoleRefresh();
            currentServer = null;
        }
        
        async function updateServerInfo() {
            if (!currentServer) return;
            
            const statusResult = await apiCall('get_server_status', { server_id: currentServer.id });
            
            document.getElementById('serverStatusInfo').textContent = 
                statusResult.status === 'online' ? 'üü¢ ONLINE' : 'üî¥ OFFLINE';
            document.getElementById('serverPidInfo').textContent = statusResult.pid || '-';
            document.getElementById('serverVersionInfo').textContent = currentServer.version;
            document.getElementById('serverPath').textContent = currentServer.directory;
            document.getElementById('consoleStatus').textContent = 
                statusResult.status === 'online' ? 'üü¢ SERWER DZIA≈ÅA' : 'üî¥ SERWER WY≈ÅƒÑCZONY';
            
            // Pokaj/ukryj wska≈∫nik LIVE
            document.getElementById('liveIndicator').style.display = 
                statusResult.status === 'online' ? 'inline-block' : 'none';
            
            // Aktualizuj przyciski
            document.getElementById('startServerBtn').style.display = 
                statusResult.status === 'online' ? 'none' : 'inline-block';
            document.getElementById('stopServerBtn').style.display = 
                statusResult.status === 'online' ? 'inline-block' : 'none';
        }
        
        async function refreshConsole() {
            if (!currentServer) return;
            
            const logsResult = await apiCall('get_server_logs', { 
                server_id: currentServer.id,
                lines: 50 
            });
            
            if (logsResult.success) {
                document.getElementById('consoleContent').textContent = logsResult.logs;
                const consoleElement = document.getElementById('serverConsole');
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }
        }
        
        function startConsoleRefresh() {
            stopConsoleRefresh();
            refreshConsole();
            consoleRefreshInterval = setInterval(refreshConsole, 3000);
        }
        
        function stopConsoleRefresh() {
            if (consoleRefreshInterval) {
                clearInterval(consoleRefreshInterval);
                consoleRefreshInterval = null;
            }
        }
        
        async function sendMinecraftCommand() {
            if (!currentServer) return;
            
            const command = document.getElementById('serverCommand').value;
            if (!command.trim()) return;
            
            const result = await apiCall('send_server_command', {
                server_id: currentServer.id,
                command: command
            });
            
            if (result.success) {
                document.getElementById('serverCommand').value = '';
                // Od≈õwie≈º konsolƒô aby zobaczyƒá wynik komendy
                setTimeout(refreshConsole, 1000);
            } else {
                alert('B≈ÇƒÖd wysy≈Çania komendy: ' + result.error);
            }
        }
        
        function showTab(tabName) {
            // Ukryj wszystkie taby
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Poka≈º wybrany tab
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
        }
        
        // Inicjalizacja
        document.addEventListener('DOMContentLoaded', function() {
            loadServers();
            
            // Obs≈Çuga tab√≥w
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
            
            // Enter w konsoli
            document.getElementById('serverCommand').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMinecraftCommand();
                }
            });
        });
        
        // Funkcje dla przycisk√≥w w szczeg√≥≈Çach serwera
        async function startMinecraftServer() {
            if (currentServer) {
                await startServer(currentServer.id);
                await updateServerInfo();
                startConsoleRefresh();
            }
        }
        
        async function stopMinecraftServer() {
            if (currentServer) {
                await stopServer(currentServer.id);
                await updateServerInfo();
            }
        }
        
        async function restartMinecraftServer() {
            if (currentServer) {
                await stopServer(currentServer.id);
                await new Promise(resolve => setTimeout(resolve, 3000));
                await startServer(currentServer.id);
                await updateServerInfo();
                startConsoleRefresh();
            }
        }
        
        function editServerProperties() {
            alert('Edytor server.properties - funkcja w budowie!');
        }
        
        function saveServerSettings() {
            alert('Ustawienia zapisane!');
        }
        
        function createBackup() {
            alert('Tworzenie backupu ≈õwiata...');
        }
    </script>
</body>
</html>
HTML

    # Backend API dla prawdziwych serwer√≥w
    cat > "$WEB_DIR/api_server.py" << 'PYTHON'
#!/usr/bin/env python3
import http.server
import socketserver
import json
import os
import sys
import subprocess
import threading
from urllib.parse import urlparse, parse_qs
import time
import shutil

# Konfiguracja
PANEL_DIR = "/home/purplehost"
SERVER_DIR = os.path.join(PANEL_DIR, "serwery")
LOG_DIR = os.path.join(PANEL_DIR, "logs")
PORT = 8080

# Baza danych serwer√≥w
SERVERS_DB = os.path.join(PANEL_DIR, "servers.json")

def load_servers():
    """Za≈Çaduj listƒô serwer√≥w z pliku JSON"""
    try:
        with open(SERVERS_DB, 'r') as f:
            return json.load(f)
    except:
        return []

def save_servers(servers):
    """Zapisz listƒô serwer√≥w do pliku JSON"""
    with open(SERVERS_DB, 'w') as f:
        json.dump(servers, f, indent=2)

def get_next_server_id():
    """Pobierz nastƒôpny dostƒôpny ID serwera"""
    servers = load_servers()
    if not servers:
        return 1
    return max(server['id'] for server in servers) + 1

def create_minecraft_server(server_name, version, slots):
    """Utw√≥rz prawdziwy serwer Minecraft"""
    try:
        server_id = get_next_server_id()
        server_dir = os.path.join(SERVER_DIR, "minecraft", f"server_{server_id}")
        
        # Utw√≥rz katalog serwera
        os.makedirs(server_dir, exist_ok=True)
        os.chdir(server_dir)
        
        print(f"üì• Tworzenie serwera Minecraft w: {server_dir}")
        
        # Pobierz official Minecraft server
        if version == "latest" or version == "Najnowsza":
            jar_url = "https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar"
        else:
            jar_url = "https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar"
        
        # Pobierz server.jar
        subprocess.run(["wget", "-q", jar_url, "-O", "server.jar"], check=True)
        
        # Utw√≥rz eula.txt (wymagane)
        with open("eula.txt", "w") as f:
            f.write("eula=true\n")
        
        # Server properties
        with open("server.properties", "w") as f:
            f.write(f"""# Minecraft Server Properties
# Generated by PurpleHost
server-port=25565
online-mode=false
level-type=default
max-players={slots}
motd={server_name}
view-distance=10
simulation-distance=10
spawn-protection=0
enable-command-block=true
max-world-size=29999984
""")
        
        # Skrypt startowy
        with open("start.sh", "w") as f:
            f.write("""#!/bin/bash
cd "$(dirname "$0")"
echo "üü£ Uruchamianie serwera Minecraft..."
java -Xmx1024M -Xms1024M -jar server.jar nogui
""")
        
        os.chmod("start.sh", 0o755)
        
        # Dodaj serwer do bazy danych
        server_data = {
            'id': server_id,
            'name': server_name,
            'type': 'minecraft',
            'version': version,
            'slots': slots,
            'directory': server_dir,
            'status': 'offline',
            'pid': None,
            'created_at': time.time()
        }
        
        servers = load_servers()
        servers.append(server_data)
        save_servers(servers)
        
        return {
            "success": True,
            "server_id": server_id,
            "server_dir": server_dir,
            "message": "Serwer Minecraft utworzony pomy≈õlnie"
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }

def start_minecraft_server(server_id):
    """Uruchom prawdziwy serwer Minecraft"""
    try:
        servers = load_servers()
        server = next((s for s in servers if s['id'] == server_id), None)
        
        if not server:
            return {"success": False, "error": "Serwer nie znaleziony"}
        
        server_dir = server['directory']
        
        if not os.path.exists(server_dir):
            return {"success": False, "error": "Katalog serwera nie istnieje"}
        
        os.chdir(server_dir)
        
        # Sprawd≈∫ czy serwer ju≈º dzia≈Ça
        pid_file = os.path.join(server_dir, "server.pid")
        if os.path.exists(pid_file):
            with open(pid_file, 'r') as f:
                pid = int(f.read().strip())
            if is_process_running(pid):
                return {"success": True, "pid": pid, "message": "Serwer ju≈º dzia≈Ça"}
        
        # Uruchom serwer Minecraft
        print(f"üöÄ Uruchamianie serwera Minecraft w: {server_dir}")
        process = subprocess.Popen(
            ["java", "-Xmx1024M", "-Xms1024M", "-jar", "server.jar", "nogui"],
            stdout=open(os.path.join(server_dir, "server.log"), "a"),
            stderr=subprocess.STDOUT,
            stdin=subprocess.PIPE
        )
        
        # Zapisz PID
        with open(pid_file, 'w') as f:
            f.write(str(process.pid))
        
        # Zaktualizuj status serwera
        server['status'] = 'online'
        server['pid'] = process.pid
        save_servers(servers)
        
        # Poczekaj na inicjalizacjƒô
        time.sleep(10)
        
        return {
            "success": True,
            "pid": process.pid,
            "message": "Serwer Minecraft uruchomiony"
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }

def stop_minecraft_server(server_id):
    """Zatrzymaj serwer Minecraft"""
    try:
        servers = load_servers()
        server = next((s for s in servers if s['id'] == server_id), None)
        
        if not server:
            return {"success": False, "error": "Serwer nie znaleziony"}
        
        server_dir = server['directory']
        pid_file = os.path.join(server_dir, "server.pid")
        
        if not os.path.exists(pid_file):
            return {"success": True, "message": "Serwer nie by≈Ç uruchomiony"}
        
        with open(pid_file, 'r') as f:
            pid = int(f.read().strip())
        
        if is_process_running(pid):
            print(f"üõë Zatrzymywanie serwera Minecraft (PID: {pid})")
            
            # Spr√≥buj gracyjnie zatrzymaƒá
            try:
                # Wy≈õlij polecenie 'stop' do konsoli Minecraft
                with open(f"/proc/{pid}/fd/0", "w") as f:
                    f.write("stop\n")
            except:
                pass
            
            # Poczekaj na zatrzymanie
            for i in range(10):
                if not is_process_running(pid):
                    break
                time.sleep(1)
            
            # Je≈õli nadal dzia≈Ça, zabij proces
            if is_process_running(pid):
                subprocess.run(["kill", str(pid)])
                time.sleep(2)
                
                if is_process_running(pid):
                    subprocess.run(["kill", "-9", str(pid)])
        
        # Usu≈Ñ plik PID
        if os.path.exists(pid_file):
            os.remove(pid_file)
        
        # Zaktualizuj status serwera
        server['status'] = 'offline'
        server['pid'] = None
        save_servers(servers)
        
        return {
            "success": True,
            "message": "Serwer Minecraft zatrzymany"
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }

def is_process_running(pid):
    """Sprawd≈∫ czy proces o podanym PID jest uruchomiony"""
    try:
        os.kill(pid, 0)
        return True
    except:
        return False

def get_server_status(server_id):
    """Pobierz status serwera"""
    try:
        servers = load_servers()
        server = next((s for s in servers if s['id'] == server_id), None)
        
        if not server:
            return {"success": False, "error": "Serwer nie znaleziony"}
        
        pid_file = os.path.join(server['directory'], "server.pid")
        
        if os.path.exists(pid_file):
            with open(pid_file, 'r') as f:
                pid = int(f.read().strip())
            if is_process_running(pid):
                return {
                    "success": True,
                    "status": "online",
                    "pid": pid
                }
        
        return {
            "success": True,
            "status": "offline",
            "pid": None
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }

def get_server_logs(server_id, lines=50):
    """Pobierz logi serwera"""
    try:
        servers = load_servers()
        server = next((s for s in servers if s['id'] == server_id), None)
        
        if not server:
            return {"success": False, "error": "Serwer nie znaleziony"}
        
        log_file = os.path.join(server['directory'], "server.log")
        
        if not os.path.exists(log_file):
            return {"success": True, "logs": "Brak log√≥w serwera"}
        
        # Przeczytaj ostatnie linie logu
        with open(log_file, 'r') as f:
            all_lines = f.readlines()
            logs = ''.join(all_lines[-lines:])
        
        return {
            "success": True,
            "logs": logs
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }

def send_server_command(server_id, command):
    """Wy≈õlij komendƒô do serwera Minecraft"""
    try:
        servers = load_servers()
        server = next((s for s in servers if s['id'] == server_id), None)
        
        if not server:
            return {"success": False, "error": "Serwer nie znaleziony"}
        
        pid_file = os.path.join(server['directory'], "server.pid")
        
        if not os.path.exists(pid_file):
            return {"success": False, "error": "Serwer nie jest uruchomiony"}
        
        with open(pid_file, 'r') as f:
            pid = int(f.read().strip())
        
        if not is_process_running(pid):
            return {"success": False, "error": "Serwer nie jest uruchomiony"}
        
        # Wy≈õlij komendƒô do procesu Minecraft
        try:
            with open(f"/proc/{pid}/fd/0", "w") as f:
                f.write(command + "\n")
        except Exception as e:
            return {"success": False, "error": f"Nie uda≈Ço siƒô wys≈Çaƒá komendy: {str(e)}"}
        
        return {
            "success": True,
            "message": f"Komenda wys≈Çana: {command}"
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e)
        }

class PurpleHostAPIHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        # Obs≈Çuga statycznych plik√≥w
        if self.path.startswith('/api'):
            self.handle_api()
        else:
            super().do_GET()
    
    def do_POST(self):
        if self.path == '/api':
            self.handle_api()
        else:
            self.send_error(404)
    
    def handle_api(self):
        """Obs≈Çu≈º ≈ºƒÖdanie API"""
        try:
            content_length = int(self.headers['Content-Length'])
            post_data = self.rfile.read(content_length)
            request_data = json.loads(post_data.decode('utf-8'))
            
            action = request_data.get('action')
            
            if action == 'create_minecraft_server':
                response = create_minecraft_server(
                    request_data['name'],
                    request_data['version'],
                    request_data['slots']
                )
            elif action == 'start_minecraft_server':
                response = start_minecraft_server(request_data['server_id'])
            elif action == 'stop_minecraft_server':
                response = stop_minecraft_server(request_data['server_id'])
            elif action == 'get_server_status':
                response = get_server_status(request_data['server_id'])
            elif action == 'get_server_logs':
                response = get_server_logs(
                    request_data['server_id'],
                    request_data.get('lines', 50)
                )
            elif action == 'send_server_command':
                response = send_server_command(
                    request_data['server_id'],
                    request_data['command']
                )
            else:
                response = {"success": False, "error": "Nieznana akcja"}
                
            self.send_json_response(response)
                
        except Exception as e:
            self.send_json_response({"success": False, "error": str(e)})
    
    def send_json_response(self, data):
        """Wy≈õlij odpowied≈∫ JSON"""
        self.send_response(200)
        self.send_header('Content-type', 'application/json')
        self.send_header('Access-Control-Allow-Origin', '*')
        self.end_headers()
        self.wfile.write(json.dumps(data).encode('utf-8'))

def start_api_server():
    """Uruchom serwer API"""
    os.chdir(WEB_DIR)
    
    handler = PurpleHostAPIHandler
    with socketserver.TCPServer(("", PORT), handler) as httpd:
        print(f"üü£ PurpleHost API Server z prawdziwymi serwerami Minecraft dzia≈Ça na porcie {PORT}")
        print(f"üåê Panel dostƒôpny pod: http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    start_api_server()
PYTHON

    chmod +x "$WEB_DIR/api_server.py"

    # Utw√≥rz plik servers.json je≈õli nie istnieje
    if [ ! -f "$PANEL_DIR/servers.json" ]; then
        echo "[]" > "$PANEL_DIR/servers.json"
    fi

    echo -e "${GREEN}‚úÖ System prawdziwych serwer√≥w Minecraft zosta≈Ç utworzony!${NC}"
    echo -e "${PURPLE}üìÅ Strona g≈Ç√≥wna: $WEB_DIR/index.html${NC}"
    echo -e "${PURPLE}üë§ Panel klienta: $WEB_DIR/client/index.html${NC}"
    echo -e "${PURPLE}üîß Backend API: $WEB_DIR/api_server.py${NC}"
}

start_web_server() {
    echo -e "${PURPLE}üåê Uruchamianie serwera PurpleHost z prawdziwymi serwerami...${NC}"
    
    # Sprawd≈∫ czy port jest dostƒôpny
    if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null ; then
        echo -e "${YELLOW}üîÑ Port $PORT jest zajƒôty, zatrzymywanie istniejƒÖcego serwera...${NC}"
        pkill -f "api_server.py"
        sleep 2
    fi
    
    # Uruchom serwer API Python
    cd "$WEB_DIR"
    python3 api_server.py &
    local api_pid=$!
    
    sleep 3
    
    if ps -p $api_pid > /dev/null 2>&1; then
        local ip=$(hostname -I | awk '{print $1}')
        
        echo -e "${GREEN}‚úÖ Serwer PurpleHost z prawdziwymi serwerami Minecraft uruchomiony!${NC}"
        echo -e "${PURPLE}"
        echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo -e "‚ïë                  üü£ PURPLEHOST LIVE                       ‚ïë"
        echo -e "‚ïë              PRAWDZIWE SERWERY MINECRAFT                  ‚ïë"
        echo -e "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üåê Adresy dostƒôpu:                                        ‚ïë"
        echo -e "‚ïë     üìç Strona G≈Ç√≥wna:  http://localhost:$PORT             ‚ïë"
        echo -e "‚ïë     üë§ Panel Klienta: http://localhost:$PORT/client       ‚ïë"
        echo -e "‚ïë     üåç Sieƒá:          http://$ip:$PORT                    ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üéØ PRAWDZIWE SERWERY MINECRAFT:                          ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üì• Official server.jar od Mojang                    ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üöÄ Prawdziwe procesy systemowe                      ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üíª Konsola LIVE z komendami                         ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üìù Logi w czasie rzeczywistym                       ‚ïë"
        echo -e "‚ïë     ‚Ä¢ ‚öôÔ∏è Pe≈Çna konfiguracja server.properties             ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üí° Wejd≈∫ na stronƒô g≈Ç√≥wnƒÖ, kup serwer i uruchom LIVE!    ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"
        
        # Otw√≥rz przeglƒÖdarkƒô je≈õli jest graficzne ≈õrodowisko
        if [ -n "$DISPLAY" ]; then
            echo -e "${YELLOW}üñ•Ô∏è  Otwieranie przeglƒÖdarki...${NC}"
            xdg-open "http://localhost:$PORT" 2>/dev/null &
        fi
        
        # Zapisz PID serwera
        echo $api_pid > "$PANEL_DIR/api_server.pid"
        log "API Server uruchomiony (PID: $api_pid)"
        
    else
        error "‚ùå Nie uda≈Ço siƒô uruchomiƒá serwera API!"
        # Fallback to simple HTTP server
        echo -e "${YELLOW}üîÑ Uruchamianie prostego serwera HTTP...${NC}"
        cd "$WEB_DIR"
        python3 -m http.server $PORT &
    fi
}

# =============================================
# üìú MAIN SCRIPT - AUTOMATYCZNA INSTALACJA
# =============================================

clear

echo -e "${PURPLE}"
echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo -e "‚ïë        üü£ PURPLEHOST LIVE            ‚ïë"
echo -e "‚ïë      PRAWDZIWE SERWERY MINECRAFT     ‚ïë"
echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"
echo -e "${CYAN}Rozpoczynanie instalacji prawdziwych serwer√≥w Minecraft...${NC}"
echo ""

# Inicjalizacja
echo -e "${PURPLE}üöÄ Inicjalizacja systemu...${NC}"
setup_directories
check_dependencies

# Tworzenie panelu
echo -e "${PURPLE}üìù Tworzenie systemu prawdziwych serwer√≥w...${NC}"
create_web_panel

# Uruchamianie serwera
echo -e "${PURPLE}üåê Uruchamianie serwera API...${NC}"
start_web_server

# Komunikat sukcesu
echo -e "${GREEN}"
echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo -e "‚ïë                    üéâ SYSTEM GOTOWY!                      ‚ïë"
echo -e "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  üü£ PURPLEHOST LIVE z prawdziwymi serwerami Minecraft!     ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  Co mo≈ºesz teraz zrobiƒá:                                   ‚ïë"
echo -e "‚ïë  1. Wejd≈∫ na stronƒô g≈Ç√≥wnƒÖ                                 ‚ïë"
echo -e "‚ïë  2. Przejd≈∫ do panelu klienta (/client)                    ‚ïë"
echo -e "‚ïë  3. Utw√≥rz prawdziwy serwer Minecraft                      ‚ïë"
echo -e "‚ïë  4. Uruchom serwer - pobierze official server.jar         ‚ïë"
echo -e "‚ïë  5. ZarzƒÖdzaj przez konsolƒô LIVE                           ‚ïë"
echo -e "‚ïë  6. Graj na swoim serwerze! üéÆ                            ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  Adres: http://localhost:8080                              ‚ïë"
echo -e "‚ïë  Panel: http://localhost:8080/client                       ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"

echo -e "${YELLOW}üìù Aby zatrzymaƒá system, naci≈õnij Ctrl+C${NC}"
echo ""

# Czekaj na sygna≈Ç zako≈Ñczenia
trap 'echo -e "\n${GREEN}üëã Zamykanie PurpleHost...${NC}"; pkill -f "api_server.py"; pkill -f "python3 -m http.server"; exit 0' INT TERM

# Bezczynne czekanie
while true; do
    sleep 60
done
