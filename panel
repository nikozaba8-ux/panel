#!/bin/bash

# ==============================================
# üöÄ COSMIC GAME PANEL - CODESANDBOX EDITION
# ==============================================

# Konfiguracja dla CodeSandbox
PANEL_DIR="/tmp/cosmic-panel"
WEB_DIR="$PANEL_DIR/web"
SERVER_DIR="$PANEL_DIR/servers"
LOG_DIR="$PANEL_DIR/logs"
DB_DIR="$PANEL_DIR/database"
CONFIG_DIR="$PANEL_DIR/config"
BACKUP_DIR="$PANEL_DIR/backups"
TEMP_DIR="$PANEL_DIR/temp"

# Porty dla CodeSandbox
WEB_PORT=${PORT:-8080}

# Kolory kosmiczne
NEBULA_PURPLE='\033[1;35m'
STAR_BLUE='\033[1;34m'
GALAXY_CYAN='\033[1;36m'
PLANET_GREEN='\033[1;32m'
COMET_YELLOW='\033[1;33m'
NOVA_RED='\033[1;31m'
NC='\033[0m'

print_cosmic_header() {
    clear
    echo -e "${NEBULA_PURPLE}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë                                                              ‚ïë"
    echo "‚ïë  üöÄ COSMIC GAME PANEL - CODESANDBOX EDITION                 ‚ïë"
    echo "‚ïë         Intergalactic Control Center                        ‚ïë"
    echo "‚ïë                                                              ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
}

create_structure() {
    print_cosmic_header
    echo -e "${COMET_YELLOW}üöÄ Inicjalizacja struktury kosmicznego panelu...${NC}"
    
    mkdir -p $WEB_DIR $SERVER_DIR $LOG_DIR $DB_DIR $CONFIG_DIR $BACKUP_DIR $TEMP_DIR
    mkdir -p $SERVER_DIR/{fivem,minecraft,discord-bot,valheim}
    mkdir -p $WEB_DIR/{css,js,images,api}
    
    create_database
    create_web_interface
    
    echo -e "${PLANET_GREEN}‚úÖ Struktura panelu zosta≈Ça stworzona!${NC}"
}

create_database() {
    cat > "$DB_DIR/users.json" << 'EOF'
{
    "admin": {
        "password": "cosmic123",
        "email": "admin@cosmicpanel.com",
        "role": "admin",
        "created": "2024-01-01"
    },
    "clients": []
}
EOF

    cat > "$DB_DIR/servers.json" << 'EOF'
{
    "fivem": {
        "name": "FiveM Roleplay",
        "status": "stopped",
        "port": 30120,
        "players": 0,
        "max_players": 32,
        "uptime": 0
    },
    "minecraft": {
        "name": "Minecraft Survival",
        "status": "stopped", 
        "port": 25565,
        "players": 0,
        "max_players": 20,
        "uptime": 0
    },
    "discord-bot": {
        "name": "Discord Bot",
        "status": "stopped",
        "port": 3000,
        "players": 0,
        "max_players": 0,
        "uptime": 0
    },
    "valheim": {
        "name": "Valheim World",
        "status": "stopped",
        "port": 2456,
        "players": 0,
        "max_players": 10,
        "uptime": 0
    }
}
EOF

    cat > "$DB_DIR/packages.json" << 'EOF'
{
    "packages": [
        {
            "id": "starter",
            "name": "Starter Pack",
            "price": 9.99,
            "ram": "2GB",
            "cpu": "1 Core",
            "storage": "10GB",
            "players": "10-20",
            "support": "Basic",
            "popular": false
        },
        {
            "id": "pro",
            "name": "Pro Gamer", 
            "price": 19.99,
            "ram": "4GB",
            "cpu": "2 Cores",
            "storage": "25GB",
            "players": "20-50",
            "support": "Priority",
            "popular": true
        },
        {
            "id": "enterprise",
            "name": "Enterprise",
            "price": 49.99,
            "ram": "8GB",
            "cpu": "4 Cores", 
            "storage": "50GB",
            "players": "Unlimited",
            "support": "24/7",
            "popular": false
        }
    ]
}
EOF
}

create_web_interface() {
    echo -e "${STAR_BLUE}üåê Tworzenie interfejsu kosmicznego...${NC}"
    
    # Strona g≈Ç√≥wna (uproszczona)
    cat > "$WEB_DIR/index.html" << 'EOF'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Cosmic Game Panel</title>
    <style>
        :root {
            --cosmic-dark: #0a0a1a;
            --nebula-purple: #8b5cf6;
            --star-blue: #3b82f6;
            --galaxy-cyan: #06b6d4;
            --planet-green: #10b981;
            --space-white: #ffffff;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1e1b4b 100%);
            color: var(--space-white);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 2rem 0;
        }
        
        .logo {
            font-size: 3rem;
            background: linear-gradient(45deg, var(--galaxy-cyan), var(--nebula-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .nav a {
            color: var(--space-white);
            text-decoration: none;
            padding: 1rem 2rem;
            border: 2px solid var(--nebula-purple);
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav a:hover {
            background: var(--nebula-purple);
            transform: translateY(-2px);
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }
        
        .feature-card {
            background: rgba(30, 27, 75, 0.6);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid var(--nebula-purple);
            text-align: center;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            text-align: center;
            margin: 3rem 0;
        }
        
        .stat {
            background: rgba(30, 27, 75, 0.4);
            padding: 2rem;
            border-radius: 10px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            color: var(--planet-green);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üöÄ COSMIC GAME PANEL</div>
            <p>Next-generation game server management with cosmic power</p>
        </div>
        
        <div class="nav">
            <a href="/index.html">Home</a>
            <a href="/packages.html">Packages</a>
            <a href="/client.html">Client Panel</a>
            <a href="/admin.html">Admin</a>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <h3>üöÄ Lightning Fast</h3>
                <p>Ultra-responsive control panel with real-time monitoring</p>
            </div>
            <div class="feature-card">
                <h3>üîí Secure</h3>
                <p>Military-grade encryption and secure access controls</p>
            </div>
            <div class="feature-card">
                <h3>üåå Cosmic Scale</h3>
                <p>Manage unlimited servers across the galaxy</p>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="servers-count">127</div>
                <div>Active Servers</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="players-count">842</div>
                <div>Online Players</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="uptime-count">99.9%</div>
                <div>Uptime</div>
            </div>
        </div>
    </div>
</body>
</html>
EOF

    # Strona z pakietami
    cat > "$WEB_DIR/packages.html" << 'EOF'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packages - Cosmic Game Panel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1e1b4b 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .packages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .package {
            background: rgba(30, 27, 75, 0.6);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid #8b5cf6;
            text-align: center;
        }
        
        .package.popular {
            border-color: #f59e0b;
            transform: scale(1.05);
        }
        
        .price {
            font-size: 2.5rem;
            color: #10b981;
            margin: 1rem 0;
        }
        
        .btn {
            display: inline-block;
            padding: 1rem 2rem;
            background: #8b5cf6;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center;">üöÄ Cosmic Packages</h1>
        <div class="packages">
            <div class="package">
                <h3>Starter Pack</h3>
                <div class="price">$9.99</div>
                <ul style="text-align: left;">
                    <li>üîÑ 2GB RAM</li>
                    <li>‚ö° 1 Core CPU</li>
                    <li>üíæ 10GB Storage</li>
                    <li>üë• 10-20 Players</li>
                </ul>
                <a href="/client.html" class="btn">Get Started</a>
            </div>
            
            <div class="package popular">
                <h3>Pro Gamer</h3>
                <div class="price">$19.99</div>
                <ul style="text-align: left;">
                    <li>üîÑ 4GB RAM</li>
                    <li>‚ö° 2 Cores CPU</li>
                    <li>üíæ 25GB Storage</li>
                    <li>üë• 20-50 Players</li>
                </ul>
                <a href="/client.html" class="btn">Get Started</a>
            </div>
            
            <div class="package">
                <h3>Enterprise</h3>
                <div class="price">$49.99</div>
                <ul style="text-align: left;">
                    <li>üîÑ 8GB RAM</li>
                    <li>‚ö° 4 Cores CPU</li>
                    <li>üíæ 50GB Storage</li>
                    <li>üë• Unlimited Players</li>
                </ul>
                <a href="/client.html" class="btn">Get Started</a>
            </div>
        </div>
    </div>
</body>
</html>
EOF

    create_client_panel
    create_admin_panel
    create_api_server
}

create_client_panel() {
    cat > "$WEB_DIR/client.html" << 'EOF'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Panel - Cosmic Game Panel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1e1b4b 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .servers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .server-card {
            background: rgba(30, 27, 75, 0.6);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid #8b5cf6;
        }
        
        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .status.running { background: #10b981; color: black; }
        .status.stopped { background: #ef4444; color: white; }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .btn {
            padding: 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-start { background: #10b981; }
        .btn-stop { background: #ef4444; }
        .btn-restart { background: #f59e0b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Your Cosmic Servers</h1>
        
        <div class="servers" id="servers-container">
            <div class="server-card">
                <div class="server-header">
                    <div>
                        <h3>FiveM Roleplay</h3>
                        <small>Port: 30120</small>
                    </div>
                    <div class="status running">RUNNING</div>
                </div>
                <div class="server-info">
                    <div>Players: 12/32</div>
                    <div>Uptime: 8h</div>
                </div>
                <div class="controls">
                    <button class="btn btn-stop">Stop</button>
                    <button class="btn btn-restart">Restart</button>
                    <button class="btn" style="background: #3b82f6;">Console</button>
                </div>
            </div>
            
            <div class="server-card">
                <div class="server-header">
                    <div>
                        <h3>Minecraft Survival</h3>
                        <small>Port: 25565</small>
                    </div>
                    <div class="status stopped">STOPPED</div>
                </div>
                <div class="server-info">
                    <div>Players: 0/20</div>
                    <div>Uptime: 0h</div>
                </div>
                <div class="controls">
                    <button class="btn btn-start">Start</button>
                    <button class="btn btn-restart">Restart</button>
                    <button class="btn" style="background: #3b82f6;">Console</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
EOF
}

create_admin_panel() {
    cat > "$WEB_DIR/admin.html" << 'EOF'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Cosmic Game Panel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1e1b4b 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .stat-card {
            background: rgba(30, 27, 75, 0.6);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #3b82f6;
        }
        
        .stat-number {
            font-size: 2rem;
            color: #10b981;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .admin-section {
            background: rgba(30, 27, 75, 0.6);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid #8b5cf6;
        }
        
        .user-list, .server-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .user-item, .server-item {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: black; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Cosmic Admin Panel</h1>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">5</div>
                <div>Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div>Active Servers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">45%</div>
                <div>System Load</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">$99.95</div>
                <div>Monthly Revenue</div>
            </div>
        </div>
        
        <div class="admin-grid">
            <div class="admin-section">
                <h3>üë• User Management</h3>
                <div class="user-list">
                    <div class="user-item">
                        <div>
                            <strong>admin</strong>
                            <div style="font-size: 0.8em; color: #ccc;">admin@cosmicpanel.com</div>
                        </div>
                        <span>Admin</span>
                    </div>
                    <div class="user-item">
                        <div>
                            <strong>john_doe</strong>
                            <div style="font-size: 0.8em; color: #ccc;">john@example.com</div>
                        </div>
                        <button class="btn btn-danger">Delete</button>
                    </div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3>üéÆ Server Management</h3>
                <div class="server-list">
                    <div class="server-item">
                        <div>
                            <strong>FiveM Roleplay</strong>
                            <div style="font-size: 0.8em; color: #ccc;">Status: Running</div>
                        </div>
                        <button class="btn btn-warning">Restart</button>
                    </div>
                    <div class="server-item">
                        <div>
                            <strong>Minecraft Survival</strong>
                            <div style="font-size: 0.8em; color: #ccc;">Status: Stopped</div>
                        </div>
                        <button class="btn btn-warning">Restart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
EOF
}

create_api_server() {
    cat > "$WEB_DIR/server.js" << 'EOF'
const http = require('http');
const fs = require('fs');
const path = require('path');

const PANEL_DIR = '/tmp/cosmic-panel';
const DB_DIR = path.join(PANEL_DIR, 'database');
const WEB_DIR = path.join(PANEL_DIR, 'web');

const MIME_TYPES = {
    '.html': 'text/html',
    '.css': 'text/css',
    '.js': 'application/javascript',
    '.json': 'application/json',
    '.png': 'image/png',
    '.jpg': 'image/jpeg'
};

class CosmicServer {
    constructor() {
        this.server = http.createServer((req, res) => this.handleRequest(req, res));
        this.port = process.env.PORT || 8080;
    }

    handleRequest(req, res) {
        const url = new URL(req.url, `http://${req.headers.host}`);
        
        try {
            if (req.method === 'GET') {
                this.handleGet(url, req, res);
            } else if (req.method === 'POST') {
                this.handlePost(url, req, res);
            } else {
                this.sendResponse(res, 404, { error: 'Not found' });
            }
        } catch (error) {
            this.sendResponse(res, 500, { error: error.message });
        }
    }

    handleGet(url, req, res) {
        if (url.pathname === '/') {
            this.serveFile(res, 'index.html');
        } else if (url.pathname === '/api/servers') {
            this.serveServers(res);
        } else if (url.pathname === '/api/packages') {
            this.servePackages(res);
        } else {
            this.serveStatic(url.pathname, res);
        }
    }

    handlePost(url, req, res) {
        let body = '';
        req.on('data', chunk => body += chunk);
        req.on('end', () => {
            try {
                const data = JSON.parse(body);
                
                if (url.pathname === '/api/control') {
                    this.handleServerControl(data, res);
                } else if (url.pathname === '/api/admin/login') {
                    this.handleAdminLogin(data, res);
                } else {
                    this.sendResponse(res, 404, { error: 'Not found' });
                }
            } catch (error) {
                this.sendResponse(res, 400, { error: 'Invalid JSON' });
            }
        });
    }

    serveFile(res, filename) {
        const filepath = path.join(WEB_DIR, filename);
        this.sendFile(res, filepath);
    }

    serveStatic(filepath, res) {
        const fullPath = path.join(WEB_DIR, filepath.substring(1));
        this.sendFile(res, fullPath);
    }

    sendFile(res, filepath) {
        if (!fs.existsSync(filepath)) {
            this.sendResponse(res, 404, { error: 'File not found' });
            return;
        }

        const ext = path.extname(filepath);
        const mimeType = MIME_TYPES[ext] || 'text/plain';
        
        fs.readFile(filepath, (err, data) => {
            if (err) {
                this.sendResponse(res, 500, { error: 'Error reading file' });
                return;
            }

            res.writeHead(200, { 'Content-Type': mimeType });
            res.end(data);
        });
    }

    serveServers(res) {
        try {
            const serversPath = path.join(DB_DIR, 'servers.json');
            const serversData = fs.readFileSync(serversPath, 'utf8');
            const servers = JSON.parse(serversData);
            
            // Update with mock data
            Object.keys(servers).forEach(serverId => {
                servers[serverId].players = Math.floor(Math.random() * servers[serverId].max_players);
                servers[serverId].uptime = Math.floor(Math.random() * 24);
            });
            
            this.sendResponse(res, 200, servers);
        } catch (error) {
            this.sendResponse(res, 500, { error: 'Error reading servers' });
        }
    }

    servePackages(res) {
        try {
            const packagesPath = path.join(DB_DIR, 'packages.json');
            const packagesData = fs.readFileSync(packagesPath, 'utf8');
            const packages = JSON.parse(packagesData);
            this.sendResponse(res, 200, packages);
        } catch (error) {
            this.sendResponse(res, 500, { error: 'Error reading packages' });
        }
    }

    handleServerControl(data, res) {
        const { server, action } = data;
        
        // Simulate server control
        setTimeout(() => {
            this.sendResponse(res, 200, { 
                status: 'success', 
                message: `Server ${server} ${action} command received` 
            });
        }, 1000);
    }

    handleAdminLogin(data, res) {
        const { username, password } = data;
        
        if (username === 'admin' && password === 'cosmic123') {
            this.sendResponse(res, 200, { success: true });
        } else {
            this.sendResponse(res, 401, { success: false, message: 'Invalid credentials' });
        }
    }

    sendResponse(res, statusCode, data) {
        res.writeHead(statusCode, {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
            'Access-Control-Allow-Headers': 'Content-Type'
        });
        res.end(JSON.stringify(data));
    }

    start() {
        this.server.listen(this.port, () => {
            console.log(`üöÄ Cosmic Game Panel running on port ${this.port}`);
            console.log(`üåê Web Interface: http://localhost:${this.port}`);
            console.log(`üë§ Admin Panel: http://localhost:${this.port}/admin.html`);
            console.log(`üéÆ Client Panel: http://localhost:${this.port}/client.html`);
        });
    }
}

// Start the server
const cosmicServer = new CosmicServer();
cosmicServer.start();
EOF
}

start_services() {
    echo -e "${STAR_BLUE}üöÄ Uruchamianie us≈Çug kosmicznych...${NC}"
    
    # Sprawd≈∫ czy Node.js jest dostƒôpny
    if ! command -v node &> /dev/null; then
        echo -e "${COMET_YELLOW}üì¶ Node.js nie jest dostƒôpny, u≈ºywam Python...${NC}"
        start_python_server
    else
        # Uruchom serwer Node.js
        cd "$WEB_DIR"
        node server.js > "$LOG_DIR/server.log" 2>&1 &
        echo $! > "$PANEL_DIR/server.pid"
        echo -e "${PLANET_GREEN}‚úÖ Serwer Node.js uruchomiony!${NC}"
    fi
}

start_python_server() {
    # Prosty serwer HTTP w Pythonie
    cd "$WEB_DIR"
    python3 -m http.server $WEB_PORT > "$LOG_DIR/server.log" 2>&1 &
    echo $! > "$PANEL_DIR/server.pid"
    echo -e "${PLANET_GREEN}‚úÖ Serwer Python uruchomiony na porcie $WEB_PORT!${NC}"
}

show_status() {
    print_cosmic_header
    echo -e "${GALAXY_CYAN}=== üöÄ STATUS KOSMICZNEGO PANELU ===${NC}"
    
    # Sprawd≈∫ serwer
    if [ -f "$PANEL_DIR/server.pid" ] && kill -0 $(cat "$PANEL_DIR/server.pid") 2>/dev/null; then
        echo -e "üåê Web Server:    ${PLANET_GREEN}RUNNING${NC} (port $WEB_PORT)"
    else
        echo -e "üåê Web Server:    ${NOVA_RED}STOPPED${NC}"
    fi
    
    echo -e "\n${COMET_YELLOW}üìä INFORMACJE:${NC}"
    echo -e "  üìÅ Panel Directory: $PANEL_DIR"
    echo -e "  üåê Web Directory: $WEB_DIR"
    echo -e "  üíæ Database: $DB_DIR"
    echo -e "  üìù Logs: $LOG_DIR"
}

cosmic_menu() {
    while true; do
        print_cosmic_header
        show_status | tail -n +3
        
        echo -e "\n${NEBULA_PURPLE}‚îå‚îÄüöÄ KOSMICZNE MENU‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${NC}"
        echo -e "  ${PLANET_GREEN}1. üöÄ Start Services${NC}"
        echo -e "  ${NOVA_RED}2. üõë Stop Services${NC}"
        echo -e "  ${COMET_YELLOW}3. üåê Open Web Panel${NC}"
        echo -e "  ${GALAXY_CYAN}4. üõ†Ô∏è  Reinstall Panel${NC}"
        echo -e "  ${STAR_BLUE}5. üìä System Info${NC}"
        echo -e "  ${NOVA_RED}0. ‚ùå Exit${NC}"
        echo -e "${NEBULA_PURPLE}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${NC}"
        echo ""
        read -p "$(echo -e "${GALAXY_CYAN}üöÄ Wybierz opcjƒô [0-5]: ${NC}")" choice
        
        case $choice in
            1)
                start_services
                sleep 2
                ;;
            2)
                if [ -f "$PANEL_DIR/server.pid" ]; then
                    kill $(cat "$PANEL_DIR/server.pid") 2>/dev/null
                    rm "$PANEL_DIR/server.pid"
                    echo -e "${PLANET_GREEN}‚úÖ Us≈Çugi zatrzymane!${NC}"
                fi
                ;;
            3)
                echo -e "${COMET_YELLOW}üåê Otwieranie panelu web...${NC}"
                echo -e "${STAR_BLUE}üìã Adres: http://localhost:$WEB_PORT${NC}"
                echo -e "${GALAXY_CYAN}üë§ Admin: http://localhost:$WEB_PORT/admin.html${NC}"
                echo -e "${PLANET_GREEN}üéÆ Client: http://localhost:$WEB_PORT/client.html${NC}"
                ;;
            4)
                echo -e "${COMET_YELLOW}üõ†Ô∏è  Przeinstalowywanie panelu...${NC}"
                rm -rf $PANEL_DIR
                create_structure
                ;;
            5)
                show_status
                ;;
            0)
                if [ -f "$PANEL_DIR/server.pid" ]; then
                    kill $(cat "$PANEL_DIR/server.pid") 2>/dev/null
                fi
                echo -e "${GALAXY_CYAN}üëã Do zobaczenia!${NC}"
                exit 0
                ;;
            *)
                echo -e "${NOVA_RED}‚ùå Nieprawid≈Çowy wyb√≥r${NC}"
                ;;
        esac
        echo ""
        read -p "$(echo -e "${COMET_YELLOW}üåå Naci≈õnij Enter aby kontynuowaƒá...${NC}")"
    done
}

# G≈Ç√≥wna funkcja
main() {
    # Sprawd≈∫ czy CodeSandbox
    if [ -n "$CODESANDBOX_HOST" ] || [ -n "$SANDBOX_URL" ]; then
        echo -e "${COMET_YELLOW}üåê Wykryto ≈õrodowisko CodeSandbox${NC}"
        WEB_PORT=$PORT
    fi

    case "${1:-}" in
        "install")
            create_structure
            ;;
        "start")
            start_services
            ;;
        "stop")
            if [ -f "$PANEL_DIR/server.pid" ]; then
                kill $(cat "$PANEL_DIR/server.pid") 2>/dev/null
                rm "$PANEL_DIR/server.pid"
            fi
            ;;
        "status")
            show_status
            ;;
        "menu")
            cosmic_menu
            ;;
        *)
            if [ ! -d "$PANEL_DIR" ]; then
                create_structure
            fi
            start_services
            cosmic_menu
            ;;
    esac
}

# Uruchom g≈Ç√≥wnƒÖ funkcjƒô
main "$@"
