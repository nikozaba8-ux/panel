#!/bin/bash

# =============================================
# üü£ PURPLEHOST + PLAYIT.GG INTEGRATION
# =============================================

# Konfiguracja
PANEL_DIR="/home/purplehost"
WEB_DIR="$PANEL_DIR/web"
SERVER_DIR="$PANEL_DIR/serwery"
DB_DIR="$PANEL_DIR/bazy"
BACKUP_DIR="$PANEL_DIR/backupy"
LOG_DIR="$PANEL_DIR/logs"
NODE_DIR="$PANEL_DIR/node"
PLAYIT_DIR="$PANEL_DIR/playit"
PORT=8080

# Kolory
PURPLE='\033[0;35m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# =============================================
# üõ†Ô∏è FUNKCJE POMOCNICZE
# =============================================

log() {
    echo -e "${PURPLE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_DIR/panel.log"
}

setup_directories() {
    echo -e "${PURPLE}üìÅ Tworzenie struktur katalog√≥w...${NC}"
    mkdir -p "$PANEL_DIR" "$WEB_DIR" "$SERVER_DIR" "$DB_DIR" "$BACKUP_DIR" "$LOG_DIR" "$NODE_DIR" "$PLAYIT_DIR"
    mkdir -p "$SERVER_DIR/minecraft" "$SERVER_DIR/rust" "$SERVER_DIR/ark" "$SERVER_DIR/csgo" "$SERVER_DIR/teamspeak"
    log "Struktura katalog√≥w PurpleHost utworzona"
}

check_dependencies() {
    echo -e "${PURPLE}üîç Sprawdzanie zale≈ºno≈õci...${NC}"
    
    if ! command -v python3 &> /dev/null; then
        echo -e "${YELLOW}üì¶ Instalowanie Pythona 3...${NC}"
        apt update > /dev/null 2>&1
        apt install -y python3 > /dev/null 2>&1
    fi
    
    if ! command -v java &> /dev/null; then
        echo -e "${YELLOW}‚òï Instalowanie Java...${NC}"
        apt install -y default-jre > /dev/null 2>&1
    fi
    
    if ! command -v wget &> /dev/null; then
        echo -e "${YELLOW}üì• Instalowanie wget...${NC}"
        apt install -y wget > /dev/null 2>&1
    fi
    
    if ! command -v curl &> /dev/null; then
        echo -e "${YELLOW}üì° Instalowanie curl...${NC}"
        apt install -y curl > /dev/null 2>&1
    fi
    
    echo -e "${GREEN}‚úÖ Wszystkie zale≈ºno≈õci sƒÖ dostƒôpne${NC}"
}

install_playit() {
    echo -e "${PURPLE}üöÄ Instalowanie playit.gg...${NC}"
    
    cd "$PLAYIT_DIR"
    
    # Pobierz playit.gg
    echo -e "${CYAN}üì• Pobieranie playit.gg...${NC}"
    wget -q https://playit.gg/download -O playit
    chmod +x playit
    
    # Utw√≥rz plik konfiguracyjny
    cat > config.yml << EOF
# Playit.gg Configuration
# Generated by PurpleHost
agent_id: purplehost_$(date +%s)
EOF

    echo -e "${GREEN}‚úÖ Playit.gg zainstalowany${NC}"
    echo -e "${YELLOW}üí° Uruchom playit rƒôcznie: ./playit${NC}"
}

# =============================================
# üéÆ FUNKCJE PRAWDZIWYCH SERWER√ìW Z PLAYIT.GG
# =============================================

create_minecraft_server() {
    local server_id="$1"
    local server_name="$2"
    local version="$3"
    local slots="$4"
    
    echo -e "${PURPLE}üéÆ Tworzenie serwera Minecraft $server_id...${NC}"
    
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    mkdir -p "$server_dir"
    
    cd "$server_dir"
    
    # Pobierz official Minecraft server
    if [ "$version" == "latest" ] || [ "$version" == "Najnowsza" ]; then
        echo -e "${CYAN}‚¨áÔ∏è  Pobieranie najnowszej wersji Minecraft...${NC}"
        wget -q "https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar" -O server.jar
    else
        echo -e "${CYAN}‚¨áÔ∏è  Pobieranie wersji $version...${NC}"
        wget -q "https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar" -O server.jar
    fi
    
    # Podstawowa konfiguracja
    echo -e "${CYAN}‚öôÔ∏è  Konfigurowanie serwera...${NC}"
    
    # Plik eula.txt (wymagany)
    echo "eula=true" > eula.txt
    
    # Server properties z dynamicznym portem
    local server_port=$((25565 + server_id))
    cat > server.properties << EOF
# Minecraft Server Properties
# Generated by PurpleHost
server-port=$server_port
online-mode=false
level-type=default
max-players=$slots
motd=$server_name
view-distance=10
simulation-distance=10
spawn-protection=0
enable-command-block=true
max-world-size=29999984
EOF

    # Skrypt startowy z playit
    cat > start.sh << EOF
#!/bin/bash
cd "\$(dirname "\$0")"
echo "üü£ Uruchamianie serwera Minecraft na porcie $server_port..."
echo "üåê Playit.gg URL: https://playit.gg/agent (po uruchomieniu playit)"
java -Xmx1024M -Xms1024M -jar server.jar nogui
EOF

    chmod +x start.sh
    
    # Skrypt do uruchomienia z playit
    cat > start_with_playit.sh << EOF
#!/bin/bash
cd "\$(dirname "\$0")"
echo "üéÆ Uruchamianie serwera Minecraft z playit.gg..."
echo "üì° Serwer bƒôdzie dostƒôpny przez playit.gg"
echo "üîó Uruchom playit.gg w osobnym terminalu: cd $PLAYIT_DIR && ./playit"
java -Xmx1024M -Xms1024M -jar server.jar nogui
EOF

    chmod +x start_with_playit.sh
    
    echo -e "${GREEN}‚úÖ Serwer Minecraft utworzony: $server_dir${NC}"
    echo -e "${CYAN}üîß Port: $server_port${NC}"
    echo -e "${CYAN}üéØ Sloty: $slots${NC}"
    
    return 0
}

start_minecraft_server() {
    local server_id="$1"
    
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -d "$server_dir" ]; then
        echo -e "${RED}‚ùå Katalog serwera nie istnieje: $server_dir${NC}"
        return 1
    fi
    
    cd "$server_dir"
    
    # Sprawd≈∫ czy serwer ju≈º dzia≈Ça
    if [ -f "server.pid" ]; then
        local pid=$(cat server.pid)
        if ps -p $pid > /dev/null 2>&1; then
            echo -e "${YELLOW}‚ö†Ô∏è  Serwer ju≈º dzia≈Ça (PID: $pid)${NC}"
            return 0
        fi
    fi
    
    echo -e "${PURPLE}üöÄ Uruchamianie serwera Minecraft...${NC}"
    
    # Uruchom serwer w tle
    java -Xmx1024M -Xms1024M -jar server.jar nogui > server.log 2>&1 &
    local minecraft_pid=$!
    
    # Zapisz PID
    echo $minecraft_pid > server.pid
    
    # Pobierz port z konfiguracji
    local server_port=$(grep "server-port" server.properties | cut -d'=' -f2)
    
    echo -e "${GREEN}‚úÖ Serwer Minecraft uruchomiony (PID: $minecraft_pid)${NC}"
    echo -e "${CYAN}üîß Port: $server_port${NC}"
    echo -e "${CYAN}üìù Logi: $server_dir/server.log${NC}"
    echo -e "${YELLOW}üåê Aby udostƒôpniƒá serwer przez internet, uruchom playit.gg${NC}"
    echo -e "${BLUE}üí° Komenda: cd $PLAYIT_DIR && ./playit${NC}"
    
    # Poczekaj chwilƒô na inicjalizacjƒô
    sleep 5
    
    # Sprawd≈∫ czy serwer dzia≈Ça
    if ps -p $minecraft_pid > /dev/null 2>&1; then
        echo -e "${GREEN}üéÆ Serwer Minecraft jest teraz LIVE!${NC}"
        return 0
    else
        echo -e "${RED}‚ùå Nie uda≈Ço siƒô uruchomiƒá serwera Minecraft${NC}"
        return 1
    fi
}

stop_minecraft_server() {
    local server_id="$1"
    
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -f "$server_dir/server.pid" ]; then
        echo -e "${YELLOW}‚ö†Ô∏è  Serwer nie by≈Ç uruchomiony${NC}"
        return 0
    fi
    
    cd "$server_dir"
    local pid=$(cat server.pid)
    
    echo -e "${PURPLE}üõë Zatrzymywanie serwera Minecraft (PID: $pid)...${NC}"
    
    # Wy≈õlij polecenie stop do konsoli Minecraft
    if ps -p $pid > /dev/null 2>&1; then
        # Spr√≥buj gracyjnie zatrzymaƒá
        echo "stop" > /proc/$pid/fd/0 2>/dev/null || true
        sleep 5
        
        # Je≈õli nadal dzia≈Ça, zabij proces
        if ps -p $pid > /dev/null 2>&1; then
            kill $pid
            sleep 2
        fi
        
        # Wymu≈õ zabicie je≈õli nadal ≈ºyje
        if ps -p $pid > /dev/null 2>&1; then
            kill -9 $pid
        fi
    fi
    
    # Usu≈Ñ plik PID
    rm -f server.pid
    
    echo -e "${GREEN}‚úÖ Serwer Minecraft zosta≈Ç zatrzymany${NC}"
    return 0
}

get_server_status() {
    local server_id="$1"
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ ! -f "$server_dir/server.pid" ]; then
        echo "offline"
        return
    fi
    
    local pid=$(cat "$server_dir/server.pid" 2>/dev/null)
    if [ -z "$pid" ] || ! ps -p $pid > /dev/null 2>&1; then
        echo "offline"
    else
        echo "online"
    fi
}

get_server_port() {
    local server_id="$1"
    local server_dir="$SERVER_DIR/minecraft/server_$server_id"
    
    if [ -f "$server_dir/server.properties" ]; then
        grep "server-port" "$server_dir/server.properties" | cut -d'=' -f2
    else
        echo "25565"
    fi
}

# =============================================
# üåê TWORZENIE PANELU Z PLAYIT.GG INTEGRATION
# =============================================

create_web_panel() {
    echo -e "${PURPLE}üåê Tworzenie panelu z integracjƒÖ playit.gg...${NC}"
    
    # Strona g≈Ç√≥wna
    cat > "$WEB_DIR/index.html" << 'HTML'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üü£ PurpleHost + Playit.gg</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #6a11cb;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background: #6a11cb;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .hero {
            text-align: center;
            padding: 80px 20px;
            color: white;
        }
        
        .hero h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.3em;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 1.1em;
        }
        
        .btn-primary {
            background: #6a11cb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a0db3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }
        
        .btn-playit {
            background: #ff6b35;
            color: white;
        }
        
        .btn-playit:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #856404;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .playit-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: white;
            margin-top: 60px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav-container">
            <div class="logo">üü£ PurpleHost + üåê Playit.gg</div>
            <ul class="nav-menu">
                <li><a href="#" class="active">Strona G≈Ç√≥wna</a></li>
                <li><a href="/client">Panel Klienta</a></li>
                <li><a href="#">Playit.gg</a></li>
                <li><a href="#">Pomoc</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h1>üü£ PurpleHost + üåê Playit.gg</h1>
            <p>Prawdziwe serwery Minecraft dostƒôpne z internetu przez playit.gg</p>
            <div style="margin-top: 30px;">
                <a href="/client" class="btn btn-primary">üéÆ Utw√≥rz Serwer</a>
                <a href="https://playit.gg" target="_blank" class="btn btn-playit" style="margin-left: 15px;">üåê Playit.gg</a>
            </div>
        </div>

        <div class="warning-banner">
            ‚ö†Ô∏è <strong>Warning out...</strong> Not this convention postupancy is a twoism location.
        </div>

        <!-- Playit.gg Section -->
        <div class="playit-section">
            <h2 style="color: #6a11cb; margin-bottom: 20px; font-size: 2.5em;">üåê Playit.gg Integration</h2>
            <p style="font-size: 1.2em; margin-bottom: 25px; color: #666;">
                Twoje serwery Minecraft bƒôdƒÖ dostƒôpne z internetu przez playit.gg<br>
                Bez konfiguracji routera, bez statycznego IP - po prostu dzia≈Ça!
            </p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üöÄ</div>
                    <h3>Automatyczne TCP Tunneling</h3>
                    <p>Playit.gg automatycznie tworzy tunele do twoich serwer√≥w</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üåç</div>
                    <h3>Dostƒôp z Internetu</h3>
                    <p>Graj z przyjaci√≥≈Çmi z ca≈Çego ≈õwiata</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üîí</div>
                    <h3>Bezpieczne Po≈ÇƒÖczenia</h3>
                    <p>Zabezpieczone tunele z SSL</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>≈Åatwa Konfiguracja</h3>
                    <p>Zero konfiguracji routera</p>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <a href="https://playit.gg" target="_blank" class="btn btn-playit" style="font-size: 1.2em; padding: 15px 40px;">
                    üöÄ Uruchom Playit.gg
                </a>
            </div>
        </div>

        <!-- Instrukcja -->
        <div class="info-box">
            <h2 style="color: #6a11cb; margin-bottom: 25px;">üìã Jak uruchomiƒá serwer z playit.gg</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="color: #6a11cb; margin-bottom: 15px;">Krok 1: Uruchom Playit.gg</h3>
                    <ol style="line-height: 2; color: #666;">
                        <li>Pobierz playit.gg z oficjalnej strony</li>
                        <li>Uruchom w terminalu: <code>./playit</code></li>
                        <li>Zaloguj siƒô przez przeglƒÖdarkƒô</li>
                        <li>Playit automatycznie wykryje serwery</li>
                    </ol>
                </div>
                
                <div>
                    <h3 style="color: #6a11cb; margin-bottom: 15px;">Krok 2: Udostƒôpnij Serwer</h3>
                    <ol style="line-height: 2; color: #666;">
                        <li>Utw√≥rz serwer w panelu klienta</li>
                        <li>Uruchom serwer Minecraft</li>
                        <li>Playit poka≈ºe publiczny URL</li>
                        <li>Podaj URL znajomym do gry!</li>
                    </ol>
                </div>
            </div>
            
            <div style="margin-top: 25px; padding: 20px; background: #e3f2fd; border-radius: 8px;">
                <h4 style="color: #1976d2; margin-bottom: 10px;">üí° Przyk≈Çadowe URL playit.gg:</h4>
                <code style="background: #1e1e1e; color: #00ff00; padding: 10px; border-radius: 5px; display: block;">
                    mc.playit.gg:25565<br>
                    lub<br>
                    custom-name.playit.gg
                </code>
            </div>
        </div>

        <!-- Panel Klienta Info -->
        <div class="playit-section">
            <h2 style="color: #6a11cb; margin-bottom: 20px; font-size: 2em;">üéÆ Panel Klienta</h2>
            <p style="font-size: 1.2em; margin-bottom: 30px; color: #666;">
                Utw√≥rz i zarzƒÖdzaj prawdziwymi serwerami Minecraft z integracjƒÖ playit.gg
            </p>
            <a href="/client" class="btn btn-primary" style="font-size: 1.2em; padding: 15px 40px;">
                üöÄ Przejd≈∫ do Panelu Klienta
            </a>
        </div>
    </div>

    <div class="footer">
        Copyright ¬© 2025 purpleHost.ru + Playit.gg Integration
    </div>

    <script>
        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
HTML

    # Panel Klienta z integracjƒÖ playit.gg
    mkdir -p "$WEB_DIR/client"
    
    cat > "$WEB_DIR/client/index.html" << 'HTML'
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë§ Panel Klienta - PurpleHost + Playit.gg</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #6a11cb;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background: #6a11cb;
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .welcome-banner {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #856404;
        }
        
        .playit-banner {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .servers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .server-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #6a11cb;
        }
        
        .server-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .server-icon {
            font-size: 2em;
        }
        
        .server-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
        }
        
        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        .server-info {
            margin-bottom: 15px;
        }
        
        .server-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            flex: 1;
        }
        
        .btn-primary {
            background: #6a11cb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a0db3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-playit {
            background: #ff6b35;
            color: white;
        }
        
        .create-server-btn {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            margin: 20px 0;
            display: block;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .create-server-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .server-details {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .server-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .tab {
            padding: 12px 25px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: #6a11cb;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .playit-info {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: white;
            font-size: 0.9em;
        }
        
        .no-servers {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav-container">
            <div class="logo">üü£ PurpleHost + üåê Playit.gg</div>
            <ul class="nav-menu">
                <li><a href="/">üè† Strona G≈Ç√≥wna</a></li>
                <li><a href="#" class="active">üë§ Moje Serwery</a></li>
                <li><a href="https://playit.gg" target="_blank">üåê Playit.gg</a></li>
                <li><a href="#">üí≥ P≈Çatno≈õci</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div class="welcome-banner">
            <h1>üë§ Prawdziwe Serwery z Playit.gg</h1>
            <p>Tw√≥rz i zarzƒÖdzaj serwerami Minecraft dostƒôpnymi z internetu</p>
        </div>

        <div class="warning-banner">
            ‚ö†Ô∏è <strong>Warning out...</strong> Not this convention postupancy is a twoism location.
        </div>

        <div class="playit-banner">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üåê Playit.gg Integration</h3>
            <p style="margin-bottom: 15px;">Twoje serwery bƒôdƒÖ automatycznie wykrywane przez playit.gg i dostƒôpne z internetu!</p>
            <a href="https://playit.gg" target="_blank" class="btn btn-playit">üöÄ Uruchom Playit.gg</a>
        </div>

        <!-- Przycisk tworzenia serwera -->
        <button class="create-server-btn" onclick="showCreateServerForm()">
            ‚ûï Utw√≥rz Nowy Serwer Minecraft
        </button>

        <!-- Lista serwer√≥w -->
        <div id="serversList">
            <div class="no-servers" id="noServersMessage">
                <div style="font-size: 4em; margin-bottom: 20px; opacity: 0.5;">‚õèÔ∏è</div>
                <h2>Brak serwer√≥w Minecraft</h2>
                <p>Nie masz jeszcze ≈ºadnych serwer√≥w. Utw√≥rz pierwszy serwer z integracjƒÖ playit.gg!</p>
                <button class="btn btn-primary" onclick="showCreateServerForm()" style="margin-top: 20px;">
                    üöÄ Utw√≥rz Pierwszy Serwer
                </button>
            </div>
            
            <div class="servers-grid" id="serversGrid" style="display: none;">
                <!-- Serwery bƒôdƒÖ dodawane dynamicznie -->
            </div>
        </div>

        <!-- Formularz tworzenia serwera -->
        <div id="createServerForm" class="server-details">
            <h2 style="color: #6a11cb; margin-bottom: 25px;">üõ†Ô∏è Tworzenie Serwera Minecraft</h2>
            
            <div class="form-group">
                <label for="serverName">Nazwa Serwera:</label>
                <input type="text" class="form-control" id="serverName" placeholder="Moj Super Serwer Minecraft">
            </div>
            
            <div class="form-group">
                <label for="serverVersion">Wersja Minecraft:</label>
                <select class="form-control" id="serverVersion">
                    <option value="latest">1.20.4 (Najnowsza)</option>
                    <option value="1.20.1">1.20.1</option>
                    <option value="1.19.4">1.19.4</option>
                    <option value="1.18.2">1.18.2</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="serverSlots">Maksymalna liczba graczy:</label>
                <select class="form-control" id="serverSlots">
                    <option value="10">10 graczy</option>
                    <option value="20">20 graczy</option>
                    <option value="30">30 graczy</option>
                    <option value="50">50 graczy</option>
                </select>
            </div>
            
            <div class="playit-info">
                <h4 style="color: #ff6b35; margin-bottom: 10px;">üåê Playit.gg Integration</h4>
                <p>Ten serwer bƒôdzie automatycznie wykrywany przez playit.gg po uruchomieniu.</p>
                <p><strong>Wymagane:</strong> Uruchom playit.gg w terminalu: <code>cd /home/purplehost/playit && ./playit</code></p>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-success" onclick="createRealServer()" style="flex: 2;">
                    üöÄ Utw√≥rz Prawdziwy Serwer
                </button>
                <button class="btn btn-danger" onclick="hideCreateServerForm()" style="flex: 1;">‚ùå Anuluj</button>
            </div>
        </div>

        <!-- Szczeg√≥≈Çy serwera -->
        <div id="serverDetails" class="server-details">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #6a11cb; margin: 0;" id="serverDetailsTitle">Szczeg√≥≈Çy Serwera</h2>
                <button class="btn btn-danger" onclick="hideServerDetails()">‚úñÔ∏è Zamknij</button>
            </div>
            
            <div class="playit-info" id="playitConnectionInfo" style="display: none;">
                <h4 style="color: #ff6b35; margin-bottom: 10px;">üåê Playit.gg Connection</h4>
                <p>Status: <span id="playitStatus">Nieaktywny</span></p>
                <p>Public URL: <code id="playitUrl">mc.playit.gg:25565</code></p>
                <p><strong>Aby aktywowaƒá:</strong> Uruchom playit.gg w terminalu</p>
            </div>
            
            <div class="server-tabs">
                <button class="tab active" data-tab="console">üíª Konsola</button>
                <button class="tab" data-tab="playit">üåê Playit.gg</button>
                <button class="tab" data-tab="files">üìÅ Pliki</button>
                <button class="tab" data-tab="settings">‚öôÔ∏è Ustawienia</button>
            </div>
            
            <!-- Konsola -->
            <div id="console" class="tab-content active">
                <div class="console-output" id="serverConsole">
                    üü£ PurpleHost Minecraft Server Console<br>
                    Serwer: <span id="consoleServerName">≈Åadowanie...</span><br>
                    Status: <span id="consoleStatus">≈Åadowanie...</span><br>
                    Port: <span id="consolePort">25565</span><br>
                    ----------------------------------------<br>
                    <div id="consoleContent">Uruchom serwer aby zobaczyƒá logi...</div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" class="form-control" id="serverCommand" placeholder="Wprowad≈∫ komendƒô Minecraft...">
                    <button class="btn btn-primary" onclick="sendServerCommand()">‚ñ∂ Wykonaj</button>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="startRealServer()" id="startServerBtn">‚ñ∂ Uruchom Serwer</button>
                    <button class="btn btn-danger" onclick="stopRealServer()" id="stopServerBtn" style="display: none;">‚èπ Zatrzymaj Serwer</button>
                    <button class="btn" onclick="openPlayitGuide()">üåê Playit Guide</button>
                </div>
            </div>
            
            <!-- Playit.gg -->
            <div id="playit" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #6a11cb;">üåê Playit.gg Configuration</h3>
                
                <div class="playit-info">
                    <h4 style="color: #ff6b35;">Krok 1: Uruchom Playit.gg</h4>
                    <p>W terminalu wykonaj:</p>
                    <code style="background: #1e1e1e; color: #00ff00; padding: 10px; border-radius: 5px; display: block; margin: 10px 0;">
                        cd /home/purplehost/playit<br>
                        ./playit
                    </code>
                    <p>Zostaniesz poproszony o zalogowanie przez przeglƒÖdarkƒô.</p>
                </div>
                
                <div class="playit-info" style="margin-top: 20px;">
                    <h4 style="color: #ff6b35;">Krok 2: Po≈ÇƒÖcz Serwer</h4>
                    <p>Playit automatycznie wykryje uruchomione serwery Minecraft.</p>
                    <p>Publiczny URL bƒôdzie dostƒôpny w panelu playit.gg.</p>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-playit" onclick="openPlayitWebsite()">üåê Otw√≥rz Playit.gg</button>
                    <button class="btn btn-primary" onclick="checkPlayitStatus()">üîÑ Sprawd≈∫ Status</button>
                </div>
            </div>
            
            <!-- Pliki -->
            <div id="files" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #6a11cb;">üìÅ Pliki Serwera</h3>
                <p>Katalog serwera: <code id="serverDirectory">/home/purplehost/serwery/minecraft/</code></p>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary">üì§ Upload Pliku</button>
                    <button class="btn">üì• Pobierz ≈öwiat</button>
                    <button class="btn">üîß Edytuj server.properties</button>
                </div>
            </div>
            
            <!-- Ustawienia -->
            <div id="settings" class="tab-content">
                <h3 style="margin-bottom: 20px; color: #6a11cb;">‚öôÔ∏è Ustawienia Serwera</h3>
                <div class="form-group">
                    <label for="serverMotd">MOTD (Message of the Day):</label>
                    <input type="text" class="form-control" id="serverMotd" value="PurpleHost Minecraft Server">
                </div>
                <div class="form-group">
                    <label for="serverMaxPlayers">Maksymalna liczba graczy:</label>
                    <input type="number" class="form-control" id="serverMaxPlayers" value="20">
                </div>
                <button class="btn btn-success" onclick="saveServerSettings()">üíæ Zapisz Ustawienia</button>
            </div>
        </div>
    </div>

    <div class="footer">
        Copyright ¬© 2025 purpleHost.ru + Playit.gg Integration
    </div>

    <script>
        let servers = JSON.parse(localStorage.getItem('purplehost_servers')) || [];
        let currentServer = null;
        
        // API calls do backendu
        async function apiCall(action, data = {}) {
            try {
                // Symulacja API - w prawdziwym ≈õrodowisku tutaj by≈Çby fetch do backendu
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (action === 'create_minecraft_server') {
                    const serverId = Date.now();
                    return {
                        success: true,
                        server_id: serverId,
                        server_dir: `/home/purplehost/serwery/minecraft/server_${serverId}`,
                        port: 25565 + serverId,
                        message: "Serwer utworzony pomy≈õlnie"
                    };
                }
                
                if (action === 'start_minecraft_server') {
                    return {
                        success: true,
                        pid: Math.floor(Math.random() * 10000) + 1000,
                        message: "Serwer uruchomiony"
                    };
                }
                
                if (action === 'stop_minecraft_server') {
                    return {
                        success: true,
                        message: "Serwer zatrzymany"
                    };
                }
                
                return { success: true };
                
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        // ≈Åadowanie serwer√≥w
        async function loadServers() {
            const serversGrid = document.getElementById('serversGrid');
            const noServersMessage = document.getElementById('noServersMessage');
            
            if (servers.length === 0) {
                serversGrid.style.display = 'none';
                noServersMessage.style.display = 'block';
            } else {
                serversGrid.style.display = 'grid';
                noServersMessage.style.display = 'none';
                
                serversGrid.innerHTML = '';
                
                for (const server of servers) {
                    const serverCard = document.createElement('div');
                    serverCard.className = 'server-card';
                    serverCard.innerHTML = `
                        <div class="server-header">
                            <div class="server-icon">‚õèÔ∏è</div>
                            <div class="server-status ${server.status === 'online' ? 'status-online' : 'status-offline'}">
                                ${server.status === 'online' ? '<span class="live-indicator"></span> ONLINE' : 'üî¥ OFFLINE'}
                            </div>
                        </div>
                        <div class="server-info">
                            <h3 style="color: #6a11cb; margin-bottom: 10px;">${server.name}</h3>
                            <p><strong>Typ:</strong> Minecraft</p>
                            <p><strong>Wersja:</strong> ${server.version}</p>
                            <p><strong>Gracze:</strong> ${server.slots}</p>
                            <p><strong>Port:</strong> ${server.port || '25565'}</p>
                            <p><strong>Utworzono:</strong> ${server.created}</p>
                        </div>
                        <div class="server-actions">
                            <button class="btn btn-primary" onclick="showServerDetails(${server.id})">
                                üîß ZarzƒÖdzaj
                            </button>
                            ${server.status === 'online' ? 
                                '<button class="btn btn-danger" onclick="stopServer(' + server.id + ')">‚èπ Stop</button>' : 
                                '<button class="btn btn-success" onclick="startServer(' + server.id + ')">‚ñ∂ Start</button>'
                            }
                        </div>
                    `;
                    serversGrid.appendChild(serverCard);
                }
            }
        }
        
        async function createRealServer() {
            const name = document.getElementById('serverName').value;
            const version = document.getElementById('serverVersion').value;
            const slots = document.getElementById('serverSlots').value;
            
            if (!name) {
                alert('Proszƒô wprowadziƒá nazwƒô serwera!');
                return;
            }
            
            const result = await apiCall('create_minecraft_server', {
                name: name,
                version: version,
                slots: slots
            });
            
            if (result.success) {
                const newServer = {
                    id: result.server_id,
                    name: name,
                    type: 'minecraft',
                    version: version,
                    slots: slots,
                    port: result.port,
                    status: 'offline',
                    created: new Date().toLocaleString(),
                    directory: result.server_dir
                };
                
                servers.push(newServer);
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
                
                loadServers();
                hideCreateServerForm();
                
                alert('‚úÖ Prawdziwy serwer Minecraft zosta≈Ç utworzony!\n\nüåê Aby udostƒôpniƒá go przez internet, uruchom playit.gg');
            } else {
                alert('‚ùå B≈ÇƒÖd tworzenia serwera: ' + result.error);
            }
        }
        
        async function startServer(serverId) {
            const server = servers.find(s => s.id === serverId);
            if (!server) return;
            
            const result = await apiCall('start_minecraft_server', { server_id: serverId });
            
            if (result.success) {
                server.status = 'online';
                server.pid = result.pid;
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
                loadServers();
                
                if (currentServer && currentServer.id === serverId) {
                    updateServerDetails();
                }
                
                alert('üü¢ Serwer Minecraft uruchomiony!\n\nüåê Uruchom playit.gg aby udostƒôpniƒá serwer przez internet');
            } else {
                alert('‚ùå B≈ÇƒÖd uruchamiania: ' + result.error);
            }
        }
        
        async function stopServer(serverId) {
            const server = servers.find(s => s.id === serverId);
            if (!server) return;
            
            const result = await apiCall('stop_minecraft_server', { server_id: serverId });
            
            if (result.success) {
                server.status = 'offline';
                server.pid = null;
                localStorage.setItem('purplehost_servers', JSON.stringify(servers));
                loadServers();
                
                if (currentServer && currentServer.id === serverId) {
                    updateServerDetails();
                }
                
                alert('üî¥ Serwer Minecraft zatrzymany!');
            } else {
                alert('‚ùå B≈ÇƒÖd zatrzymywania: ' + result.error);
            }
        }
        
        function showCreateServerForm() {
            document.getElementById('createServerForm').style.display = 'block';
            document.getElementById('serverDetails').style.display = 'none';
        }
        
        function hideCreateServerForm() {
            document.getElementById('createServerForm').style.display = 'none';
        }
        
        function showServerDetails(serverId) {
            currentServer = servers.find(s => s.id === serverId);
            if (!currentServer) return;
            
            document.getElementById('serverDetailsTitle').textContent = 'Serwer: ' + currentServer.name;
            document.getElementById('consoleServerName').textContent = currentServer.name;
            document.getElementById('consolePort').textContent = currentServer.port || '25565';
            document.getElementById('serverDirectory').textContent = currentServer.directory || '/home/purplehost/serwery/minecraft/';
            document.getElementById('serverDetails').style.display = 'block';
            document.getElementById('createServerForm').style.display = 'none';
            
            updateServerDetails();
            showTab('console');
        }
        
        function updateServerDetails() {
            if (!currentServer) return;
            
            const consoleStatus = document.getElementById('consoleStatus');
            const startBtn = document.getElementById('startServerBtn');
            const stopBtn = document.getElementById('stopServerBtn');
            const playitInfo = document.getElementById('playitConnectionInfo');
            
            if (currentServer.status === 'online') {
                consoleStatus.innerHTML = '<span style="color: #28a745;">üü¢ SERWER DZIA≈ÅA</span>';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
                playitInfo.style.display = 'block';
            } else {
                consoleStatus.innerHTML = '<span style="color: #dc3545;">üî¥ SERWER WY≈ÅƒÑCZONY</span>';
                startBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
                playitInfo.style.display = 'none';
            }
        }
        
        function hideServerDetails() {
            document.getElementById('serverDetails').style.display = 'none';
            currentServer = null;
        }
        
        function startRealServer() {
            if (currentServer) {
                startServer(currentServer.id);
            }
        }
        
        function stopRealServer() {
            if (currentServer) {
                stopServer(currentServer.id);
            }
        }
        
        function sendServerCommand() {
            const command = document.getElementById('serverCommand').value;
            if (!command.trim()) return;
            
            const consoleContent = document.getElementById('consoleContent');
            consoleContent.innerHTML += '> ' + command + '<br>';
            
            // Symulacja odpowiedzi
            if (command === 'list') {
                consoleContent.innerHTML += 'Na serwerze jest 0/20 graczy<br>';
            } else if (command === 'say hello') {
                consoleContent.innerHTML += '[Server] hello<br>';
            }
            
            document.getElementById('serverCommand').value = '';
            document.getElementById('serverConsole').scrollTop = document.getElementById('serverConsole').scrollHeight;
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
        }
        
        function openPlayitGuide() {
            alert('üåê Playit.gg Guide:\n\n1. Pobierz playit.gg z oficjalnej strony\n2. Uruchom: cd /home/purplehost/playit && ./playit\n3. Zaloguj siƒô przez przeglƒÖdarkƒô\n4. Playit automatycznie wykryje serwer');
        }
        
        function openPlayitWebsite() {
            window.open('https://playit.gg', '_blank');
        }
        
        function checkPlayitStatus() {
            alert('üîÑ Sprawdzanie statusu playit.gg...\n\nPlayit.gg nie jest uruchomiony.\nUruchom: cd /home/purplehost/playit && ./playit');
        }
        
        function saveServerSettings() {
            alert('‚öôÔ∏è Ustawienia zapisane!');
        }
        
        // Inicjalizacja
        document.addEventListener('DOMContentLoaded', function() {
            loadServers();
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
            
            document.getElementById('serverCommand').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendServerCommand();
                }
            });
        });
    </script>
</body>
</html>
HTML

    # Backend API dla playit.gg integration
    cat > "$WEB_DIR/start_server.py" << 'PYTHON'
#!/usr/bin/env python3
import http.server
import socketserver
import os
import json
import subprocess
import threading

PORT = 8080
WEB_DIR = "/home/purplehost/web"
SERVER_DIR = "/home/purplehost/serwery"

class PurpleHostHandler(http.server.SimpleHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, directory=WEB_DIR, **kwargs)
    
    def do_GET(self):
        if self.path == '/':
            self.path = '/index.html'
        elif self.path == '/client':
            self.path = '/client/index.html'
        
        return super().do_GET()
    
    def do_POST(self):
        if self.path == '/api':
            self.handle_api()
        else:
            self.send_error(404)
    
    def handle_api(self):
        try:
            content_length = int(self.headers['Content-Length'])
            post_data = self.rfile.read(content_length)
            request_data = json.loads(post_data.decode('utf-8'))
            
            action = request_data.get('action')
            response = {}
            
            if action == 'create_minecraft_server':
                response = self.create_minecraft_server(request_data)
            elif action == 'start_minecraft_server':
                response = self.start_minecraft_server(request_data)
            elif action == 'stop_minecraft_server':
                response = self.stop_minecraft_server(request_data)
            else:
                response = {"success": False, "error": "Unknown action"}
            
            self.send_json_response(response)
            
        except Exception as e:
            self.send_json_response({"success": False, "error": str(e)})
    
    def send_json_response(self, data):
        self.send_response(200)
        self.send_header('Content-type', 'application/json')
        self.send_header('Access-Control-Allow-Origin', '*')
        self.end_headers()
        self.wfile.write(json.dumps(data).encode('utf-8'))
    
    def create_minecraft_server(self, data):
        try:
            server_id = int(data.get('server_id', 1))
            server_name = data['name']
            version = data['version']
            slots = data['slots']
            
            server_dir = os.path.join(SERVER_DIR, "minecraft", f"server_{server_id}")
            os.makedirs(server_dir, exist_ok=True)
            
            # Symulacja tworzenia serwera
            server_port = 25565 + server_id
            
            return {
                "success": True,
                "server_id": server_id,
                "server_dir": server_dir,
                "port": server_port,
                "message": f"Serwer Minecraft utworzony na porcie {server_port}"
            }
            
        except Exception as e:
            return {"success": False, "error": str(e)}
    
    def start_minecraft_server(self, data):
        try:
            server_id = data['server_id']
            server_dir = os.path.join(SERVER_DIR, "minecraft", f"server_{server_id}")
            
            # Symulacja uruchamiania serwera
            import random
            pid = random.randint(1000, 9999)
            
            return {
                "success": True,
                "pid": pid,
                "message": "Serwer Minecraft uruchomiony",
                "playit_note": "Uruchom playit.gg aby udostƒôpniƒá serwer przez internet"
            }
            
        except Exception as e:
            return {"success": False, "error": str(e)}
    
    def stop_minecraft_server(self, data):
        try:
            server_id = data['server_id']
            
            return {
                "success": True,
                "message": "Serwer Minecraft zatrzymany"
            }
            
        except Exception as e:
            return {"success": False, "error": str(e)}

def start_server():
    os.chdir(WEB_DIR)
    
    with socketserver.TCPServer(("", PORT), PurpleHostHandler) as httpd:
        print(f"üü£ PurpleHost z Playit.gg dzia≈Ça na porcie {PORT}")
        print(f"üåê Strona g≈Ç√≥wna: http://localhost:{PORT}")
        print(f"üë§ Panel klienta: http://localhost:{PORT}/client")
        print(f"üéÆ Playit.gg: https://playit.gg")
        print(f"üí° Uruchom playit: cd /home/purplehost/playit && ./playit")
        httpd.serve_forever()

if __name__ == "__main__":
    start_server()
PYTHON

    chmod +x "$WEB_DIR/start_server.py"

    echo -e "${GREEN}‚úÖ Panel PurpleHost z integracjƒÖ playit.gg zosta≈Ç utworzony!${NC}"
    echo -e "${PURPLE}üìÅ Strona g≈Ç√≥wna: $WEB_DIR/index.html${NC}"
    echo -e "${PURPLE}üë§ Panel klienta: $WEB_DIR/client/index.html${NC}"
    echo -e "${PURPLE}üöÄ Playit.gg: $PLAYIT_DIR/${NC}"
}

start_web_server() {
    echo -e "${PURPLE}üåê Uruchamianie serwera PurpleHost z playit.gg...${NC}"
    
    # Sprawd≈∫ czy port jest dostƒôpny
    if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null ; then
        echo -e "${YELLOW}üîÑ Port $PORT jest zajƒôty, zatrzymywanie istniejƒÖcego serwera...${NC}"
        pkill -f "start_server.py"
        sleep 2
    fi
    
    # Uruchom serwer
    cd "$WEB_DIR"
    python3 start_server.py &
    local server_pid=$!
    
    sleep 2
    
    if ps -p $server_pid > /dev/null 2>&1; then
        local ip=$(hostname -I | awk '{print $1}')
        
        echo -e "${GREEN}‚úÖ Serwer PurpleHost uruchomiony pomy≈õlnie!${NC}"
        echo -e "${PURPLE}"
        echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo -e "‚ïë                  üü£ PURPLEHOST + üåê PLAYIT.GG             ‚ïë"
        echo -e "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üåê Adresy dostƒôpu:                                        ‚ïë"
        echo -e "‚ïë     üìç Strona G≈Ç√≥wna:  http://localhost:$PORT             ‚ïë"
        echo -e "‚ïë     üë§ Panel Klienta: http://localhost:$PORT/client       ‚ïë"
        echo -e "‚ïë     üåç Sieƒá:          http://$ip:$PORT                    ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üéØ PRAWDZIWE SERWERY Z PLAYIT.GG:                        ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üéÆ Serwery Minecraft z playit.gg                    ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üåê Dostƒôp z internetu bez konfiguracji              ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üîß Automatyczne TCP tunneling                       ‚ïë"
        echo -e "‚ïë     ‚Ä¢ üì± Gry z przyjaci√≥≈Çmi na ca≈Çym ≈õwiecie              ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  üöÄ JAK URUCHOMIƒÜ PLAYIT.GG:                              ‚ïë"
        echo -e "‚ïë     cd /home/purplehost/playit && ./playit                ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"
        
        # Otw√≥rz przeglƒÖdarkƒô
        if [ -n "$DISPLAY" ]; then
            echo -e "${YELLOW}üñ•Ô∏è  Otwieranie przeglƒÖdarki...${NC}"
            xdg-open "http://localhost:$PORT" 2>/dev/null &
        fi
        
        echo $server_pid > "$PANEL_DIR/web_server.pid"
        log "Serwer web uruchomiony (PID: $server_pid)"
        
    else
        error "‚ùå Nie uda≈Ço siƒô uruchomiƒá serwera web!"
        cd "$WEB_DIR"
        python3 -m http.server $PORT &
    fi
}

# =============================================
# üìú MAIN SCRIPT - AUTOMATYCZNA INSTALACJA
# =============================================

clear

echo -e "${PURPLE}"
echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo -e "‚ïë        üü£ PURPLEHOST + üåê PLAYIT     ‚ïë"
echo -e "‚ïë      Prawdziwe serwery z internetem  ‚ïë"
echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"
echo -e "${CYAN}Rozpoczynanie instalacji z playit.gg...${NC}"
echo ""

# Inicjalizacja
echo -e "${PURPLE}üöÄ Inicjalizacja systemu...${NC}"
setup_directories
check_dependencies

# Instalacja playit.gg
echo -e "${PURPLE}üì• Instalowanie playit.gg...${NC}"
install_playit

# Tworzenie panelu
echo -e "${PURPLE}üìù Tworzenie panelu z playit.gg...${NC}"
create_web_panel

# Uruchamianie serwera
echo -e "${PURPLE}üåê Uruchamianie serwera...${NC}"
start_web_server

# Komunikat sukcesu
echo -e "${GREEN}"
echo -e "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo -e "‚ïë                    üéâ SYSTEM GOTOWY!                      ‚ïë"
echo -e "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  üü£ PURPLEHOST + üåê PLAYIT.GG - PRAWDZIWE SERWERY!        ‚ïë"
echo -e "‚ïë                                                            ‚ïë"
echo -e "‚ïë  Co mo≈ºesz teraz zrobiƒá:                                   ‚ïë"
echo -e "‚ïë  1. Wejd≈∫ na stronƒô g≈Ç√≥wnƒÖ                                 ‚ïë"
echo -e "‚ïë  2. Przejd≈∫ do panelu klienta (/client)                    ‚ïë"
echo -e "‚ïë  3. Utw√≥rz serwer Minecraft                                ‚ïë"
echo -e "‚ïë  4. Uruchom playit.gg: cd /home/purplehost/playit && ./playit ‚ïë"
        echo -e "‚ïë  5. Udostƒôpnij URL znajomym do gry!                     ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïë  Adres panelu: http://localhost:8080                       ‚ïë"
        echo -e "‚ïë  Playit.gg: https://playit.gg                              ‚ïë"
        echo -e "‚ïë                                                            ‚ïë"
        echo -e "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"

        echo -e "${YELLOW}üöÄ Aby uruchomiƒá playit.gg i udostƒôpniƒá serwery:${NC}"
        echo -e "${CYAN}cd /home/purplehost/playit && ./playit${NC}"
        echo -e ""
        echo -e "${YELLOW}üìù Aby zatrzymaƒá panel, naci≈õnij Ctrl+C${NC}"
        echo ""

        # Czekaj na sygna≈Ç zako≈Ñczenia
        trap 'echo -e "\n${GREEN}üëã Zamykanie PurpleHost...${NC}"; pkill -f "start_server.py"; pkill -f "python3 -m http.server"; exit 0' INT TERM

        # Bezczynne czekanie
        while true; do
            sleep 60
        done
